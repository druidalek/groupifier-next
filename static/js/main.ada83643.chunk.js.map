{"version":3,"sources":["logic/utils.js","logic/wcif-extensions.js","logic/events.js","logic/activities.js","logic/formulas.js","components/Competition/CompetitionMenu/CompetitionMenu.js","components/common/RoomName/RoomName.js","components/common/PositiveIntegerInput/PositiveIntegerInput.js","components/common/ZeroablePositiveIntegerInput/ZeroablePositiveIntegerInput.js","components/Competition/ConfigManager/RoomConfig/RoomConfig.js","components/Competition/ConfigManager/RoomsConfig/RoomsConfig.js","components/common/CubingIcon/CubingIcon.js","components/common/EventSelect/EventSelect.js","components/common/RoundsNavigation/RoundPanel/RoundPanel.js","components/common/RoundsNavigation/RoundsNavigation.js","components/Competition/ConfigManager/RoundActivityConfig/RoundActivityConfig.js","components/Competition/ConfigManager/RoundConfig/RoundConfig.js","components/Competition/ConfigManager/RoundsConfig/RoundsConfig.js","components/Competition/ConfigManager/GeneralConfig/GeneralConfig.js","logic/wca-env.js","logic/auth.js","logic/wca-api.js","components/common/SaveWcifButton/SaveWcifButton.js","logic/competitors.js","components/Competition/ConfigManager/ConfigManager.js","components/Competition/GroupsManager/GroupDialog/GroupDialog.js","components/Competition/GroupsManager/GroupsNavigation/GroupsNavigation.js","logic/groups.js","components/Competition/GroupsManager/GroupsManager.js","logic/formatters.js","logic/documents/pdfmake.js","logic/documents/pdf-utils.js","logic/documents/scorecards.js","logic/documents/group-overview.js","components/Competition/PrintingManager/Scorecards/Scorecards.js","logic/documents/competitor-cards.js","components/Competition/PrintingManager/CompetitorCards/CompetitorCards.js","components/Competition/PrintingManager/PrintingManager.js","components/Competition/RolesManager/RolesManager.js","logic/wcif-validation.js","logic/__cubecomps__.js","components/Competition/Competition.js","components/CompetitionList/CompetitionList.js","components/Footer/Footer.js","components/Header/Header.js","components/Home/Home.js","components/App/App.js","registerServiceWorker.js","index.js"],"names":["updateIn","object","_ref","updater","_ref2","Object","toArray","property","properyChain","slice","length","objectSpread","defineProperty","setIn","value","mapIn","mapper","array","map","isPresentDeep","obj","values","every","pluralize","count","singular","plural","concat","scaleToOne","arr","arrSum","sum","x","flatMap","fn","reduce","xs","zip","_len","arguments","arrs","Array","_key","_","i","findLast","predicate","reduceRight","found","undefined","intersection","ys","filter","includes","difference","partition","sortCompare","y","sortBy","sort","sortByArray","Map","get","_ref5","_ref6","slicedToArray","a","b","result","chunk","size","toConsumableArray","inRange","addMilliseconds","isoString","milliseconds","Date","getTime","toISOString","isoTimeDiff","first","second","Math","abs","shortTime","timeZone","toLocaleTimeString","hour","minute","groupifierExtensionId","extensionName","buildGroupifierExtension","data","id","specUrl","setExtensionData","wcifEntity","otherExtensions","extensions","extension","defaultExtensionData","ActivityConfig","RoomConfig","stations","CompetitionConfig","localNamesFirst","scorecardsBackgroundUrl","getExtensionData","find","removeExtensionData","events","name","shortName","eventNameById","eventId","propertyById","event","sortWcifEvents","wcifEvents","wcifEvent","findIndex","parseActivityCode","activityCode","_activityCode$match","match","_activityCode$match2","e","r","g","roundNumber","parseInt","groupNumber","attemptNumber","activityCodeToName","_parseActivityCode","join","hasDistributedAttempts","activityDuration","activity","endTime","startTime","activitiesOverlap","rooms","wcif","schedule","venues","venue","stationsByActivity","activityId","room","activities","some","roomByActivity","allActivities","allChildActivities","childActivities","activitiesByIdCachedBySchedule","activityById","has","activitiesById","set","updateActivity","updatedActivity","populateRoundActivitiesConfig","expectedCompetitorsByRound","defaults","rounds","round","expectedRoundCompetitors","roundActivities","shouldHaveGroups","capacities","_ref3","_ref4","capacity","competitors","groups","preferredGroupSize","calculatedGroupCount","max","suggestedGroupCount","scramblers","assignScramblers","groupCompetitors","floor","min","suggestedScramblerCount","runners","assignRunners","suggestedRunnerCount","assignJudges","_parseActivityCode3","anyActivityConfig","activitiesConfigComplete","roomsConfigComplete","roundId","startsWith","groupActivitiesByRound","activityAssigned","persons","person","assignments","assignment","groupActivitiesAssigned","roundsMissingResults","results","roundsMissingAssignments","roundsMissingScorecards","anyGroupAssignedOrCreated","anyResults","menuItems","path","text","icon","enabled","assignmentCode","anyCompetitorAssignment","CompetitionMenu","baseUrl","react_default","createElement","Paper_default","List_default","menuItem","ListItem_default","key","button","component","Link","to","disabled","ListItemIcon_default","Icon_default","ListItemText_default","primary","RoomName","Typography_default","variant","style","display","width","height","marginRight","borderRadius","backgroundColor","color","PositiveIntegerInput","handleKeyPress","preventDefault","handleTextFieldChange","newValue","target","Number","isNaN","_this","props","onChange","_this$props","this","objectWithoutProperties","TextField_default","assign","type","onKeyPress","PureComponent","ZeroablePositiveIntegerInput","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","handleCheckboxChange","checked","inputRef","React","createRef","prevProps","current","focus","react","PositiveIntegerInput_PositiveIntegerInput","Checkbox_default","handleInputChange","_this$props2","common_RoomName_RoomName","ZeroablePositiveIntegerInput_ZeroablePositiveIntegerInput","label","Component","RoomsConfig","handleRoomChange","updatedRoom","onWcifChange","_this2","padding","Grid_default","container","spacing","item","lg","RoomConfig_RoomConfig","CubingIcon","fontSize","className","EventSelect","selected","Tooltip_default","title","placement","IconButton_default","onClick","common_CubingIcon_CubingIcon","opacity","RoundWithGroups","handlePanelChange","expanded","scrollToElement","node","window","scrollTo","top","parentNode","getBoundingClientRect","behavior","render","ExpansionPanel_default","CollapseProps","onEntered","ExpansionPanelSummary_default","expandIcon","ExpansionPanelDetails_default","RoundsNavigation","handleEventChange","setState","selectedEventId","handleRoundChange","expandedRoundId","state","_this$state","selectedEvent","justify","EventSelect_EventSelect","RoundPanel_RoundWithGroups","RoundActivityConfig","handlePropertyChange","_event$target","nextProps","expectedCompetitors","_getExtensionData","groupSize","groupsHelperText","scramblersHelperText","runnersHelperText","groupsCreated","groupsAssigned","direction","helperText","margin","FormControlLabel_default","control","RoundConfig","handleActivityChange","activitiesWithRooms","RoundActivityConfig_RoundActivityConfig","RoundsConfig","handleNextClick","renderRound","RoundConfig_RoundConfig","RoundsNavigation_RoundsNavigation","roleLabel","Button_default","GeneralConfig","_event$target2","fullWidth","production","URLSearchParams","location","search","WCA_ORIGIN","WCA_OAUTH_CLIENT_ID","localStorageKey","wcaAccessToken","localStorage","getItem","signIn","params","client_id","response_type","redirect_uri","oauthRedirectUri","scope","toString","_window$location","origin","pathname","staging","appUri","replace","signOut","removeItem","isSignedIn","saveWcifChanges","previousWcif","newWcif","competitionId","keysDiff","keys","Promise","resolve","newObj","wcaApiFetch","method","body","JSON","stringify","fetchOptions","baseApiUrl","fetch","headers","Headers","Authorization","Content-Type","then","response","ok","Error","statusText","json","SaveWcifButton","saving","failed","handleSaveClick","updatedWcif","onWcifUpdate","history","push","catch","handleSnackbarClose","Snackbar_default","open","message","anchorOrigin","vertical","horizontal","autoHideDuration","onClose","visibility","CircularProgress_default","position","best","personalBest","personalBests","pb","Infinity","bestAverageAndSingle","competitor","getExpectedCompetitorsByRound","_event$rounds","firstRound","nextRounds","acceptedPeopleRegisteredForEvent","nextRound","advancementCondition","nextRoundCompetitors","sortedCompetitors","level","competitorsExpectedToAdvance","advancingResults","sortedResults","attempts","ranking","maxAdvanceable","firstNonAdvancingRank","resultCount","attempt","satisfiesAdvancementCondition","competitorsForRound","previousRound","registrantId","personId","age","diffMs","now","birthdate","staffAssignments","staffAssignmentsForEvent","acceptedPeople","registration","status","eventIds","hasAssignment","ConfigManager","handleWcifChange","localWcif","handleTabChange","tabValue","clearConfig","withoutCompetitionConfig","wcifConfigComplete","AppBar_default","Tabs_default","centered","Tab_default","RoomsConfig_RoomsConfig","RoundsConfig_RoundsConfig","GeneralConfig_GeneralConfig","SaveWcifButton_SaveWcifButton","GroupDialog","groupActivity","rolesWithPeople","role","Dialog_default","maxWidth","DialogTitle_default","DialogContent_default","people","sm","md","dense","overflowY","maxHeight","wcaUserId","DialogActions_default","openedGroupActivity","handleGroupClick","handleDialogClose","roomsWithTimezoneAndGroups","timezone","groupActivities","secondary","Fragment","GroupDialog_GroupDialog","createGroupActivities","currentActivityId","apply","maxActivityId","activitiesWithGroups","groupDuration","from","index","scrambleSetId","forEach","assignTasks","roundsToAssign","assignGroups","assignScrambling","assignRunning","assignJudging","assignmentFn","updatedCompetitors","assignActivity","updatePeople","groupActivitiesWithCapacity","_zip","_zip2","groupSizes","calculateGroupSizes","initialGroups","sortedInitialGroups","availabilityRates","group","availabilityRate","maxAvailabilityRate","mostAvailableGroups","preferredGroups","overlapsEveryoneWithSameRole","potentialGroups","notFullGroup","addCompetitorToGroupEnd","updatedGroups","moveSomeoneRight","moveSomeoneLeft","_ref7","competitorCount","_ref8","groupId","_ref9","indexOf","furtherGroup","competitorToMove","moveCompetitorToGroupStart","groupsWithSpot","_ref10","previousGroup","moveCompetitorToGroupEnd","updateCompetitorsInGroup","removeCompetitorFromGroup","other","fromGroupId","toGroupId","addCompetitorToGroupStart","staffScramblers","roles","available","availableDuring","sortedAvailableStaff","competesIn15Minutes","sortedAvailableCompetitors","presenceRate","potentialScramblers","_partition","_partition2","staffRunners","sortedAvailablePeople","potentialRunners","updatedPeople","judges","_partition3","_partition4","staffJudges","potentialJudges","competingStartTimes","_ref11","_ref12","competingStart","time","activitiesThisDay","_ref13","_ref14","getDay","_zip$map","_ref15","times","_zip$map2","startTimes","endTimes","previousEndTime","nextStartTime","updatedPerson","_ref16","intersections","_ref17","_sort","_sort2","middleStart","middleEnd","activitiesIntersection","others","_ref18","updateScrambleSetCount","scrambleSetCountForRound","_ref19","Set","GroupsManager","clearGroups","allGroupsCreated","SnackbarContent_default","action","pink","GroupsNavigation_RoundWithGroups","cutoffToString","cutoff","multibldAttemptResultToPoints","attemptResult","centisecondsToClockFormat","timeLimitToString","timeLimit","centiseconds","cumulativeRoundIds","clockFormat","roundStrings","shortEventNameById","date","setUTCMilliseconds","substr","vfsFonts","pdfMake","vfs","singleFileFont","file","normal","bold","italic","bolditalics","fonts","Roboto","italics","WenQuanYiZenHei","NotoSansThai","NotoSansArabic","NotoSansGeorgian","NotoSansArmenian","determineFont","code","charCodeAt","pdfName","_ref$swapLatinWithLoc","swapLatinWithLocalNames","_ref$short","short","latinName","localName","pdfNames","font","reverse","maxAttemptCountByFormat","1","2","3","m","downloadScorecards","url","filt","bri","bg","w","h","t","output","encoding","getImageDataUrl","imageData","pdfDefinition","scorecardsPdfDefinition","createPdf","download","background","absolutePosition","image","canvas","cutLine","x1","y1","pageHeight","x2","pageWidth","y2","pageMargins","content","layout","paddingLeft","paddingRight","paddingTop","paddingBottom","hLineWidth","vLineWidth","table","widths","heights","dontBreakRows","scorecards","properties","lineWidth","dash","lineColor","sortedGroupActivities","scorecardNumber","groupScorecards","scorecard","competitionName","scorecardsOnLastPage","attemptCount","format","alignment","columnLabels","attemptRows","noBorder","colSpan","attemptRow","columns","labels","attemptIndex","rows","attemptsSeparator","numberOfAttempts","cutoffLine","border","downloadGroupOverview","groupOverviewPdfDefinition","overviewForGroup","headersWithPeople","header","unbreakable","stack","ul","Scorecards","handleScorecardsDownloadClick","selectedRounds","handleGroupOverviewDownloadClick","handleRoundClick","tabIndex","disableRipple","downloadCompetitorCards","competitorCardsPdfDefinition","competitorCards","cards","competitorCard","cardsInLastRow","tasks","task","assignmentCodes","wcaId","groupsText","CompetitorCards","handleDownloadClick","PrintingManager","Scorecards_Scorecards","CompetitorCards_CompetitorCards","RolesManager","handleSearchChange","searchString","handleChangePage","page","clearRoles","roleIds","roleId","personWcaUserId","RegExp","Toolbar_default","overflowX","Table_default","TableHead_default","TableRow_default","TableCell_default","textAlign","TableBody_default","hover","handleRoleChange","bind","TablePagination_default","rowsPerPage","rowsPerPageOptions","onChangePage","validateWcif","advancementConditionErrors","roundActivityErrors","__withCubecompsIds__","getCompetitions","competitions","competition","getCompetition","cubecompsApiFetch","competitionCubecompsId","Competition","loading","errors","handleWcifUpdate","error","_this3","LinearProgress_default","marginBottom","Switch","Route","exact","Competition_CompetitionMenu_CompetitionMenu","RolesManager_RolesManager","ConfigManager_ConfigManager","GroupsManager_GroupsManager","PrintingManager_PrintingManager","CompetitionList","oneWeekAgo","managed_by_me","start","getUpcomingManageableCompetitions","subheader","ListSubheader_default","links","Footer","flexGrow","red","href","rel","Header","onSignIn","onSignOut","verticalAlign","features","Home","feature","theme","createMuiTheme","palette","indigo","grey","typography","useNextVariants","App","handleSignIn","handleSignOut","HashRouter","styles","minHeight","flexDirection","CssBaseline_default","components_Header_Header","Redirect","components_Footer_Footer","isLocalhost","Boolean","hostname","registerValidSW","swUrl","navigator","serviceWorker","register","onupdatefound","installingWorker","installing","onstatechange","controller","console","log","hash","hashParams","setItem","expiresInSeconds","expirationTime","initializeAuth","ReactDOM","App_App","document","getElementById","URL","process","addEventListener","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker"],"mappings":"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","file":"static/js/main.ada83643.chunk.js","sourcesContent":["/**\n * Returns a copy of the object with the value at the specified path transformed by the update function.\n *\n * @param {Object} object\n * @param {Array} propertyChain\n * @param {Function} updater\n * @returns {Object}\n */\nexport const updateIn = (object, [property, ...properyChain], updater) =>\n  properyChain.length === 0\n    ? { ...object, [property]: updater(object[property]) }\n    : { ...object, [property]: updateIn(object[property], properyChain, updater) };\n\n/**\n * Returns a copy of the object with the value at the specified path set to the given one.\n *\n * @param {Object} object\n * @param {Array} propertyChain\n * @param {*} value\n * @returns {Object}\n */\nexport const setIn = (object, properyChain, value) =>\n  updateIn(object, properyChain, () => value);\n\n/**\n * Returns a copy of the object with the value at the specified path merged with the given one.\n *\n * @param {Object} object\n * @param {Array} propertyChain\n * @param {Object} newValue\n * @returns {Object}\n */\nexport const mergeIn = (object, properyChain, newValue) =>\n  updateIn(object, properyChain, currentValue => ({ ...currentValue, ...newValue }));\n\n/**\n * Returns a copy of the object with the array at the specified path mapped with the given function.\n *\n * @param {Object} object\n * @param {Array} propertyChain\n * @param {Object} mapper\n * @returns {Object}\n */\nexport const mapIn = (object, properyChain, mapper) =>\n  updateIn(object, properyChain, array => array && array.map(mapper));\n\n/**\n * Returns object's value at the specified path or the default value if it doesn't exist.\n *\n * @param {Object} object\n * @param {Array} propertyChain\n * @param {*} defaultValue\n * @returns {*}\n */\nexport const getIn = (object, [property, ...propertyChain], defaultValue = null) =>\n  object ? (\n    propertyChain.length === 0\n      ? (object.hasOwnProperty(property) ? object[property] : defaultValue)\n      : getIn(object[property], propertyChain, defaultValue)\n  ) : defaultValue;\n\n/**\n * Checks if the given value is an object.\n *\n * @param {*} value\n * @returns {boolean}\n */\nconst isObject = obj => obj === Object(obj);\n\n/**\n * When given an object, deeply checks if it doesn't contain null values.\n * Otherwise, checks if the given value is not null.\n *\n * @param {*} value\n * @returns {boolean}\n */\nexport const isPresentDeep = value =>\n  isObject(value)\n    ? Object.values(value).every(isPresentDeep)\n    : value != null;\n\n/**\n * Pluralizes a word according to the given number.\n * When no plural form given, uses singular form with an 's' appended.\n *\n * @param {number} count\n * @param {string} singular\n * @param {string} plural\n * @returns {string}\n */\nexport const pluralize = (count, singular, plural) =>\n  `${count} ${count === 1 ? singular : (plural || singular + 's')}`\n\n/**\n * Returns a new array with items summing up to 1, preserving elements proportionality.\n * When the given array is empty, returns an empty array.\n *\n * @param {Array} arr\n * @returns {Array}\n */\nexport const scaleToOne = arr => {\n  if (arr.length === 0) return [];\n  const arrSum = sum(arr);\n  return arr.map(x => arrSum !== 0 ? x / arrSum : 1 / arr.length);\n};\n\n/**\n * Applies the given function to the elements and returns the first truthy value of these calls.\n *\n * @param {Array} arr\n * @returns {*}\n */\nexport const firstResult = (arr, fn) =>\n  arr.reduce((result, x) => result || fn(x), null);\n\nexport const flatMap = (arr, fn) =>\n  arr.reduce((xs, x) => xs.concat(fn(x)), []);\n\nexport const zip = (...arrs) =>\n  arrs.length === 0 ? [] : arrs[0].map((_, i) => arrs.map(arr => arr[i]));\n\nexport const findLast = (arr, predicate) =>\n  arr.reduceRight((found, x) =>\n    found !== undefined ? found : (predicate(x) ? x : undefined)\n  , undefined);\n\nexport const intersection = (xs, ys) =>\n  xs.filter(x => ys.includes(x));\n\nexport const difference = (xs, ys) =>\n  xs.filter(x => !ys.includes(x));\n\nexport const partition = (xs, fn) =>\n  [xs.filter(fn), xs.filter(x => !fn(x))];\n\nconst sortCompare = (x, y) =>\n  x < y ? -1 : (x > y ? 1 : 0);\n\nexport const sortBy = (arr, fn) =>\n  arr.slice().sort((x, y) => sortCompare(fn(x), fn(y)));\n\nexport const sortByArray = (arr, fn) => {\n  const values = new Map(arr.map(x => [x, fn(x)])); /* Compute every value once. */\n  return arr.slice().sort((x, y) =>\n    firstResult(zip(values.get(x), values.get(y)), ([a, b]) => sortCompare(a, b))\n  );\n}\n\nexport const chunk = (arr, size) =>\n  arr.length <= size\n    ? [arr]\n    : [arr.slice(0, size), ...chunk(arr.slice(size), size)];\n\nexport const uniq = arr =>\n  [...new Set(arr)];\n\nexport const sum = arr =>\n  arr.reduce((x, y) => x + y, 0);\n\nexport const pick = (obj, keys) =>\n  keys.reduce((newObj, key) => ({ ...newObj, [key]: obj[key] }), {});\n\nexport const inRange = (x, a, b) =>\n  a <= x && x <= b;\n\nexport const addMilliseconds = (isoString, milliseconds) =>\n  new Date(new Date(isoString).getTime() + milliseconds).toISOString();\n\nexport const isoTimeDiff = (first, second) =>\n  Math.abs(new Date(first) - new Date(second));\n\nexport const shortTime = (isoString, timeZone = 'UTC') =>\n  new Date(isoString).toLocaleTimeString('en-US', { timeZone, hour: 'numeric', minute: 'numeric' });\n","const groupifierExtensionId = extensionName => `groupifier.${extensionName}`;\n\nconst buildGroupifierExtension = (extensionName, data) => ({\n  id: groupifierExtensionId(extensionName),\n  specUrl: `https://jonatanklosko.github.io/groupifier-next/wcif-extensions/${extensionName}.json`,\n  data\n});\n\nexport const setExtensionData = (extensionName, wcifEntity, data) => {\n  const otherExtensions = wcifEntity.extensions\n    .filter(extension => extension.id !== groupifierExtensionId(extensionName));\n  return {\n    ...wcifEntity,\n    extensions: [...otherExtensions, buildGroupifierExtension(extensionName, data)]\n  };\n};\n\nconst defaultExtensionData = {\n  ActivityConfig: null, /* This always gets generated, so it's fine for it to be null until then. */\n  RoomConfig: {\n    stations: null\n  },\n  CompetitionConfig: {\n    localNamesFirst: false,\n    scorecardsBackgroundUrl: null\n  }\n};\n\nexport const getExtensionData = (extensionName, wcifEntity) => {\n  const extension = wcifEntity.extensions\n    .find(extension => extension.id === groupifierExtensionId(extensionName));\n  return extension ? extension.data : defaultExtensionData[extensionName];\n};\n\nexport const removeExtensionData = (extensionName, wcifEntity) => ({\n  ...wcifEntity,\n  extensions: wcifEntity.extensions.filter(extension =>\n    extension.id !== groupifierExtensionId(extensionName)\n  )\n});\n","import { sortBy } from './utils';\n\nconst events = [\n  { id: '333',    name: '3x3x3 Cube',         shortName: '3x3'   },\n  { id: '222',    name: '2x2x2 Cube',         shortName: '2x2'   },\n  { id: '444',    name: '4x4x4 Cube',         shortName: '4x4'   },\n  { id: '555',    name: '5x5x5 Cube',         shortName: '5x5'   },\n  { id: '666',    name: '6x6x6 Cube',         shortName: '6x6'   },\n  { id: '777',    name: '7x7x7 Cube',         shortName: '7x7'   },\n  { id: '333bf',  name: '3x3x3 Blindfolded',  shortName: '3BLD'  },\n  { id: '333fm',  name: '3x3x3 Fewest Moves', shortName: 'FMC'   },\n  { id: '333oh',  name: '3x3x3 One-Handed',   shortName: '3OH'   },\n  { id: '333ft',  name: '3x3x3 With Feet',    shortName: '3WF'   },\n  { id: 'minx',   name: 'Megaminx',           shortName: 'Minx'  },\n  { id: 'pyram',  name: 'Pyraminx',           shortName: 'Pyra'  },\n  { id: 'clock',  name: 'Clock',              shortName: 'Clock' },\n  { id: 'skewb',  name: 'Skewb',              shortName: 'Skewb' },\n  { id: 'sq1',    name: 'Square-1',           shortName: 'Sq1'   },\n  { id: '444bf',  name: '4x4x4 Blindfolded',  shortName: '4BLD'  },\n  { id: '555bf',  name: '5x5x5 Blindfolded',  shortName: '5BLD'  },\n  { id: '333mbf', name: '3x3x3 Multi-Blind',  shortName: 'MBLD'  }\n];\n\nexport const eventNameById = eventId =>\n  propertyById('name', eventId);\n\nexport const shortEventNameById = eventId =>\n  propertyById('shortName', eventId);\n\nconst propertyById = (property, eventId) =>\n  events.find(event => event.id === eventId)[property];\n\nexport const sortWcifEvents = wcifEvents =>\n  sortBy(wcifEvents, wcifEvent => events.findIndex(event => event.id === wcifEvent.id));\n","import { mapIn, flatMap, zip, scaleToOne, isPresentDeep } from './utils';\nimport { getExtensionData, setExtensionData } from './wcif-extensions';\nimport { suggestedGroupCount, suggestedScramblerCount, suggestedRunnerCount } from './formulas';\nimport { eventNameById } from './events';\n\nexport const parseActivityCode = activityCode => {\n  const [, e, r, g, a] = activityCode.match(/(\\w+)(?:-r(\\d+))?(?:-g(\\d+))?(?:-a(\\d+))?/);\n  return {\n    eventId: e,\n    roundNumber: r && parseInt(r, 10),\n    groupNumber: g && parseInt(g, 10),\n    attemptNumber: a && parseInt(a, 10)\n  };\n};\n\nexport const activityCodeToName = activityCode => {\n  const { eventId, roundNumber, groupNumber, attemptNumber } = parseActivityCode(activityCode);\n  return [\n    eventId && eventNameById(eventId),\n    roundNumber && `Round ${roundNumber}`,\n    groupNumber && `Group ${groupNumber}`,\n    attemptNumber && `Attempt ${attemptNumber}`\n  ].filter(x => x).join(', ');\n};\n\nexport const hasDistributedAttempts = activityCode =>\n  ['333fm', '333mbf'].includes(parseActivityCode(activityCode).eventId);\n\nexport const activityDuration = activity =>\n  new Date(activity.endTime) - new Date(activity.startTime);\n\nexport const activitiesOverlap = (first, second) =>\n  first.startTime < second.endTime && second.startTime < first.endTime;\n\nexport const activitiesIntersection = (first, second) => {\n  if (!activitiesOverlap(first, second)) return 0;\n  const [, middleStart, middleEnd] = [first.startTime, first.endTime, second.startTime, second.endTime].sort();\n  /* Time distance between the two middle points in time. */\n  return new Date(middleEnd) - new Date(middleStart);\n};\n\nexport const rooms = wcif =>\n  flatMap(wcif.schedule.venues, venue => venue.rooms);\n\nexport const roomByActivity = (wcif, activityId) =>\n  rooms(wcif).find(room =>\n    room.activities.some(({ id }) => id === activityId)\n  );\n\nexport const stationsByActivity = (wcif, activityId) =>\n  getExtensionData('RoomConfig', roomByActivity(wcif, activityId)).stations\n\nconst allActivities = wcif => {\n  const allChildActivities = ({ childActivities }) =>\n    childActivities.length > 0\n      ? [...childActivities, ...flatMap(childActivities, allChildActivities)]\n      : childActivities;\n  const activities = flatMap(rooms(wcif), room => room.activities);\n  return [...activities, ...flatMap(activities, allChildActivities)];\n};\n\nexport const maxActivityId = wcif =>\n  Math.max(...allActivities(wcif).map(activity => activity.id));\n\n/* Assigning tasks invokes activityById enormous number of times.\n   But during that process activities (schedule) don't change.\n   Caching is gives an invaluable speed boost in this case. */\nconst activitiesByIdCachedBySchedule = new Map();\n\nexport const activityById = (wcif, activityId) => {\n  if (activitiesByIdCachedBySchedule.has(wcif.schedule)) {\n    return activitiesByIdCachedBySchedule.get(wcif.schedule).get(activityId);\n  } else {\n    const activities = allActivities(wcif);\n    const activitiesById = new Map(activities.map(activity => [activity.id, activity]));\n    activitiesByIdCachedBySchedule.set(wcif.schedule, activitiesById);\n    return activitiesById.get(activityId);\n  }\n}\n\nexport const updateActivity = (wcif, updatedActivity) =>\n  mapIn(wcif, ['schedule', 'venues'], venue =>\n    mapIn(venue, ['rooms'], room =>\n      mapIn(room, ['activities'], activity =>\n        activity.id === updatedActivity.id ? updatedActivity : activity\n      )\n    )\n  );\n\nexport const populateRoundActivitiesConfig = (wcif, expectedCompetitorsByRound, defaults) => {\n  const activitiesWithConfig = flatMap(wcif.events, event => {\n    return flatMap(event.rounds, round => {\n      const { roundNumber } = parseActivityCode(round.id);\n      const expectedRoundCompetitors = expectedCompetitorsByRound[round.id].length;\n      const activities = roundActivities(wcif, round.id).filter(shouldHaveGroups);\n      const capacities = scaleToOne(activities.map(activity =>\n        stationsByActivity(wcif, activity.id) * activityDuration(activity)\n      ));\n      return zip(activities, capacities).map(([activity, capacity]) => {\n        const stations = stationsByActivity(wcif, activity.id);\n        const competitors = Math.round(capacity * expectedRoundCompetitors);\n        const groups = suggestedGroupCount(competitors, stations, roundNumber);\n        const scramblers = defaults.assignScramblers ? suggestedScramblerCount(competitors / groups, stations) : 0;\n        const runners = defaults.assignRunners ? suggestedRunnerCount(competitors / groups, stations) : 0;\n        const assignJudges = stations > 0 && defaults.assignJudges;\n        return setExtensionData('ActivityConfig', activity, {\n          capacity, groups, scramblers, runners, assignJudges\n        });\n      });\n    });\n  });\n  return activitiesWithConfig.reduce(updateActivity, wcif);\n};\n\nexport const shouldHaveGroups = activity => {\n  const { eventId, roundNumber, groupNumber, attemptNumber } = parseActivityCode(activity.activityCode);\n  return !!(eventId && roundNumber && !groupNumber && !attemptNumber);\n};\n\nexport const anyActivityConfig = wcif =>\n  rooms(wcif).some(room =>\n    room.activities.some(activity => getExtensionData('ActivityConfig', activity))\n  );\n\nexport const activitiesConfigComplete = wcif =>\n  rooms(wcif).every(room =>\n    room.activities\n      .filter(shouldHaveGroups)\n      .map(activity => getExtensionData('ActivityConfig', activity))\n      .every(isPresentDeep)\n  );\n\nexport const roomsConfigComplete = wcif =>\n  rooms(wcif)\n    .map(room => getExtensionData('RoomConfig', room))\n    .every(isPresentDeep);\n\nexport const roundActivities = (wcif, roundId) =>\n  flatMap(rooms(wcif), room =>\n    room.activities.filter(({ activityCode }) => activityCode.startsWith(roundId))\n  );\n\nexport const groupActivitiesByRound = (wcif, roundId) =>\n  flatMap(roundActivities(wcif, roundId), activity =>\n    hasDistributedAttempts(roundId) ? [activity] : activity.childActivities\n  );\n\nexport const activityAssigned = (wcif, activityId) =>\n  wcif.persons.some(person =>\n    person.assignments.some(assignment => assignment.activityId === activityId)\n  );\n\nexport const groupActivitiesAssigned = (wcif, roundId) =>\n  groupActivitiesByRound(wcif, roundId).some(activity =>\n    activityAssigned(wcif, activity.id)\n  );\n\nexport const roundsMissingResults = wcif =>\n  wcif.events\n    .map(event => event.rounds.find(round => round.results.length === 0))\n    .filter(round => round);\n\nexport const roundsMissingAssignments = wcif =>\n  roundsMissingResults(wcif)\n    .filter(round => !groupActivitiesAssigned(wcif, round.id));\n\nexport const roundsMissingScorecards = wcif =>\n  roundsMissingResults(wcif)\n    .filter(round => groupActivitiesAssigned(wcif, round.id))\n    .filter(round => parseActivityCode(round.id).eventId !== '333fm');\n\nexport const allGroupsCreated = wcif =>\n  wcif.events.every(event =>\n    event.rounds.every(round =>\n      groupActivitiesByRound(wcif, round.id).length > 0\n    )\n  );\n\nexport const anyCompetitorAssignment = wcif =>\n  wcif.persons.some(person =>\n    person.assignments.some(assignment => assignment.assignmentCode === 'competitor')\n  );\n\nexport const anyGroupAssignedOrCreated = wcif =>\n  wcif.events.some(event =>\n    event.rounds.some(round =>\n      hasDistributedAttempts(event.id)\n        ? groupActivitiesAssigned(wcif, round.id)\n        : groupActivitiesByRound(wcif, round.id).length > 0\n    )\n  );\n\nexport const anyResults = wcif =>\n  wcif.events.some(event =>\n    event.rounds.some(round => round.results.length > 0)\n  );\n","export const suggestedGroupCount = (competitors, stations, roundNumber) => {\n  if (stations === 0) return 1;\n  const preferredGroupSize = stations * 1.7;\n  /* We calculate the number of perfectly-sized groups, and round it up starting from x.1,\n     this way we don't end up with much more than the perfect amount of people in a single group.\n     Having more small groups is preferred over having fewer big groups. */\n  const calculatedGroupCount = Math.round(competitors / preferredGroupSize + 0.4);\n  /* Suggest at least 2 groups for first rounds, so that there are people to scramble. */\n  return Math.max(calculatedGroupCount, roundNumber === 1 ? 2 : 1);\n};\n\n/* Take min{groupCompetitors, stations} (i.e. stations in use) and suggest one scrambler for each 5 of them. */\nexport const suggestedScramblerCount = (groupCompetitors, stations) =>\n  Math.floor(1 + (Math.min(groupCompetitors, stations) - 1) / 5);\n\n/* Take min{groupCompetitors, stations} (i.e. stations in use) and suggest one runner for each 8 of them. */\nexport const suggestedRunnerCount = (groupCompetitors, stations) =>\n  Math.floor(1 + (Math.min(groupCompetitors, stations) - 1) / 8);\n","import React from 'react';\nimport { Link } from 'react-router-dom';\nimport Icon from '@material-ui/core/Icon';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Paper from '@material-ui/core/Paper';\n\nimport { roomsConfigComplete, activitiesConfigComplete, anyCompetitorAssignment } from '../../../logic/activities';\n\nconst menuItems = [\n  { path: '/roles', text: \"Edit roles\", icon: 'perm_contact_calendar', enabled: wcif => true },\n  { path: '/config', text: \"Configure\", icon: 'settings', enabled: wcif => true },\n  { path: '/groups', text: \"Manage groups\", icon: 'people', enabled: wcif => roomsConfigComplete(wcif) && activitiesConfigComplete(wcif) },\n  { path: '/printing', text: \"Print documents\", icon: 'print', enabled: wcif => anyCompetitorAssignment(wcif) }\n];\n\nconst CompetitionMenu = ({ wcif, baseUrl }) => (\n  <Paper>\n    <List>\n      {menuItems.map(menuItem =>\n        <ListItem key={menuItem.path} button component={Link} to={`${baseUrl}${menuItem.path}`} disabled={!menuItem.enabled(wcif)}>\n          <ListItemIcon><Icon>{menuItem.icon}</Icon></ListItemIcon>\n          <ListItemText primary={menuItem.text} />\n        </ListItem>\n      )}\n    </List>\n  </Paper>\n);\n\nexport default CompetitionMenu;\n","import React from 'react';\nimport Typography from '@material-ui/core/Typography';\n\nconst RoomName = ({ room }) => (\n  <Typography variant=\"subtitle2\">\n    <span style={{\n        display: 'inline-block',\n        width: 10, height: 10, marginRight: 5,\n        borderRadius: '100%', backgroundColor: room.color\n      }}\n    />\n    <span>{room.name}</span>\n  </Typography>\n);\n\nexport default RoomName;\n","import React, { PureComponent } from 'react';\nimport TextField from '@material-ui/core/TextField';\n\nexport default class PositiveIntegerInput extends PureComponent {\n  /* Prevent from entering characters like minus, plus and dot.\n     These don't trigger the change event for numeric input. */\n  handleKeyPress = event => {\n    if (event.key.match(/\\D/)) event.preventDefault();\n  };\n\n  handleTextFieldChange = event => {\n    const newValue = event.target.value.length > 0 ? parseInt(event.target.value, 10) : null;\n    if (newValue === null || (!Number.isNaN(newValue) && newValue >= 1)) {\n      this.props.onChange(event, newValue);\n    }\n  };\n\n  render() {\n    const { value, onChange, ...props } = this.props;\n\n    return (\n      <TextField\n        {...props}\n        type=\"number\"\n        value={value === null ? '' : value}\n        onKeyPress={this.handleKeyPress}\n        onChange={this.handleTextFieldChange}\n      />\n    );\n  }\n};\n","import React, { PureComponent, Fragment } from 'react';\nimport Checkbox from '@material-ui/core/Checkbox';\n\nimport PositiveIntegerInput from '../PositiveIntegerInput/PositiveIntegerInput';\n\nexport default class ZeroablePositiveIntegerInput extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.inputRef = React.createRef();\n  }\n\n  handleCheckboxChange = event => {\n    const { checked } = event.target;\n    this.props.onChange(event, checked ? null : 0);\n  };\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.value === 0 && this.props.value !== 0) {\n      this.inputRef.current.focus();\n    }\n  }\n\n  render() {\n    const { value, disabled, ...props } = this.props;\n\n    return (\n      <Fragment>\n        <PositiveIntegerInput {...props} value={value} disabled={value === 0 || disabled} inputRef={this.inputRef} />\n        <Checkbox name={props.name} checked={value !== 0} onChange={this.handleCheckboxChange} disabled={disabled} />\n      </Fragment>\n    );\n  }\n};\n","import React, { Component } from 'react';\n\nimport RoomName from '../../../common/RoomName/RoomName';\nimport ZeroablePositiveIntegerInput from '../../../common/ZeroablePositiveIntegerInput/ZeroablePositiveIntegerInput';\nimport { setIn } from '../../../../logic/utils';\nimport { getExtensionData, setExtensionData } from '../../../../logic/wcif-extensions';\n\nexport default class RoomConfig extends Component {\n  handleInputChange = (event, value) => {\n    const { room, onChange } = this.props;\n    onChange(\n      setExtensionData('RoomConfig', room, setIn(\n        getExtensionData('RoomConfig', room), [event.target.name], value)\n      )\n    );\n  };\n\n  render() {\n    const { room, disabled } = this.props;\n    const { stations } = getExtensionData('RoomConfig', room);\n\n    return (\n      <div>\n        <RoomName room={room} />\n        <ZeroablePositiveIntegerInput\n          label=\"Timing stations\"\n          value={stations}\n          name=\"stations\"\n          onChange={this.handleInputChange}\n          disabled={disabled}\n        />\n      </div>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport Grid from '@material-ui/core/Grid';\nimport Paper from '@material-ui/core/Paper';\n\nimport RoomConfig from '../RoomConfig/RoomConfig';\nimport { mapIn } from '../../../../logic/utils';\nimport { anyActivityConfig, rooms } from '../../../../logic/activities';\n\nexport default class RoomsConfig extends Component {\n  handleRoomChange = updatedRoom => {\n    const { wcif, onWcifChange } = this.props;\n    onWcifChange(\n      mapIn(wcif, ['schedule', 'venues'], venue =>\n        mapIn(venue, ['rooms'], room =>\n          room.id === updatedRoom.id ? updatedRoom : room\n        )\n      )\n    );\n  };\n\n  render() {\n    const { wcif } = this.props;\n    /* Disable rooms configuration once activities config has been populated. */\n    const disabled = anyActivityConfig(wcif);\n\n    return (\n      <Paper style={{ padding: 16 }}>\n        <Grid container spacing={16}>\n          {rooms(wcif).map(room =>\n            <Grid item lg key={room.id}>\n              <RoomConfig room={room} onChange={this.handleRoomChange} disabled={disabled} />\n            </Grid>\n          )}\n        </Grid>\n      </Paper>\n    );\n  }\n}\n","import React from 'react';\n\nconst CubingIcon = ({ eventId, ...props }) => (\n  <span style={{ fontSize: 24 }} className={`cubing-icon event-${eventId}`} {...props} />\n);\n\nexport default CubingIcon;\n","import React, { Component } from 'react';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport IconButton from '@material-ui/core/IconButton';\n\nimport CubingIcon from '../CubingIcon/CubingIcon';\nimport { eventNameById } from '../../../logic/events';\n\nexport default class EventSelect extends Component {\n  render() {\n    const { selected, events } = this.props;\n\n    return (\n      <div>\n        {events.map(event => (\n          <Tooltip key={event.id} title={eventNameById(event.id)} placement=\"top\">\n            <IconButton onClick={() => this.props.onChange(event.id)}>\n              <CubingIcon eventId={event.id} style={{ opacity: event.id === selected ? 1 : 0.3 }} />\n            </IconButton>\n          </Tooltip>\n        ))}\n      </div>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport ExpansionPanel from '@material-ui/core/ExpansionPanel';\nimport ExpansionPanelDetails from '@material-ui/core/ExpansionPanelDetails';\nimport ExpansionPanelSummary from '@material-ui/core/ExpansionPanelSummary';\nimport Icon from '@material-ui/core/Icon';\nimport Typography from '@material-ui/core/Typography';\n\nimport { activityCodeToName } from '../../../../logic/activities';\n\nexport default class RoundWithGroups extends Component {\n  handlePanelChange = (event, expanded) => {\n    const { onChange, roundId } = this.props;\n    onChange(expanded ? roundId : null);\n  };\n\n  scrollToElement = node => {\n    /* Node is the panel content, so the panel is its parent. */\n    window.scrollTo({\n      top: node.parentNode.getBoundingClientRect().top - 8,\n      behavior: 'smooth'\n    });\n  };\n\n  render() {\n    const { expanded, roundId, render } = this.props;\n\n    return (\n      <ExpansionPanel\n        onChange={this.handlePanelChange}\n        expanded={expanded}\n        CollapseProps={{ onEntered: this.scrollToElement }}\n      >\n        <ExpansionPanelSummary expandIcon={<Icon>expand_more</Icon>}>\n          <Typography variant=\"subtitle1\">\n            {activityCodeToName(roundId)}\n          </Typography>\n        </ExpansionPanelSummary>\n        <ExpansionPanelDetails>\n          {expanded && render(roundId)}\n        </ExpansionPanelDetails>\n      </ExpansionPanel>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport Grid from '@material-ui/core/Grid';\n\nimport EventSelect from '../../common/EventSelect/EventSelect';\nimport RoundPanel from './RoundPanel/RoundPanel';\n\nexport default class RoundsNavigation extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      selectedEventId: props.events[0].id,\n      expandedRoundId: null\n    };\n  }\n\n  handleEventChange = eventId => {\n    this.setState({ selectedEventId: eventId });\n  };\n\n  handleRoundChange = roundId => {\n    this.setState({ expandedRoundId: roundId });\n  };\n\n  render() {\n    const { selectedEventId, expandedRoundId } = this.state;\n    const { events, render } = this.props;\n    const selectedEvent = events.find(event => event.id === selectedEventId);\n\n    return (\n      <Grid container spacing={8} justify=\"flex-end\">\n        <Grid item xs={12}>\n          <EventSelect selected={selectedEventId} events={events} onChange={this.handleEventChange} />\n        </Grid>\n        <Grid item xs={12}>\n          {selectedEvent.rounds.map(round => (\n            <RoundPanel\n              key={round.id}\n              expanded={round.id === expandedRoundId}\n              roundId={round.id}\n              render={render}\n              onChange={this.handleRoundChange}\n            />\n          ))}\n        </Grid>\n      </Grid>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport Grid from '@material-ui/core/Grid';\n\nimport PositiveIntegerInput from '../../../common/PositiveIntegerInput/PositiveIntegerInput';\nimport ZeroablePositiveIntegerInput from '../../../common/ZeroablePositiveIntegerInput/ZeroablePositiveIntegerInput';\nimport { setIn, pluralize } from '../../../../logic/utils';\nimport { getExtensionData, setExtensionData } from '../../../../logic/wcif-extensions';\nimport { activityAssigned } from '../../../../logic/activities';\n\nexport default class RoundActivityConfig extends Component {\n  handlePropertyChange = (property, value) => {\n    const { activity, onChange } = this.props;\n    onChange(\n      setExtensionData('ActivityConfig', activity, setIn(getExtensionData('ActivityConfig', activity), [property], value))\n    );\n  };\n\n  handleInputChange = (event, value) => {\n    this.handlePropertyChange(event.target.name, value);\n  };\n\n  handleCheckboxChange = event => {\n    const { name, checked } = event.target;\n    this.handlePropertyChange(name, checked);\n  };\n\n  shouldComponentUpdate(nextProps) {\n    return this.props.activity !== nextProps.activity;\n  }\n\n  render() {\n    const { activity, room, expectedCompetitors, wcif } = this.props;\n    const { groups, scramblers, runners, assignJudges, capacity } = getExtensionData('ActivityConfig', activity);\n\n    const stations = getExtensionData('RoomConfig', room).stations;\n    const competitors = Math.round(expectedCompetitors.length * capacity);\n    const groupSize = Math.round(competitors / groups);\n\n    const groupsHelperText = groups\n      ? pluralize(groupSize, 'person', 'people') + ' in group'\n      : ' ';\n    const scramblersHelperText = scramblers\n      ? pluralize(Math.round(groupSize / scramblers), 'cube') + ' per scrambler'\n      : ' ';\n    const runnersHelperText = runners\n      ? pluralize(Math.round(stations / runners), 'station') + ' per runner'\n      : ' ';\n\n    const groupsCreated = activity.childActivities.length > 0;\n    const groupsAssigned = activity.childActivities.some(({ id }) => activityAssigned(wcif, id));\n\n    return (\n      <Grid container direction=\"column\">\n        <Grid item>\n          <PositiveIntegerInput\n            label=\"Groups\"\n            value={groups}\n            name=\"groups\"\n            helperText={groupsHelperText}\n            onChange={this.handleInputChange}\n            margin=\"dense\"\n            disabled={groupsCreated || groupsAssigned}\n          />\n        </Grid>\n        <Grid item>\n          <ZeroablePositiveIntegerInput\n            label=\"Scramblers\"\n            value={scramblers}\n            name=\"scramblers\"\n            helperText={scramblersHelperText}\n            onChange={this.handleInputChange}\n            margin=\"dense\"\n            disabled={groupsAssigned}\n          />\n        </Grid>\n        <Grid item>\n          <ZeroablePositiveIntegerInput\n            label=\"Runners\"\n            value={runners}\n            name=\"runners\"\n            helperText={runnersHelperText}\n            onChange={this.handleInputChange}\n            margin=\"dense\"\n            disabled={groupsAssigned}\n          />\n        </Grid>\n        <Grid item>\n          <FormControlLabel\n            control={\n              <Checkbox\n                checked={assignJudges}\n                name=\"assignJudges\"\n                onChange={this.handleCheckboxChange}\n                disabled={stations === 0 || groupsAssigned}\n              />\n            }\n            label=\"Assign judges\"\n          />\n        </Grid>\n      </Grid>\n    );\n  }\n}\n","import React, { PureComponent } from 'react';\nimport Grid from '@material-ui/core/Grid';\n\nimport RoundActivityConfig from '../RoundActivityConfig/RoundActivityConfig';\nimport RoomName from '../../../common/RoomName/RoomName';\nimport { flatMap } from '../../../../logic/utils';\nimport { updateActivity, rooms } from '../../../../logic/activities';\n\nexport default class RoundConfig extends PureComponent {\n  handleActivityChange = activity => {\n    const { wcif, onWcifChange } = this.props;\n    onWcifChange(updateActivity(wcif, activity));\n  };\n\n  render() {\n    const { roundId, wcif, expectedCompetitorsByRound } = this.props;\n\n    const activitiesWithRooms = flatMap(rooms(wcif), room =>\n      room.activities\n        .filter(activity => activity.activityCode === roundId)\n        .map(activity => [activity, room])\n    );\n\n    return (\n      <Grid container spacing={16}>\n        {activitiesWithRooms.map(([activity, room]) =>\n          <Grid item xs key={activity.id}>\n            <RoomName room={room} />\n            <RoundActivityConfig\n              wcif={wcif}\n              activity={activity}\n              room={room}\n              onChange={this.handleActivityChange}\n              expectedCompetitors={expectedCompetitorsByRound[roundId]}\n            />\n          </Grid>\n        )}\n      </Grid>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport Button from '@material-ui/core/Button';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport Grid from '@material-ui/core/Grid';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport Paper from '@material-ui/core/Paper';\nimport Typography from '@material-ui/core/Typography';\n\nimport RoundsNavigation from '../../../common/RoundsNavigation/RoundsNavigation';\nimport RoundConfig from '../RoundConfig/RoundConfig';\nimport { populateRoundActivitiesConfig, anyActivityConfig, hasDistributedAttempts } from '../../../../logic/activities';\n\nexport default class RoundsConfig extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      assignScramblers: true,\n      assignRunners: true,\n      assignJudges: true\n    };\n  }\n\n  handleCheckboxChange = event => {\n    const { name, checked } = event.target;\n    this.setState({ [name]: checked });\n  };\n\n  handleNextClick = () => {\n    const { wcif, expectedCompetitorsByRound, onWcifChange } = this.props;\n    onWcifChange(populateRoundActivitiesConfig(wcif, expectedCompetitorsByRound, this.state));\n  };\n\n  render() {\n    const { wcif } = this.props;\n    const events = wcif.events.filter(event => !hasDistributedAttempts(event.id));\n\n    return anyActivityConfig(wcif) ? (\n      <RoundsNavigation events={events} render={this.renderRound} />\n    ) : (\n      <Paper style={{ padding: 16 }}>\n        <Typography variant=\"h5\">Generate configuration</Typography>\n        <Grid container direction=\"column\">\n          <Grid item style={{ margin: '0.5em 0' }}>\n            <Typography variant=\"body1\">\n              Which of the following roles would you like to assign?\n            </Typography>\n          </Grid>\n          {['Scramblers', 'Runners', 'Judges'].map(roleLabel =>\n            <Grid item key={roleLabel}>\n              <FormControlLabel\n                control={\n                  <Checkbox\n                    checked={this.state[`assign${roleLabel}`]}\n                    name={`assign${roleLabel}`}\n                    onChange={this.handleCheckboxChange}\n                  />\n                }\n                label={roleLabel}\n              />\n            </Grid>\n          )}\n        </Grid>\n        <Button onClick={this.handleNextClick}>\n          Next\n        </Button>\n      </Paper>\n    );\n  }\n\n  renderRound = roundId => {\n    const { wcif, expectedCompetitorsByRound, onWcifChange } = this.props;\n\n    return (\n      <RoundConfig\n        roundId={roundId}\n        expectedCompetitorsByRound={expectedCompetitorsByRound}\n        wcif={wcif}\n        onWcifChange={onWcifChange}\n      />\n    );\n  };\n}\n","import React, { Component } from 'react';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport Grid from '@material-ui/core/Grid';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport Paper from '@material-ui/core/Paper';\nimport TextField from '@material-ui/core/TextField';\nimport Typography from '@material-ui/core/Typography';\n\nimport { getExtensionData, setExtensionData } from '../../../../logic/wcif-extensions';\nimport { setIn } from '../../../../logic/utils';\n\nexport default class GeneralConfig extends Component {\n  handlePropertyChange = (property, value) => {\n    const { wcif, onWcifChange } = this.props;\n    onWcifChange(\n      setExtensionData('CompetitionConfig', wcif, setIn(getExtensionData('CompetitionConfig', wcif), [property], value))\n    );\n  };\n\n  handleCheckboxChange = event => {\n    const { name, checked } = event.target;\n    this.handlePropertyChange(name, checked);\n  };\n\n  handleTextFieldChange = event => {\n    const { name, value } = event.target;\n    this.handlePropertyChange(name, value);\n  };\n\n  render() {\n    const { wcif } = this.props;\n    const { localNamesFirst, scorecardsBackgroundUrl } = getExtensionData('CompetitionConfig', wcif);\n\n    return (\n      <Paper style={{ padding: 16 }}>\n        <Typography variant=\"h5\">Printing</Typography>\n        <Grid container direction=\"column\">\n          <Grid item>\n            <FormControlLabel\n              control={\n                <Checkbox\n                  name=\"localNamesFirst\"\n                  checked={localNamesFirst}\n                  onChange={this.handleCheckboxChange}\n                />\n              }\n              label=\"Swap latin names with local ones\"\n            />\n          </Grid>\n          <Grid item>\n            <TextField\n              label=\"Scorecards background image URL\"\n              name=\"scorecardsBackgroundUrl\"\n              value={scorecardsBackgroundUrl || ''}\n              onChange={this.handleTextFieldChange}\n              fullWidth\n            />\n          </Grid>\n        </Grid>\n      </Paper>\n    );\n  }\n}\n","const searchParams = new URLSearchParams(window.location.search);\nconst production = process.env.NODE_ENV === 'production' && !searchParams.get('staging');\n\nexport const WCA_ORIGIN = production\n  ? 'https://www.worldcubeassociation.org'\n  : 'https://staging.worldcubeassociation.org';\n\nexport const WCA_OAUTH_CLIENT_ID = production\n  ? '7af43bdb765a9b555e09cc575351d15acee640c0db098626e40e8d1ee352ec3a'\n  : 'example-application-id';\n","import { WCA_ORIGIN, WCA_OAUTH_CLIENT_ID } from './wca-env';\n\n/* Use separate set of keys for each OAuth client (e.g. for WCA production and staging). */\nconst localStorageKey = key => `GroupifierNext.${WCA_OAUTH_CLIENT_ID}.${key}`;\n\n/**\n * Checks the URL hash for presence of OAuth access token\n * and saves it in the local storage if it's found.\n * Should be called on application initialization (before any kind of router takes over the location).\n */\nexport const initializeAuth = () => {\n  const hash = window.location.hash.replace(/^\\W*/, '');\n  const hashParams = new URLSearchParams(hash);\n  if (hashParams.has('access_token')) {\n    localStorage.setItem(localStorageKey('accessToken'), hashParams.get('access_token'));\n  }\n  if (hashParams.has('expires_in')) {\n    /* Expire the token 15 minutes before it actually does,\n       this way it doesn't expire right after the user enters the page. */\n    const expiresInSeconds = hashParams.get('expires_in') - 15 * 60;\n    const expirationTime = new Date(new Date().getTime() + expiresInSeconds * 1000);\n    localStorage.setItem(localStorageKey('expirationTime'), expirationTime.toISOString());\n  }\n  /* If the token expired, sign the user out. */\n  const expirationTime = localStorage.getItem(localStorageKey('expirationTime'));\n  if (expirationTime && new Date() >= new Date(expirationTime)) {\n    signOut();\n  }\n  /* Clear the hash only if there is a token, otherwise it may be a router path. */\n  if (hashParams.has('access_token')) {\n    window.location.hash = '';\n  }\n};\n\nexport const wcaAccessToken = () =>\n  localStorage.getItem(localStorageKey('accessToken'));\n\nexport const signIn = () => {\n  const params = new URLSearchParams({\n    client_id: WCA_OAUTH_CLIENT_ID,\n    response_type: 'token',\n    redirect_uri: oauthRedirectUri(),\n    scope: 'manage_competitions'\n  });\n  window.location = `${WCA_ORIGIN}/oauth/authorize?${params.toString()}`\n};\n\nconst oauthRedirectUri = () => {\n  const { origin, pathname, search } = window.location;\n  const searchParams = new URLSearchParams(search);\n  const staging = searchParams.get('staging');\n  const appUri = `${origin}${pathname}`.replace(/\\/$/, '');\n  return staging ? `${appUri}?staging=true` : appUri;\n};\n\nexport const signOut = () =>\n  localStorage.removeItem(localStorageKey('accessToken'));\n\nexport const isSignedIn = () => !!wcaAccessToken();\n","import { wcaAccessToken } from './auth';\nimport { WCA_ORIGIN } from './wca-env';\nimport { pick } from './utils';\n\nexport const getUpcomingManageableCompetitions = () => {\n  const oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\n  const params = new URLSearchParams({\n    managed_by_me: true,\n    start: oneWeekAgo.toISOString()\n  });\n  return wcaApiFetch(`/competitions?${params.toString()}`);\n};\n\nexport const getWcif = competitionId =>\n  wcaApiFetch(`/competitions/${competitionId}/wcif`);\n\nconst updateWcif = (competitionId, wcif) =>\n  wcaApiFetch(`/competitions/${competitionId}/wcif`, {\n    method: 'PATCH',\n    body: JSON.stringify(wcif)\n  });\n\nexport const saveWcifChanges = (previousWcif, newWcif) => {\n  const keysDiff = Object.keys(newWcif).filter(key => previousWcif[key] !== newWcif[key]);\n  if (keysDiff.length === 0) return Promise.resolve();\n  return updateWcif(newWcif.id, pick(newWcif, keysDiff));\n};\n\nconst wcaApiFetch = (path, fetchOptions = {}) => {\n  const baseApiUrl = `${WCA_ORIGIN}/api/v0`;\n\n  return fetch(`${baseApiUrl}${path}`, Object.assign({}, fetchOptions, {\n    headers: new Headers({\n      'Authorization': `Bearer ${wcaAccessToken()}`,\n      'Content-Type': 'application/json'\n    })\n  }))\n  .then(response => {\n    if (!response.ok) throw new Error(response.statusText);\n    return response;\n  })\n  .then(response => response.json());\n};\n","import React, { Component, Fragment } from 'react';\nimport Button from '@material-ui/core/Button';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Snackbar from '@material-ui/core/Snackbar';\n\nimport { saveWcifChanges } from '../../../logic/wca-api';\n\nexport default class SaveWcifButton extends Component {\n  state = {\n    saving: false,\n    failed: false\n  };\n\n  handleSaveClick = () => {\n    const { wcif, updatedWcif, onWcifUpdate, history } = this.props;\n    this.setState({ saving: true, failed: false });\n    saveWcifChanges(wcif, updatedWcif)\n      .then(() => {\n        onWcifUpdate(updatedWcif);\n        history.push(`/competitions/${updatedWcif.id}`);\n      })\n      .catch(() => this.setState({ saving: false, failed: true }));\n  };\n\n  handleSnackbarClose = () => {\n    this.setState({ failed: false });\n  };\n\n  render() {\n    const { saving, failed } = this.state;\n    const { disabled } = this.props;\n    return (\n      <Fragment>\n        <Snackbar\n          open={failed}\n          message=\"Failed to save data to the WCA website.\"\n          anchorOrigin={{\n            vertical: 'bottom',\n            horizontal: 'left',\n          }}\n          autoHideDuration={5000}\n          onClose={this.handleSnackbarClose}\n        />\n        <Button variant=\"contained\" color=\"primary\" onClick={this.handleSaveClick} disabled={disabled || saving}>\n          <span style={saving ? { visibility: 'hidden' } : {}}>Save</span>\n          {saving && <CircularProgress size={20} style={{ position: 'absolute' }} />}\n        </Button>\n      </Fragment>\n    );\n  }\n}\n","import { parseActivityCode, activityCodeToName, activityById } from './activities';\nimport { sortBy, sortByArray } from './utils';\n\nexport const best = (person, eventId, type) => {\n  if (!['single', 'average'].includes(type)) {\n    throw new Error(`Personal best type must be either 'single' or 'average'. Received '${type}'.`);\n  }\n  const personalBest = person.personalBests.find(pb => pb.eventId === eventId && pb.type === type);\n  return personalBest ? personalBest.best : Infinity;\n};\n\nexport const bestAverageAndSingle = (competitor, eventId) =>\n  [best(competitor, eventId, 'average'), best(competitor, eventId, 'single')];\n\nconst competitorsExpectedToAdvance = (sortedCompetitors, advancementCondition, eventId) => {\n  switch (advancementCondition.type) {\n    case 'ranking':\n      return sortedCompetitors.slice(0, advancementCondition.level);\n    case 'percent':\n      return sortedCompetitors.slice(0, Math.floor(sortedCompetitors.length * advancementCondition.level * 0.01));\n    case 'attemptResult':\n      /* Assume that competitors having personal best better than the advancement condition will make it to the next round. */\n      return sortedCompetitors.filter(person => best(person, eventId, 'single') < advancementCondition.level);\n    default:\n      throw new Error(`Unrecognised AdvancementCondition type: '${advancementCondition.type}'`);\n  }\n};\n\nexport const getExpectedCompetitorsByRound = wcif =>\n  wcif.events.reduce((expectedCompetitorsByRound, event) => {\n    const [firstRound, ...nextRounds] = event.rounds;\n    expectedCompetitorsByRound[firstRound.id] = sortByArray(\n      acceptedPeopleRegisteredForEvent(wcif, event.id),\n      competitor => bestAverageAndSingle(competitor, event.id)\n    );\n    nextRounds.reduce(([round, competitors], nextRound) => {\n      const advancementCondition = round.advancementCondition;\n      if (!advancementCondition) throw new Error(`Mising advancement condition for ${activityCodeToName(round.id)}.`);\n      const nextRoundCompetitors = competitorsExpectedToAdvance(competitors, advancementCondition, event.id);\n      expectedCompetitorsByRound[nextRound.id] = nextRoundCompetitors;\n      return [nextRound, nextRoundCompetitors];\n    }, [firstRound, expectedCompetitorsByRound[firstRound.id]]);\n    return expectedCompetitorsByRound;\n  }, {});\n\nconst satisfiesAdvancementCondition = (result, advancementCondition, resultCount) => {\n  const { type, level } = advancementCondition;\n  if (type === 'ranking') return result.ranking <= level;\n  if (type === 'percent') return result.ranking <= Math.floor(resultCount * level * 0.01);\n  if (type === 'attemptResult') return result.attempts.some(attempt => attempt.result > 0 && attempt.result < level);\n  throw new Error(`Unrecognised AdvancementCondition type: '${type}'`);\n};\n\nexport const advancingResults = (results, advancementCondition) => {\n  const sortedResults = sortBy(\n    results.filter(result => result.attempts.length > 0),\n    result => result.ranking\n  );\n  const maxAdvanceable = Math.floor(sortedResults.length * 0.75); /* See: https://www.worldcubeassociation.org/regulations/#9p1 */\n  const firstNonAdvancingRank = sortedResults[maxAdvanceable].ranking;\n  /* Note: this ensures that people who tied either advance altogether or not. */\n  return sortedResults\n    .filter(result => result.ranking < firstNonAdvancingRank)\n    .filter(result => satisfiesAdvancementCondition(result, advancementCondition, sortedResults.length));\n};\n\nexport const competitorsForRound = (wcif, roundId) => {\n  const { eventId, roundNumber } = parseActivityCode(roundId);\n  if (roundNumber === 1) {\n    return sortByArray(\n      acceptedPeopleRegisteredForEvent(wcif, eventId),\n      competitor => bestAverageAndSingle(competitor, eventId).map(result => -result)\n    );\n  } else {\n    const previousRound = wcif.events\n      .find(event => event.id === eventId).rounds\n      .find(round => parseActivityCode(round.id).roundNumber === roundNumber - 1);\n    const { results, advancementCondition } = previousRound;\n    return sortBy(advancingResults(results, advancementCondition), result => -result.ranking)\n      .map(result => wcif.persons.find(person => person.registrantId === result.personId));\n  }\n};\n\nexport const age = person => {\n  const diffMs = Date.now() - new Date(person.birthdate).getTime();\n  return Math.floor(diffMs / (1000 * 60 * 60 * 24 * 365.2425));\n}\n\nexport const staffAssignments = person =>\n  person.assignments.filter(({ assignmentCode }) => assignmentCode.startsWith('staff-'));\n\nexport const staffAssignmentsForEvent = (wcif, person, eventId) =>\n  staffAssignments(person).filter(({ activityId }) =>\n    parseActivityCode(activityById(wcif, activityId).activityCode).eventId === eventId\n  );\n\nexport const acceptedPeople = wcif =>\n  wcif.persons.filter(person => person.registration && person.registration.status === 'accepted');\n\nconst acceptedPeopleRegisteredForEvent = (wcif, eventId) =>\n  acceptedPeople(wcif).filter(({ registration }) => registration.eventIds.includes(eventId));\n\nexport const hasAssignment = (person, activityId, assignmentCode) =>\n  person.assignments.some(assignment =>\n    assignment.activityId === activityId && assignment.assignmentCode === assignmentCode\n  );\n","import React, { Component } from 'react';\nimport { Link } from 'react-router-dom';\nimport AppBar from '@material-ui/core/AppBar';\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport Tab from '@material-ui/core/Tab';\nimport Tabs from '@material-ui/core/Tabs';\n\nimport RoomsConfig from './RoomsConfig/RoomsConfig';\nimport RoundsConfig from './RoundsConfig/RoundsConfig';\nimport GeneralConfig from './GeneralConfig/GeneralConfig';\nimport SaveWcifButton from '../../common/SaveWcifButton/SaveWcifButton';\nimport { getExpectedCompetitorsByRound } from '../../../logic/competitors';\nimport { roomsConfigComplete, activitiesConfigComplete, anyGroupAssignedOrCreated } from '../../../logic/activities';\nimport { removeExtensionData } from '../../../logic/wcif-extensions';\nimport { mapIn } from '../../../logic/utils';\n\nexport default class ConfigManager extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      localWcif: props.wcif,\n      tabValue: 0\n    };\n    this.expectedCompetitorsByRound = getExpectedCompetitorsByRound(props.wcif);\n  }\n\n  handleWcifChange = wcif => {\n    this.setState({ localWcif: wcif });\n  };\n\n  handleTabChange = (event, value) => {\n    this.setState({ tabValue: value });\n  };\n\n  clearConfig = () => {\n    const { localWcif } = this.state;\n    const withoutCompetitionConfig = removeExtensionData('CompetitionConfig', localWcif);\n    this.setState({\n      tabValue: 0,\n      localWcif: mapIn(withoutCompetitionConfig, ['schedule', 'venues'], venue =>\n        mapIn(venue, ['rooms'], room =>\n          removeExtensionData(\n            'RoomConfig',\n            mapIn(room, ['activities'], activity => removeExtensionData('ActivityConfig', activity))\n          )\n        )\n      )\n    });\n  };\n\n  render() {\n    const { tabValue, localWcif } = this.state;\n    const { wcif, onWcifUpdate, history } = this.props;\n\n    const wcifConfigComplete = roomsConfigComplete(localWcif) && activitiesConfigComplete(localWcif);\n\n    return (\n      <Grid container spacing={8} justify=\"flex-end\">\n        <Grid item xs={12}>\n          <AppBar position=\"static\" color=\"default\">\n            <Tabs value={tabValue} onChange={this.handleTabChange} centered>\n              <Tab label=\"Rooms\" />\n              <Tab label=\"Rounds\" disabled={!roomsConfigComplete(localWcif)} />\n              <Tab label=\"General\" />\n            </Tabs>\n          </AppBar>\n        </Grid>\n        <Grid item xs={12}>\n          {tabValue === 0 && (\n            <RoomsConfig wcif={localWcif} onWcifChange={this.handleWcifChange} />\n          )}\n          {tabValue === 1 && (\n            <RoundsConfig wcif={localWcif} onWcifChange={this.handleWcifChange} expectedCompetitorsByRound={this.expectedCompetitorsByRound} />\n          )}\n          {tabValue === 2 && (\n            <GeneralConfig wcif={localWcif} onWcifChange={this.handleWcifChange} />\n          )}\n        </Grid>\n        <Grid item>\n          <Button variant=\"contained\" component={Link} to={`/competitions/${localWcif.id}`}>\n            Cancel\n          </Button>\n        </Grid>\n        <Grid item>\n          <Button variant=\"contained\" onClick={this.clearConfig} disabled={anyGroupAssignedOrCreated(localWcif)}>\n            Clear\n          </Button>\n        </Grid>\n        <Grid item>\n          <SaveWcifButton wcif={wcif} updatedWcif={localWcif} onWcifUpdate={onWcifUpdate} history={history} disabled={!wcifConfigComplete} />\n        </Grid>\n      </Grid>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Grid from '@material-ui/core/Grid';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Typography from '@material-ui/core/Typography';\n\nimport { activityCodeToName } from '../../../../logic/activities';\nimport { hasAssignment } from '../../../../logic/competitors';\nimport { sortBy } from '../../../../logic/utils';\n\nexport default class GroupDialog extends Component {\n  render() {\n    const { wcif, groupActivity, onClose, open } = this.props;\n\n    const roles = [\n      { id: 'competitor', label: 'Competitors' },\n      { id: 'staff-scrambler', label: 'Scramblers' },\n      { id: 'staff-runner', label: 'Runners' },\n      { id: 'staff-judge', label: 'Judges' },\n    ];\n\n    const rolesWithPeople = roles.map(role => [\n      role,\n      wcif.persons.filter(person =>\n        hasAssignment(person, groupActivity.id, role.id)\n      )\n    ])\n    .filter(([role, people]) => people.length > 0);\n\n    return (\n      <Dialog open={open} onClose={onClose} maxWidth={false}>\n        <DialogTitle>{activityCodeToName(groupActivity.activityCode)}</DialogTitle>\n        <DialogContent>\n          <Grid container spacing={16}>\n            {rolesWithPeople.map(([role, people]) => (\n              <Grid item xs={12} sm={6} md key={role.id}>\n                <Typography variant=\"subtitle2\">{role.label}</Typography>\n                <List dense={true} style={{ overflowY: 'auto', maxHeight: 300 }}>\n                  {sortBy(people, person => person.name).map(person => (\n                    <ListItem key={person.wcaUserId}>\n                      <ListItemText primary={person.name} />\n                    </ListItem>\n                  ))}\n                </List>\n              </Grid>\n            ))}\n            {rolesWithPeople.length === 0 && (\n              <Grid item>\n                <Typography variant=\"body2\">No assignments for this round.</Typography>\n              </Grid>\n            )}\n          </Grid>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={onClose} color=\"secondary\">\n            Ok\n          </Button>\n        </DialogActions>\n      </Dialog>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport Grid from '@material-ui/core/Grid';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemText from '@material-ui/core/ListItemText';\n\nimport RoundsNavigation from '../../../common/RoundsNavigation/RoundsNavigation';\nimport RoomName from '../../../common/RoomName/RoomName';\nimport GroupDialog from '../GroupDialog/GroupDialog';\nimport { parseActivityCode, hasDistributedAttempts } from '../../../../logic/activities';\nimport { flatMap, shortTime } from '../../../../logic/utils';\n\nexport default class RoundWithGroups extends Component {\n  state = {\n    openedGroupActivity: null\n  };\n\n  handleGroupClick = groupActivity => {\n    this.setState({ openedGroupActivity: groupActivity });\n  };\n\n  handleDialogClose = () => {\n    this.setState({ openedGroupActivity: null });\n  };\n\n  render() {\n    const { openedGroupActivity } = this.state;\n    const { wcif } = this.props;\n    const events = wcif.events.filter(event => !hasDistributedAttempts(event.id));\n\n    return (\n      <React.Fragment>\n        <RoundsNavigation events={events} render={this.renderRound} />\n        {openedGroupActivity && (\n          <GroupDialog\n            open={true}\n            groupActivity={openedGroupActivity}\n            wcif={wcif}\n            onClose={this.handleDialogClose}\n          />\n        )}\n      </React.Fragment>\n    );\n  }\n\n  renderRound = roundId => {\n    const { wcif } = this.props;\n    const roomsWithTimezoneAndGroups = flatMap(wcif.schedule.venues, venue =>\n      venue.rooms.map(room =>\n        [room, venue.timezone, flatMap(\n          room.activities.filter(activity => activity.activityCode === roundId),\n          activity => activity.childActivities\n        )]\n      )\n    );\n\n    return (\n      <Grid container>\n        {roomsWithTimezoneAndGroups.map(([room, timezone, groupActivities]) => (\n          groupActivities.length > 0 && (\n            <Grid item xs={12} sm key={room.id}>\n              <RoomName room={room} />\n              <List>\n                {groupActivities.map(groupActivity => (\n                  <ListItem key={groupActivity.id} button onClick={() => this.handleGroupClick(groupActivity)}>\n                    <ListItemText\n                      primary={`Group ${parseActivityCode(groupActivity.activityCode).groupNumber}`}\n                      secondary={`${shortTime(groupActivity.startTime, timezone)} - ${shortTime(groupActivity.endTime, timezone)}`}\n                    />\n                  </ListItem>\n                ))}\n              </List>\n            </Grid>\n          )\n        ))}\n      </Grid>\n    );\n  };\n}\n","import { addMilliseconds, difference, findLast, flatMap, intersection, isoTimeDiff, partition,\n         scaleToOne, setIn, sortBy, sortByArray, sum, uniq, updateIn, mapIn, zip } from './utils';\nimport { getExtensionData } from './wcif-extensions';\nimport { activitiesIntersection, activitiesOverlap, activityById, activityCodeToName,\n         activityDuration, hasDistributedAttempts, maxActivityId, parseActivityCode,\n         roundActivities, groupActivitiesByRound, roundsMissingAssignments, stationsByActivity, updateActivity } from './activities';\nimport { acceptedPeople, age, bestAverageAndSingle, competitorsForRound, hasAssignment, staffAssignments, staffAssignmentsForEvent } from './competitors';\n\nexport const createGroupActivities = wcif => {\n  const rounds = flatMap(wcif.events, event => event.rounds);\n  return rounds.reduce((wcif, round) => {\n    /* For FMC and MBLD the activities are already scheduled, and there is always a single group. */\n    if (hasDistributedAttempts(round.id)) return wcif;\n    /* If there are already groups created, don't override them. */\n    if (groupActivitiesByRound(wcif, round.id).length > 0) return wcif;\n    const currentActivityId = maxActivityId(wcif);\n    const activitiesWithGroups = roundActivities(wcif, round.id).map(activity => {\n      const { groups } = getExtensionData('ActivityConfig', activity);\n      const totalDuration = activityDuration(activity);\n      const groupDuration = totalDuration / groups;\n      const groupActivities = Array.from({ length: groups }, (_, index) => ({\n        id: null,\n        name: null,\n        activityCode: null,\n        startTime: addMilliseconds(activity.startTime, groupDuration * index),\n        endTime: addMilliseconds(activity.startTime, groupDuration * index + groupDuration),\n        childActivities: [],\n        scrambleSetId: null\n      }));\n      return { ...activity, childActivities: groupActivities };\n    });\n    sortByArray(\n      flatMap(activitiesWithGroups, activity => activity.childActivities),\n      ({ startTime, endTime }) => [startTime, endTime]\n    ).forEach((groupActivity, index) => {\n      const activityCode = `${round.id}-g${index + 1}`;\n      /* The child activities are newly created objects, so it's fine to mutate them at this point. */\n      return Object.assign(groupActivity, {\n        id: currentActivityId + index + 1,\n        name: activityCodeToName(activityCode),\n        activityCode\n      })\n    });\n    return activitiesWithGroups.reduce(updateActivity, wcif);\n  }, wcif);\n};\n\nexport const assignTasks = wcif => {\n  const roundsToAssign = roundsMissingAssignments(wcif);\n  return [assignGroups, assignScrambling, assignRunning, assignJudging]\n    .reduce((wcif, assignmentFn) => assignmentFn(wcif, roundsToAssign), wcif);\n};\n\nconst assignGroups = (wcif, roundsToAssign) => {\n  /* Sort rounds by the number of groups, so the further the more possible timeframes there are. */\n  const sortedRoundsToAssign = sortBy(roundsToAssign, round =>\n    hasDistributedAttempts(round.id) ? -Infinity : groupActivitiesByRound(wcif, round.id).length\n  );\n  return sortedRoundsToAssign.reduce((wcif, round) => {\n    const competitors = competitorsForRound(wcif, round.id);\n    if (hasDistributedAttempts(round.id)) {\n      /* In this case roundActivities are attempt activities, so we assign them all to the given person. */\n      const updatedCompetitors = roundActivities(wcif, round.id).reduce((competitors, activity) =>\n        assignActivity(activity.id, 'competitor', competitors)\n      , competitors);\n      return updatePeople(wcif, updatedCompetitors);\n    }\n    const groupActivitiesWithCapacity = flatMap(roundActivities(wcif, round.id), activity => {\n      const { capacity } = getExtensionData('ActivityConfig', activity);\n      return activity.childActivities.map(groupActivity =>\n        [groupActivity, capacity / activity.childActivities.length]\n      );\n    });\n    const [groupActivities, capacities] = zip(...groupActivitiesWithCapacity);\n    const groupSizes = calculateGroupSizes(capacities, competitors.length);\n    const initialGroups = zip(groupActivities, groupSizes).map(([activity, size]) => ({\n      id: activity.id,\n      activity,\n      size,\n      competitors: []\n    }));\n    const sortedInitialGroups = sortBy(initialGroups, ({ activity }) => parseActivityCode(activity.activityCode).groupNumber);\n    const groups = competitors.reduce((groups, competitor) => {\n      const availabilityRates = groups.map(group => availabilityRate(wcif, group.activity, competitor));\n      const maxAvailabilityRate = Math.max(...availabilityRates);\n      const mostAvailableGroups = groups.filter((group, index) => availabilityRates[index] === maxAvailabilityRate);\n      const preferredGroups = mostAvailableGroups.filter(group => !overlapsEveryoneWithSameRole(wcif, groups, group.activity, competitor));\n      const potentialGroups = preferredGroups.length > 0 ? preferredGroups : mostAvailableGroups;\n      const notFullGroup = potentialGroups.find(({ size, competitors }) => competitors.length < size);\n      if (notFullGroup) {\n        return addCompetitorToGroupEnd(groups, notFullGroup.id, competitor);\n      } else {\n        const group = potentialGroups[potentialGroups.length - 1];\n        const updatedGroups = addCompetitorToGroupEnd(groups, group.id, competitor);\n        return moveSomeoneRight(wcif, updatedGroups, group.id) || moveSomeoneLeft(wcif, updatedGroups, group.id) || updatedGroups;\n      }\n    }, sortedInitialGroups);\n    const updatedCompetitors = flatMap(groups, ({ activity, competitors }) =>\n      assignActivity(activity.id, 'competitor', competitors)\n    );\n    return updatePeople(wcif, updatedCompetitors);\n  }, wcif);\n};\n\nconst calculateGroupSizes = ([capacity, ...capacities], competitorCount) => {\n  if (!capacity) return [];\n  const groupSize = Math.round(capacity * competitorCount);\n  return [groupSize, ...calculateGroupSizes(scaleToOne(capacities), competitorCount - groupSize)];\n};\n\nconst moveSomeoneRight = (wcif, groups, groupId) => {\n  const group = groups.find(({ id }) => id === groupId);\n  return groups.slice(groups.indexOf(group) + 1).reduce((updatedGroups, furtherGroup) => {\n    if (updatedGroups) return updatedGroups;\n    const competitorToMove = findLast(group.competitors, competitor =>\n      availabilityRate(wcif, group.activity, competitor) === availabilityRate(wcif, furtherGroup.activity, competitor)\n      && !overlapsEveryoneWithSameRole(wcif, groups, furtherGroup.activity, competitor)\n    );\n    if (!competitorToMove) return null; // Try the next group.\n    if (furtherGroup.competitors.length < furtherGroup.size) {\n      return moveCompetitorToGroupStart(groups, groupId, furtherGroup.id, competitorToMove);\n    } else if (furtherGroup.competitors.length === furtherGroup.size) {\n      const groupsWithSpot = moveSomeoneRight(wcif, groups, furtherGroup.id);\n      return groupsWithSpot && moveCompetitorToGroupStart(groupsWithSpot, groupId, furtherGroup.id, competitorToMove);\n    }\n    return null;\n  }, null);\n};\n\nconst moveSomeoneLeft = (wcif, groups, groupId) => {\n  const group = groups.find(({ id }) => id === groupId);\n  return groups.slice(0, groups.indexOf(group)).reduceRight((updatedGroups, previousGroup) => {\n    if (updatedGroups) return updatedGroups;\n    const competitorToMove = group.competitors.find(competitor =>\n      availabilityRate(wcif, group.activity, competitor) === availabilityRate(wcif, previousGroup.activity, competitor)\n      && !overlapsEveryoneWithSameRole(wcif, groups, previousGroup.activity, competitor)\n    );\n    if (!competitorToMove) return null; // Try the previous group.\n    const groupsWithSpot = moveSomeoneRight(wcif, groups, previousGroup.id);\n    return groupsWithSpot && moveCompetitorToGroupEnd(groupsWithSpot, groupId, previousGroup.id, competitorToMove);\n  }, null);\n};\n\nconst updateCompetitorsInGroup = (groups, groupId, updater) =>\n  groups.map(group => group.id === groupId ? updateIn(group, ['competitors'], updater) : group);\n\nconst addCompetitorToGroupStart = (groups, groupId, competitor) =>\n  updateCompetitorsInGroup(groups, groupId, competitors => [competitor, ...competitors]);\n\nconst addCompetitorToGroupEnd = (groups, groupId, competitor) =>\n  updateCompetitorsInGroup(groups, groupId, competitors => [...competitors, competitor]);\n\nconst removeCompetitorFromGroup = (groups, groupId, competitor) =>\n  updateCompetitorsInGroup(groups, groupId, competitors => competitors.filter(other => other !== competitor));\n\nconst moveCompetitorToGroupStart = (groups, fromGroupId, toGroupId, competitor) =>\n  addCompetitorToGroupStart(removeCompetitorFromGroup(groups, fromGroupId, competitor), toGroupId, competitor);\n\nconst moveCompetitorToGroupEnd = (groups, fromGroupId, toGroupId, competitor) =>\n  addCompetitorToGroupEnd(removeCompetitorFromGroup(groups, fromGroupId, competitor), toGroupId, competitor);\n\nconst assignScrambling = (wcif, roundsToAssign) => {\n  /* Sort rounds by the number of competitors, so the further the more people able to scramble there are. */\n  const sortedRoundsToAssign = sortBy(roundsToAssign, round => competitorsForRound(wcif, round.id).length);\n  return sortedRoundsToAssign.reduce((wcif, round) => {\n    if (hasDistributedAttempts(round.id)) return wcif;\n    const { eventId } = parseActivityCode(round.id);\n    return roundActivities(wcif, round.id).reduce((wcif, activity) => {\n      const { scramblers } = getExtensionData('ActivityConfig', activity);\n      if (scramblers === 0) return wcif;\n      return activity.childActivities.reduce((wcif, groupActivity) => {\n        const staffScramblers = acceptedPeople(wcif).filter(person => person.roles.includes('staff-scrambler'));\n        const competitors = difference(competitorsForRound(wcif, round.id), staffScramblers);\n        const available = people => people.filter(person => availableDuring(wcif, groupActivity, person));\n        const sortedAvailableStaff = sortByArray(available(staffScramblers), competitor => [\n          /* Avoid difference in the number of tasks bigger than 3.\n             (General note: this is better than sorting by the number of tasks,\n             as it allows one person to be assigned a couple times in a row). */\n          Math.floor(staffAssignments(competitor).length / 3),\n          /* Prefer competitors who doesn't solve soon after the group ends. */\n          competesIn15Minutes(wcif, competitor, groupActivity.endTime) ? 1 : -1,\n          /* Prefer competitors better in the given event. */\n          ...bestAverageAndSingle(competitor, eventId)\n        ]);\n        const sortedAvailableCompetitors = sortedAvailableStaff.length >= scramblers ? [] : sortByArray(available(competitors), competitor => [\n          /* Strongly prefer people at least 10 years old. */\n          age(competitor) >= 10 ? -1 : 1,\n          /* Avoid assigning tasks to people already busy due to their role. */\n          intersection(['dataentry', 'delegate', 'organizer'], competitor.roles).length,\n          /* Avoid more than two assignments for the given event. */\n          staffAssignmentsForEvent(wcif, competitor, eventId).length >= 2 ? 1 : -1,\n          /* Prefer competitors that are likely to be on the venue. */\n          -presenceRate(wcif, competitor, groupActivity.startTime),\n          /* Avoid difference in the number of tasks bigger than 6. */\n          Math.floor(staffAssignments(competitor).length / 6),\n          /* Prefer competitors who doesn't solve soon after the group ends. */\n          competesIn15Minutes(wcif, competitor, groupActivity.endTime) ? 1 : -1,\n          /* Prefer competitors better in the given event. */\n          ...bestAverageAndSingle(competitor, eventId)\n        ]);\n        const potentialScramblers = [...sortedAvailableStaff, ...sortedAvailableCompetitors];\n        const updatedCompetitors = assignActivity(groupActivity.id, 'staff-scrambler', potentialScramblers.slice(0, scramblers));\n        return updatePeople(wcif, updatedCompetitors);\n      }, wcif);\n    }, wcif);\n  }, wcif);\n};\n\nconst assignRunning = (wcif, roundsToAssign) => {\n  return roundsToAssign.reduce((wcif, round) => {\n    if (hasDistributedAttempts(round.id)) return wcif;\n    const { eventId } = parseActivityCode(round.id);\n    return roundActivities(wcif, round.id).reduce((wcif, activity) => {\n      const { runners } = getExtensionData('ActivityConfig', activity);\n      if (runners === 0) return wcif;\n      return activity.childActivities.reduce((wcif, groupActivity) => {\n        const [staffRunners, people] = partition(acceptedPeople(wcif), person => person.roles.includes('staff-runner'));\n        const available = people => people.filter(person => availableDuring(wcif, groupActivity, person));\n        const sortedAvailableStaff = sortByArray(available(staffRunners), competitor => [\n          Math.floor(staffAssignments(competitor).length / 3),\n          competesIn15Minutes(wcif, competitor, groupActivity.endTime) ? 1 : -1\n        ]);\n        const sortedAvailablePeople = sortedAvailableStaff.length >= runners ? [] : sortByArray(available(people), competitor => [\n          age(competitor) >= 10 ? -1 : 1,\n          intersection(['dataentry', 'delegate', 'organizer'], competitor.roles).length,\n          staffAssignmentsForEvent(wcif, competitor, eventId).length >= 2 ? 1 : -1,\n          -presenceRate(wcif, competitor, groupActivity.startTime),\n          Math.floor(staffAssignments(competitor).length / 6),\n          competesIn15Minutes(wcif, competitor, groupActivity.endTime) ? 1 : -1\n        ]);\n        const potentialRunners = [...sortedAvailableStaff, ...sortedAvailablePeople];\n        const updatedPeople = assignActivity(groupActivity.id, 'staff-runner', potentialRunners.slice(0, runners));\n        return updatePeople(wcif, updatedPeople);\n      }, wcif);\n    }, wcif);\n  }, wcif);\n};\n\nconst assignJudging = (wcif, roundsToAssign) => {\n  return roundsToAssign.reduce((wcif, round) => {\n    if (hasDistributedAttempts(round.id)) return wcif;\n    const { eventId } = parseActivityCode(round.id);\n    return roundActivities(wcif, round.id).reduce((wcif, activity) => {\n      const { assignJudges } = getExtensionData('ActivityConfig', activity);\n      const stations = stationsByActivity(wcif, activity.id);\n      if (!assignJudges) return wcif;\n      return activity.childActivities.reduce((wcif, groupActivity) => {\n        const competitors = wcif.persons.filter(competitor =>\n          hasAssignment(competitor, groupActivity.id, 'competitor')\n        ).length;\n        const judges = Math.min(stations, competitors);\n        const [staffJudges, people] = partition(acceptedPeople(wcif), person => person.roles.includes('staff-judge'));\n        const available = people => people.filter(person => availableDuring(wcif, groupActivity, person));\n        const sortedAvailableStaff = sortByArray(available(staffJudges), competitor => [\n          /* Equally distribute tasks (judging is assigned last, so we want to eliminate inequality introduced by other assignments). */\n          staffAssignments(competitor).length,\n          competesIn15Minutes(wcif, competitor, groupActivity.endTime) ? 1 : -1\n        ]);\n        const sortedAvailablePeople = sortedAvailableStaff.length >= judges ? [] : sortByArray(available(people), competitor => [\n          age(competitor) >= 10 ? -1 : 1,\n          intersection(['dataentry', 'delegate', 'organizer'], competitor.roles).length,\n          staffAssignmentsForEvent(wcif, competitor, eventId).length >= 2 ? 1 : -1,\n          -presenceRate(wcif, competitor, groupActivity.startTime),\n          /* Equally distribute tasks (judging is assigned last, so we want to eliminate inequality introduced by other assignments). */\n          staffAssignments(competitor).length,\n          competesIn15Minutes(wcif, competitor, groupActivity.endTime) ? 1 : -1,\n          /* Prefer people that solve fewer events, to avoid overloading people solving more. */\n          competitor.registration ? competitor.registration.eventIds.length : 0,\n        ]);\n        const potentialJudges = [...sortedAvailableStaff, ...sortedAvailablePeople];\n        const updatedPeople = assignActivity(groupActivity.id, 'staff-judge', potentialJudges.slice(0, judges));\n        return updatePeople(wcif, updatedPeople);\n      }, wcif);\n    }, wcif);\n  }, wcif);\n};\n\nconst competesIn15Minutes = (wcif, competitor, isoString) => {\n  const competingStartTimes = competitor.assignments\n    .filter(({ assignmentCode }) => assignmentCode === 'competitor')\n    .map(({ activityId }) => activityById(wcif, activityId).startTime)\n    .filter(startTime => startTime >= isoString);\n  if (competingStartTimes.length === 0) return false;\n  const competingStart = competingStartTimes.reduce((x, y) => x < y ? x : y);\n  return isoTimeDiff(competingStart, isoString) <= 15 * 60 * 1000;\n};\n\n/* The lower, the less likely the competitor is to be at the venue. */\nconst presenceRate = (wcif, competitor, time) => {\n  const activitiesThisDay = competitor.assignments\n    .map(({ activityId }) => activityById(wcif, activityId))\n    .filter(({ startTime }) => new Date(startTime).getDay() === new Date(time).getDay());\n  if (activitiesThisDay.length === 0) return 0;\n  const [startTimes, endTimes] = zip(\n    ...activitiesThisDay.map(({ startTime, endTime }) => [startTime, endTime])\n  ).map(times => times.sort());\n  if (startTimes[0] > time) return 1;\n  const previousEndTime = findLast(endTimes, endTime => endTime <= time);\n  const nextStartTime = startTimes.find(startTime => startTime >= time);\n  if (previousEndTime) {\n    if (nextStartTime) {\n      /* > 1 hour after last activity and > 1 hour before next one */\n      if (isoTimeDiff(time, previousEndTime) > 60 * 60 * 1000 && isoTimeDiff(time, nextStartTime) > 60 * 60 * 1000) return 3;\n    } else {\n      /* > 30 min after last activity */\n      if (isoTimeDiff(time, previousEndTime) > 30 * 60 * 1000) return 2;\n    }\n  }\n  return 4;\n};\n\nconst assignActivity = (activityId, assignmentCode, competitors) =>\n  competitors.map(competitor => ({\n    ...competitor,\n    assignments: [...competitor.assignments, { activityId, assignmentCode }]\n  }));\n\nconst updatePeople = (wcif, updatedPeople) =>\n  mapIn(wcif, ['persons'], person =>\n    updatedPeople.find(updatedPerson => updatedPerson.wcaUserId === person.wcaUserId) || person\n  );\n\nconst availableDuring = (wcif, activity, competitor) =>\n  !competitor.assignments.some(({ activityId }) =>\n    activitiesOverlap(activityById(wcif, activityId), activity)\n  );\n\nconst availabilityRate = (wcif, activity, competitor) => {\n  const intersections = competitor.assignments.map(({ activityId }) =>\n    activitiesIntersection(activityById(wcif, activityId), activity)\n  );\n  const timeWhenBusy = sum(intersections);\n  return -(timeWhenBusy / activityDuration(activity));\n};\n\nconst overlapsEveryoneWithSameRole = (wcif, groups, activity, competitor) =>\n  intersection(['dataentry', 'delegate', 'organizer'], competitor.roles)\n    .some(role => {\n      const others = acceptedPeople(wcif).filter(person => person.roles.includes(role));\n      return others.length > 0 && others.every(other =>\n        !availableDuring(wcif, activity, other)\n        || groups.some(({ activity: groupActivity, competitors }) =>\n          competitors.includes(other) && activitiesOverlap(groupActivity, activity)\n        )\n      );\n    });\n\nexport const updateScrambleSetCount = wcif =>\n  mapIn(wcif, ['events'], event =>\n    mapIn(event, ['rounds'], round =>\n      setIn(round, ['scrambleSetCount'], scrambleSetCountForRound(wcif, round.id))\n    )\n  );\n\n/* Assume one scramble set for each unique timeframe, i.e. (startTime, endTime) pair. */\nconst scrambleSetCountForRound = (wcif, roundId) =>\n  hasDistributedAttempts(roundId) ? 1 : uniq(\n    groupActivitiesByRound(wcif, roundId).map(({ startTime, endTime }) => startTime + endTime)\n  ).length;\n","import React, { Component } from 'react';\nimport { Link } from 'react-router-dom';\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport SnackbarContent from '@material-ui/core/SnackbarContent';\nimport pink from '@material-ui/core/colors/pink';\n\nimport GroupsNavigation from './GroupsNavigation/GroupsNavigation';\nimport SaveWcifButton from '../../common/SaveWcifButton/SaveWcifButton';\n\nimport { createGroupActivities, updateScrambleSetCount, assignTasks } from '../../../logic/groups';\nimport { allGroupsCreated, roundsMissingAssignments, anyResults } from '../../../logic/activities';\nimport { updateIn, mapIn, setIn } from '../../../logic/utils';\n\nexport default class GroupsManager extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      localWcif: props.wcif\n    };\n  }\n\n  createGroupActivities = () => {\n    const { localWcif } = this.state;\n    this.setState({\n      localWcif: updateScrambleSetCount(createGroupActivities(localWcif))\n    });\n  };\n\n  assignTasks = () => {\n    const { localWcif } = this.state;\n    this.setState({ localWcif: assignTasks(localWcif) });\n  };\n\n  clearGroups = () => {\n    const { localWcif } = this.state;\n    const persons = localWcif.persons.map(person =>\n      updateIn(person, ['assignments'], assignments =>\n        assignments.filter(({ assignmentCode }) =>\n          !assignmentCode.startsWith('staff-') && assignmentCode !== 'competitor'\n        )\n      )\n    );\n    const schedule = mapIn(localWcif.schedule, ['venues'], venue =>\n      mapIn(venue, ['rooms'], room =>\n        mapIn(room, ['activities'], activity => setIn(activity, ['childActivities'], []))\n      )\n    );\n    this.setState({ localWcif: { ...localWcif, persons, schedule } });\n  };\n\n  render() {\n    const { localWcif } = this.state;\n    const { wcif, onWcifUpdate, history } = this.props;\n\n    const groupsCreated = allGroupsCreated(localWcif);\n\n    return (\n      <Grid container spacing={8} justify=\"flex-end\">\n        <Grid item xs={12}>\n          {!groupsCreated && (\n            <SnackbarContent\n              style={{ maxWidth: 'none' }}\n              message=\"To assign tasks you need to create groups first. This will also determine scramble set count for each round.\"\n              action={\n                <Button onClick={this.createGroupActivities} style={{ color: pink[500] }} size=\"small\">\n                  Create groups\n                </Button>\n              }\n            />\n          )}\n          {(groupsCreated && roundsMissingAssignments(localWcif).length > 0) && (\n            <SnackbarContent\n              style={{ maxWidth: 'none' }}\n              message=\"There are rounds with no tasks assigned.\"\n              action={\n                <Button onClick={this.assignTasks} style={{ color: pink[500] }} size=\"small\">\n                  Assign tasks\n                </Button>\n              }\n            />\n          )}\n        </Grid>\n        <Grid item xs={12}>\n          <GroupsNavigation wcif={localWcif} />\n        </Grid>\n        <Grid item>\n          <Button variant=\"contained\" component={Link} to={`/competitions/${localWcif.id}`}>\n            Cancel\n          </Button>\n        </Grid>\n        <Grid item>\n          <Button variant=\"contained\" onClick={this.clearGroups} disabled={anyResults(localWcif)}>\n            Clear\n          </Button>\n        </Grid>\n        <Grid item>\n          <SaveWcifButton wcif={wcif} updatedWcif={localWcif} onWcifUpdate={onWcifUpdate} history={history} />\n        </Grid>\n      </Grid>\n    );\n  }\n}\n","import { parseActivityCode } from './activities';\nimport { shortEventNameById } from './events';\n\nexport const cutoffToString = (cutoff, eventId) => {\n  if (eventId === '333mbf') {\n    return `${multibldAttemptResultToPoints(cutoff.attemptResult)} points`;\n  } else if (eventId === '333fm') {\n    return `${cutoff.attemptResult} moves`;\n  } else {\n    return centisecondsToClockFormat(cutoff.attemptResult);\n  }\n}\n\nexport const timeLimitToString = timeLimit => {\n  const { centiseconds, cumulativeRoundIds } = timeLimit;\n  const clockFormat = centisecondsToClockFormat(centiseconds);\n  if (cumulativeRoundIds.length === 0) {\n    return clockFormat;\n  } else if (cumulativeRoundIds.length === 1) {\n    return `${clockFormat} in total`;\n  } else {\n    const roundStrings = cumulativeRoundIds.map(roundId => {\n      const { eventId, roundNumber } = parseActivityCode(roundId);\n      return `${shortEventNameById(eventId)} R${roundNumber}`;\n    });\n    return `${clockFormat} total for ${roundStrings.join(', ')}`;\n  }\n}\n\nconst multibldAttemptResultToPoints = attemptResult =>\n  99 - (Math.floor(attemptResult / 10000000) % 100);\n\nconst centisecondsToClockFormat = centiseconds => {\n  const date = new Date(null);\n  date.setUTCMilliseconds(centiseconds * 10);\n  return date.toISOString().substr(11, 11).replace(/^[0:]*(?!\\.)/g, '');\n};\n","import pdfMake from 'pdfmake/build/pdfmake';\n\n/* Asynchronously download fonts bundle for PDF Make. */\nfetch('vfs-fonts.bundle.json')\n  .then(response => response.json())\n  .then(vfsFonts => pdfMake.vfs = vfsFonts);\n\nconst singleFileFont = file => ({\n  normal: file, bold: file, italic: file, bolditalics: file\n})\n\npdfMake.fonts = {\n  Roboto: {\n    normal: 'Roboto-Regular.ttf',\n    bold: 'Roboto-Medium.ttf',\n    italics: 'Roboto-Italic.ttf',\n    bolditalics: 'Roboto-MediumItalic.ttf'\n  },\n  WenQuanYiZenHei: singleFileFont('WenQuanYiZenHei.ttf'),\n  NotoSansThai: singleFileFont('NotoSansThai-Regular.ttf'),\n  NotoSansArabic: singleFileFont('NotoSansArabic-Regular.ttf'),\n  NotoSansGeorgian: singleFileFont('NotoSansGeorgian-Regular.ttf'),\n  NotoSansArmenian: singleFileFont('NotoSansArmenian-Regular.ttf')\n};\n\nexport default pdfMake;\n","import { inRange } from '../utils';\n\nconst determineFont = text => {\n  const code = text.charCodeAt(0);\n  /* Based on https://en.wikipedia.org/wiki/Unicode_block */\n  if (inRange(code, 0x0000, 0x052F)) {\n    return 'Roboto';\n  } else if (inRange(code, 0x0600, 0x06FF) || inRange(code, 0x0750, 0x077F)) {\n    return 'NotoSansArabic';\n  } else if (inRange(code, 0x0E00, 0x0E7F)) {\n    return 'NotoSansThai';\n  } else if (inRange(code, 0x0530, 0x058F)) {\n    return 'NotoSansArmenian';\n  } else if (inRange(code, 0x10A0, 0x10FF)) {\n    return 'NotoSansGeorgian';\n  } else {\n    /* Default to WenQuanYiZenHei as it supports the most characters (mostly CJK). */\n    return 'WenQuanYiZenHei';\n  }\n};\n\nexport const pdfName = (name, { swapLatinWithLocalNames = false, short = false } = {}) => {\n  /* Note: support normal and fullwidth parentheses. */\n  const [, latinName, localName] = name.match(/(.+)\\s*[(（](.+)[)）]/) || [null, name, null];\n  if (!localName) return latinName;\n  const pdfNames = [latinName, { text: localName, font: determineFont(localName) }];\n  const [first, second] = swapLatinWithLocalNames ? pdfNames.reverse() : pdfNames;\n  return short ? first : [first, ' (', second, ')'];\n};\n\nexport const getImageDataUrl = url => {\n  if (!url) return Promise.resolve(null);\n  const params = new URLSearchParams({\n    url,\n    filt: 'greyscale',\n    bri: 30,\n    bg: 'white',\n    w: 200,\n    h: 200,\n    t: 'letterbox',\n    output: 'jpg',\n    encoding: 'base64'\n  });\n  return fetch(`https://images.weserv.nl/?${params.toString()}`)\n    .then(response => response.text())\n    .catch(() => null);\n};\n","import { flatMap, sortBy, chunk } from '../utils';\nimport { parseActivityCode, groupActivitiesByRound } from '../activities';\nimport { eventNameById } from '../events';\nimport { cutoffToString, timeLimitToString } from '../formatters';\nimport { competitorsForRound, hasAssignment } from '../competitors';\nimport { getExtensionData } from '../wcif-extensions';\nimport pdfMake from '../documents/pdfmake';\nimport { pdfName, getImageDataUrl } from '../documents/pdf-utils';\n\n/* See: https://github.com/bpampuch/pdfmake/blob/3da11bd8148b190808b06f7bc27883102bf82917/src/standardPageSizes.js#L10 */\nconst pageWidth = 595.28;\nconst pageHeight = 841.89;\nconst scorecardMargin = 20;\n\nconst maxAttemptCountByFormat = { '1': 1, '2': 2, '3': 3, 'm': 3, 'a': 5 };\n\nexport const downloadScorecards = (wcif, rounds) => {\n  const { scorecardsBackgroundUrl } = getExtensionData('CompetitionConfig', wcif);\n  getImageDataUrl(scorecardsBackgroundUrl).then(imageData => {\n    const pdfDefinition = scorecardsPdfDefinition(wcif, rounds, imageData);\n    pdfMake.createPdf(pdfDefinition).download(`${wcif.id}-scorecards.pdf`);\n  });\n};\n\nconst scorecardsPdfDefinition = (wcif, rounds, imageData) => ({\n  background: [\n    ...(imageData === null ? [] : [\n        /* Determined empirically to fit results table. */\n        { x: 60, y: 170 }, { x: 360, y: 170 },\n        { x: 60, y: 590 }, { x: 360, y: 590 }\n      ].map(absolutePosition => ({ absolutePosition, image: imageData }))\n    ), {\n    canvas: [\n      cutLine({ x1: scorecardMargin, y1: pageHeight / 2, x2: pageWidth - scorecardMargin, y2: pageHeight / 2 }),\n      cutLine({ x1: pageWidth / 2, y1: scorecardMargin, x2: pageWidth / 2, y2:  pageHeight - scorecardMargin })\n    ]\n  }],\n  pageMargins: [scorecardMargin, scorecardMargin],\n  content: {\n    layout: {\n      /* Outer margin is done using pageMargins, we use padding for the remaining inner margins. */\n      paddingLeft  : i => i % 2 === 0 ? 0 : scorecardMargin,\n      paddingRight : i => i % 2 === 0 ? scorecardMargin : 0,\n      paddingTop   : i => i % 2 === 0 ? 0 : scorecardMargin,\n      paddingBottom: i => i % 2 === 0 ? scorecardMargin : 0,\n      /* Get rid of borders. */\n      hLineWidth: () => 0,\n      vLineWidth: () => 0\n    },\n    table: {\n      widths: ['*', '*'],\n      /* A4 page height minus vertical margins, divided into a half. */\n      heights: (pageHeight - 4 * scorecardMargin) / 2,\n      dontBreakRows: true,\n      body: chunk(scorecards(wcif, rounds), 2)\n    }\n  }\n});\n\nconst cutLine = properties => ({\n  ...properties,\n  type: 'line', lineWidth: 0.1, dash: { length: 10 }, lineColor: '#888888'\n});\n\nconst scorecards = (wcif, rounds) => {\n  const { localNamesFirst } = getExtensionData('CompetitionConfig', wcif) || { localNamesFirst: false };\n  return flatMap(rounds, round => {\n    const sortedGroupActivities = sortBy(groupActivitiesByRound(wcif, round.id),\n      ({ activityCode }) => parseActivityCode(activityCode).groupNumber\n    );\n    const sortedCompetitors = competitorsForRound(wcif, round.id);\n    let scorecardNumber = sortedCompetitors.length;\n    return flatMap(sortedGroupActivities, groupActivity => {\n      const competitors = sortedCompetitors.filter(competitor =>\n        hasAssignment(competitor, groupActivity.id, 'competitor')\n      );\n      const groupScorecards = competitors.map(competitor =>\n        scorecard({\n          scorecardNumber: scorecardNumber--,\n          competitionName: wcif.shortName,\n          activityCode: groupActivity.activityCode,\n          round,\n          competitor,\n          localNamesFirst\n        })\n      );\n      const scorecardsOnLastPage = groupScorecards.length % 4;\n      return scorecardsOnLastPage === 0\n        ? groupScorecards\n        : groupScorecards.concat(Array.from({ length: 4 - scorecardsOnLastPage }, () => ({})));\n    });\n  });\n};\n\nconst scorecard = ({\n  scorecardNumber,\n  competitionName,\n  activityCode,\n  round,\n  competitor,\n  localNamesFirst\n}) => {\n  const { eventId, roundNumber, groupNumber } = parseActivityCode(activityCode);\n  const { cutoff, timeLimit } = round;\n  const attemptCount = maxAttemptCountByFormat[round.format];\n\n  return [\n    { text: scorecardNumber, fontSize: 10 },\n    { text: competitionName, bold: true, fontSize: 15, margin: [0, 0, 0, 10], alignment: 'center' },\n    {\n      margin: [25, 0, 0, 0],\n      table: {\n        widths: ['*', 'auto', 'auto'],\n        body: [\n          columnLabels(['Event', 'Round', 'Group']),\n          [eventNameById(eventId), { text: roundNumber, alignment: 'center' }, { text: groupNumber, alignment: 'center' }]\n        ]\n      }\n    },\n    {\n      margin: [25, 0, 0, 0],\n      table: {\n        widths: ['auto', '*'],\n        body: [\n          columnLabels(['ID', 'Name']),\n          [{ text: competitor.registrantId, alignment: 'center' }, { text: pdfName(competitor.name, { swapLatinWithLocalNames: localNamesFirst }), maxHeight: 20 /* See: https://github.com/bpampuch/pdfmake/issues/264#issuecomment-108347567 */ }]\n        ]\n      }\n    },\n    {\n      margin: [0, 10, 0, 0],\n      table: {\n        widths: [16, 25, '*', 25, 25], /* Note: 16 (width) + 4 + 4 (defult left and right padding) + 1 (left border) = 25 */\n        body: [\n          columnLabels(['', 'Scr', 'Result', 'Judge', 'Comp'], { alignment: 'center' }),\n          ...attemptRows(cutoff, attemptCount),\n          [{ text: 'Extra attempt', ...noBorder, colSpan: 5, margin: [0, 1], fontSize: 10 }],\n          attemptRow('_'),\n          [{ text: '', ...noBorder, colSpan: 5, margin: [0, 1] }]\n        ]\n      }\n    },\n    {\n      fontSize: 10,\n      columns: [\n        cutoff ? { text: `Cutoff: ${cutoffToString(cutoff, eventId)}`, alignment: 'center' } : {},\n        timeLimit ? { text: `Time limit: ${timeLimitToString(timeLimit)}`, alignment: 'center' } : {}\n      ]\n    },\n  ];\n};\n\nconst columnLabels = (labels, style = {}) =>\n  labels.map(label => ({\n    ...style, ...noBorder, fontSize: 9, text: label\n  }));\n\nconst attemptRows = (cutoff, attemptCount) =>\n  Array.from({ length: attemptCount }, (_, attemptIndex) => attemptRow(attemptIndex + 1))\n    .reduce((rows, attemptRow, attemptIndex) =>\n      (attemptIndex + 1 === attemptCount)\n        ? [...rows, attemptRow]\n        : [ ...rows, attemptRow,\n            attemptsSeparator(cutoff && (attemptIndex + 1 === cutoff.numberOfAttempts))\n          ]\n    , []);\n\nconst attemptsSeparator = cutoffLine => [{\n  ...noBorder, colSpan: 5, margin: [0, 1],\n  columns: !cutoffLine ? [] : [{\n    canvas: [{\n      type: 'line',\n      x1: 0, y1: 0,\n      x2: (pageWidth - 4 * scorecardMargin) / 2, y2: 0,\n      dash: { length: 5 },\n    }]\n  }]\n}];\n\nconst attemptRow = attemptNumber =>\n  [{ text: attemptNumber, ...noBorder, fontSize: 20, bold: true, alignment: 'center' }, {}, {}, {} ,{}];\n\nconst noBorder = { border: [false, false, false, false] };\n","import { flatMap } from '../utils';\nimport { activityCodeToName, groupActivitiesByRound } from '../activities';\nimport { hasAssignment } from '../competitors';\nimport pdfMake from '../documents/pdfmake';\nimport { pdfName } from '../documents/pdf-utils';\n\nexport const downloadGroupOverview = (wcif, rounds) => {\n  const pdfDefinition = groupOverviewPdfDefinition(wcif, rounds);\n  pdfMake.createPdf(pdfDefinition).download(`${wcif.id}-group-overview.pdf`);\n};\n\nconst groupOverviewPdfDefinition = (wcif, rounds) => ({\n  content: flatMap(rounds, round => groupActivitiesByRound(wcif, round.id))\n    .map(groupActivity => overviewForGroup(wcif, groupActivity))\n});\n\nconst overviewForGroup = (wcif, groupActivity) => {\n  const headersWithPeople = [\n    ['Competitors', 'competitor'], ['Scramblers', 'staff-scrambler'], ['Runners', 'staff-runner', ], ['Judges', 'staff-judge']\n  ].map(([header, assignmentCode]) => [\n    header,\n    wcif.persons.filter(person => hasAssignment(person, groupActivity.id, assignmentCode))\n  ]).filter(([header, people]) => people.length > 0);\n  return {\n    unbreakable: true,\n    margin: [0, 0, 0, 10],\n    stack: [\n      { text: activityCodeToName(groupActivity.activityCode), bold: true, fontSize: 14, margin: [0, 0, 0, 5] },\n      {\n        fontSize: 8,\n        columns: headersWithPeople.map(([header, people]) => [\n          { text: `${header} (${people.length})`, bold: true, fontSize: 10, margin: [0, 0, 0, 2] },\n          { ul: people.map(person => pdfName(person.name, { short: true })).sort() }\n        ])\n      }\n    ]\n  };\n};\n","import React, { Component } from 'react';\nimport Button from '@material-ui/core/Button';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Paper from '@material-ui/core/Paper';\nimport Typography from '@material-ui/core/Typography';\n\nimport CubingIcon from '../../../common/CubingIcon/CubingIcon';\nimport { downloadScorecards } from '../../../../logic/documents/scorecards';\nimport { downloadGroupOverview } from '../../../../logic/documents/group-overview';\nimport { roundsMissingScorecards, parseActivityCode, activityCodeToName } from '../../../../logic/activities';\nimport { difference } from '../../../../logic/utils';\n\nexport default class Scorecards extends Component {\n  constructor(props) {\n    super(props);\n    const rounds = roundsMissingScorecards(this.props.wcif);\n    const selectedRounds = rounds.every(round => parseActivityCode(round.id).roundNumber === 1) ? rounds : []\n    this.state = {\n      selectedRounds\n    };\n  }\n\n  handleScorecardsDownloadClick = () => {\n    downloadScorecards(this.props.wcif, this.state.selectedRounds);\n  };\n\n  handleGroupOverviewDownloadClick = () => {\n    downloadGroupOverview(this.props.wcif, this.state.selectedRounds);\n  };\n\n  handleRoundClick = round => event => {\n    const { selectedRounds } = this.state;\n    this.setState({\n      selectedRounds: selectedRounds.includes(round)\n        ? difference(selectedRounds, [round])\n        : [...selectedRounds, round]\n    });\n  };\n\n  render() {\n    const { selectedRounds } = this.state;\n    const { wcif } = this.props;\n    const rounds = roundsMissingScorecards(wcif);\n\n    return (\n      <Paper style={{ padding: 16 }}>\n        <Typography variant=\"body1\">Select rounds</Typography>\n        <List style={{ width: 400 }}>\n          {rounds.map(round => (\n            <ListItem key={round.id} button onClick={this.handleRoundClick(round)}>\n              <ListItemIcon>\n                <CubingIcon eventId={parseActivityCode(round.id).eventId} />\n              </ListItemIcon>\n              <ListItemText primary={activityCodeToName(round.id)} />\n              <Checkbox\n                checked={selectedRounds.includes(round)}\n                tabIndex={-1}\n                disableRipple\n                style={{ padding: 0 }}\n              />\n            </ListItem>\n          ))}\n        </List>\n        <Button onClick={this.handleScorecardsDownloadClick} disabled={selectedRounds.length === 0}>\n          Scorecards\n        </Button>\n        <Button onClick={this.handleGroupOverviewDownloadClick} disabled={selectedRounds.length === 0}>\n          Group overview\n        </Button>\n      </Paper>\n    );\n  }\n}\n","import { chunk, sortBy, zip } from '../utils';\nimport { eventNameById } from '../events';\nimport { activityById, hasDistributedAttempts, parseActivityCode } from '../activities';\nimport { acceptedPeople } from '../competitors';\nimport { getExtensionData } from '../wcif-extensions';\nimport pdfMake from '../documents/pdfmake';\nimport { pdfName } from '../documents/pdf-utils';\n\nexport const downloadCompetitorCards = wcif => {\n  const pdfDefinition = competitorCardsPdfDefinition(wcif);\n  pdfMake.createPdf(pdfDefinition).download(`${wcif.id}-competitor-cards.pdf`);\n};\n\nconst competitorCardsPdfDefinition = wcif => ({\n  pageMargins: [5, 5],\n  content: chunk(competitorCards(wcif), 3).map(cards => (\n    { columns: cards, fontSize: 8, unbreakable: true }\n  ))\n});\n\nconst competitorCards = wcif => {\n  const cards = sortBy(acceptedPeople(wcif), person => person.name)\n    .map(person => competitorCard(wcif, person));\n  const cardsInLastRow = cards.length % 3;\n  return cardsInLastRow === 0\n    ? cards\n    : cards.concat(Array.from({ length: 3 - cardsInLastRow }, () => ({})));\n};\n\nconst competitorCard = (wcif, person) => {\n  const events = wcif.events.filter(event => !hasDistributedAttempts(event.id));\n  const { localNamesFirst } = getExtensionData('CompetitionConfig', wcif) || { localNamesFirst: false };\n  const tasks = person.assignments.map(({ activityId, assignmentCode }) => {\n    const activity = activityById(wcif, activityId);\n    const { eventId, roundNumber, groupNumber } = parseActivityCode(activity.activityCode);\n    return { assignmentCode, eventId, groupNumber, roundNumber };\n  }).filter(({ roundNumber }) => roundNumber === 1);\n  const groupsText = (eventId, assignmentCode) => ({\n    text: tasks\n      .filter(task => task.eventId === eventId && task.assignmentCode === assignmentCode)\n      .map(task => task.groupNumber)\n      .join(', '),\n    alignment: 'center'\n  });\n  const [assignmentCodes, headers] = zip(...[\n      ['competitor', 'Comp'], ['staff-scrambler', 'Scr'], ['staff-runner', 'Run'], ['staff-judge', 'Judge']\n    ].filter(([assignmentCode]) => tasks.some(task => task.assignmentCode === assignmentCode))\n  );\n  return {\n    margin: [5, 5],\n    stack: [\n      { text: pdfName(person.name, { swapLatinWithLocalNames: localNamesFirst }), fontSize: 10 },\n      {\n        columns: [\n          `ID: ${person.registrantId}`,\n          { text: person.wcaId ? `WCA ID: ${person.wcaId}` : {}, alignment: 'right' }\n        ]\n      },\n      {\n        table: {\n          widths: ['auto', ...headers.map(() => '*')],\n          body: [\n            ['Event', ...headers.map(header => ({ text: header, alignment: 'center'}))],\n            ...events.map(event => [\n              eventNameById(event.id),\n              ...assignmentCodes.map(assignmentCode => groupsText(event.id, assignmentCode))\n            ])\n          ]\n        },\n        layout: { paddingLeft: () => 2, paddingRight: () => 2, paddingTop: () => 1, paddingBottom: () => 1 }\n      }\n    ]\n  };\n};\n","import React, { Component } from 'react';\nimport Button from '@material-ui/core/Button';\nimport Paper from '@material-ui/core/Paper';\nimport Typography from '@material-ui/core/Typography';\n\nimport { downloadCompetitorCards } from '../../../../logic/documents/competitor-cards';\n\nexport default class CompetitorCards extends Component {\n  handleDownloadClick = () => {\n    downloadCompetitorCards(this.props.wcif);\n  };\n\n  render() {\n    return (\n      <Paper style={{ padding: 16 }}>\n        <Typography variant=\"body1\">\n          First round task assignments for every competitor.\n          Useful to be distributed along with name tags.\n        </Typography>\n        <Button onClick={this.handleDownloadClick}>\n          Download\n        </Button>\n      </Paper>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport { Link } from 'react-router-dom';\nimport AppBar from '@material-ui/core/AppBar';\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport Tab from '@material-ui/core/Tab';\nimport Tabs from '@material-ui/core/Tabs';\n\nimport Scorecards from './Scorecards/Scorecards';\nimport CompetitorCards from './CompetitorCards/CompetitorCards';\n\nexport default class PrintingManager extends Component {\n  state = {\n    tabValue: 0\n  };\n\n  handleTabChange = (event, value) => {\n    this.setState({ tabValue: value });\n  };\n\n  render() {\n    const { tabValue } = this.state;\n    const { wcif } = this.props;\n\n    return (\n      <Grid container spacing={8} justify=\"flex-end\">\n        <Grid item xs={12}>\n          <AppBar position=\"static\" color=\"default\">\n            <Tabs value={tabValue} onChange={this.handleTabChange} centered>\n              <Tab label=\"Scorecards\" />\n              <Tab label=\"Competitor cards\" />\n            </Tabs>\n          </AppBar>\n        </Grid>\n        <Grid item xs={12}>\n          {tabValue === 0 && <Scorecards wcif={wcif} />}\n          {tabValue === 1 && <CompetitorCards wcif={wcif} />}\n        </Grid>\n        <Grid item>\n          <Button variant=\"contained\" color=\"primary\" component={Link} to={`/competitions/${wcif.id}`}>\n            Done\n          </Button>\n        </Grid>\n      </Grid>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport { Link } from 'react-router-dom';\nimport Button from '@material-ui/core/Button';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport Grid from '@material-ui/core/Grid';\nimport Paper from '@material-ui/core/Paper';\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableHead from '@material-ui/core/TableHead';\nimport TablePagination from '@material-ui/core/TablePagination';\nimport TableRow from '@material-ui/core/TableRow';\nimport TextField from '@material-ui/core/TextField';\nimport Toolbar from '@material-ui/core/Toolbar';\n\nimport SaveWcifButton from '../../common/SaveWcifButton/SaveWcifButton';\nimport { acceptedPeople } from '../../../logic/competitors';\nimport { difference } from '../../../logic/utils';\n\nconst roles = [\n  { id: 'staff-scrambler', name: 'Scrambler' },\n  { id: 'staff-judge', name: 'Judge' },\n  { id: 'staff-runner', name: 'Runner' },\n  { id: 'staff-dataentry', name: 'Data entry' },\n];\n\nexport default class RolesManager extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      localWcif: props.wcif,\n      page: 0,\n      searchString: ''\n    }\n  }\n\n  handleSearchChange = event => {\n    this.setState({ searchString: event.target.value });\n  };\n\n  handleChangePage = (event, page) => {\n    this.setState({ page });\n  };\n\n  handleRoleChange(roleId, personWcaUserId, event) {\n    const { localWcif } = this.state;\n    const { checked } = event.target;\n\n    this.setState({\n      localWcif: {\n        ...localWcif,\n        persons: localWcif.persons.map(person =>\n          person.wcaUserId === personWcaUserId\n            ? { ...person, roles: checked ? [...person.roles, roleId] : difference(person.roles, [roleId]) }\n            : person\n        )\n      }\n    });\n  }\n\n  clearRoles = () => {\n    const { localWcif } = this.state;\n    const roleIds = roles.map(role => role.id);\n    this.setState({\n      localWcif: {\n        ...localWcif,\n        persons: localWcif.persons.map(person =>\n          ({ ...person, roles: difference(person.roles, roleIds)})\n        )\n      }\n    });\n  };\n\n  render() {\n    const { page, searchString, localWcif } = this.state;\n    const { wcif, onWcifUpdate, history } = this.props;\n    const rowsPerPage = 5;\n    const rowsPerPageOptions = [5];\n\n    const people = acceptedPeople(localWcif)\n      .filter(person => person.name.match(new RegExp(searchString, 'i')));\n\n    return (\n      <Grid container spacing={8} justify=\"flex-end\">\n        <Grid item xs={12}>\n          <Paper>\n            <Toolbar>\n              <TextField label=\"Search\" value={searchString} onChange={this.handleSearchChange} />\n            </Toolbar>\n            <div style={{ overflowX: 'auto' }}>\n              <Table>\n                <TableHead>\n                  <TableRow>\n                    <TableCell>Person</TableCell>\n                    {roles.map(role =>\n                      <TableCell key={role.id} padding=\"none\" style={{ textAlign: 'center' }}>{role.name}</TableCell>\n                    )}\n                  </TableRow>\n                </TableHead>\n                <TableBody>\n                  {people.slice(page * rowsPerPage, page * rowsPerPage + rowsPerPage).map(person =>\n                    <TableRow key={person.wcaUserId} hover>\n                      <TableCell>{person.name}</TableCell>\n                      {roles.map(role =>\n                        <TableCell key={role.id} padding=\"checkbox\" style={{ textAlign: 'center' }}>\n                          <Checkbox\n                            checked={person.roles.includes(role.id)}\n                            onChange={this.handleRoleChange.bind(this, role.id, person.wcaUserId)}\n                          />\n                        </TableCell>\n                      )}\n                    </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n            </div>\n            <TablePagination\n              component=\"div\"\n              count={people.length}\n              rowsPerPage={rowsPerPage}\n              rowsPerPageOptions={rowsPerPageOptions}\n              page={page}\n              onChangePage={this.handleChangePage}\n            />\n          </Paper>\n        </Grid>\n        <Grid item>\n          <Button variant=\"contained\" component={Link} to={`/competitions/${localWcif.id}`}>\n            Cancel\n          </Button>\n        </Grid>\n        <Grid item>\n          <Button variant=\"contained\" onClick={this.clearRoles}>\n            Clear\n          </Button>\n        </Grid>\n        <Grid item>\n          <SaveWcifButton wcif={wcif} updatedWcif={localWcif} onWcifUpdate={onWcifUpdate} history={history} />\n        </Grid>\n      </Grid>\n    );\n  }\n}\n","import { flatMap } from './utils';\nimport { activityCodeToName, roundActivities } from './activities';\n\nexport const validateWcif = wcif => {\n  const { events } = wcif;\n  const eventRoundErrors = flatMap(events, event => {\n    if (event.rounds.length === 0) return [`No rounds specified for ${activityCodeToName(event.id)}.`];\n    const advancementConditionErrors = flatMap(event.rounds.slice(0, -1), round =>\n      round.advancementCondition ? [] : [`No advancement condition specified for ${activityCodeToName(round.id)}.`]\n    );\n    const roundActivityErrors = flatMap(event.rounds, round =>\n      roundActivities(wcif, round.id).length > 0 ? [] : [`No schedule activities for ${activityCodeToName(round.id)}.`]\n    );\n    return [...advancementConditionErrors, ...roundActivityErrors];\n  });\n  return eventRoundErrors;\n};\n","/* Dirty hacks for compatibility with Cubecomps. Get rid of that once WCA Live is ready. */\n\nimport { acceptedPeople } from './competitors';\n\n/* Generate ids the same way Cubecomps would do that.\n   If competitors are already on Cubecomps, use those competitor ids instead. */\nexport const __withCubecompsIds__ = wcif => {\n  const people = acceptedPeople(wcif);\n  people.forEach((person, index) => person.registrantId = index + 1);\n  return getCompetitions()\n    .then(competitions => {\n      const competition = competitions.find(competition => wcif.name.startsWith(competition.name));\n      if (!competition) return null;\n      return getCompetition(competition.id).then(competition => {\n        if (competition.competitors.length === 0) return null;\n        people.forEach(person => {\n          const competitor = competition.competitors.find(competitor => person.name.includes(competitor.name));\n          if (!competitor) throw new Error(`Couldn't find Cubecomps competitor id for ${person.name}.`);\n          person.registrantId = parseInt(competitor.id, 10);\n        });\n      });\n    })\n    .then(() => wcif);\n};\n\nconst getCompetitions = () =>\n  cubecompsApiFetch('/competitions')\n    .then(competitions => Object.values(competitions).reduce((x, y) => x.concat(y), []));\n\nconst getCompetition = competitionCubecompsId =>\n  cubecompsApiFetch(`/competitions/${competitionCubecompsId}`);\n\nconst cubecompsApiFetch = (path, fetchOptions = {}) => {\n  const baseApiUrl = 'https://m.cubecomps.com/api/v1';\n\n  return fetch(`${baseApiUrl}${path}`, Object.assign({}, fetchOptions, {\n      headers: new Headers({ 'Content-Type': 'application/json' })\n    }))\n    .then(response => {\n      if (!response.ok) throw new Error(response.statusText);\n      return response;\n    })\n    .then(response => response.json());\n};\n","import React, { Component, Fragment } from 'react';\nimport { Route, Switch } from 'react-router-dom';\nimport LinearProgress from '@material-ui/core/LinearProgress';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Typography from '@material-ui/core/Typography';\n\nimport CompetitionMenu from './CompetitionMenu/CompetitionMenu';\nimport ConfigManager from './ConfigManager/ConfigManager';\nimport GroupsManager from './GroupsManager/GroupsManager';\nimport PrintingManager from './PrintingManager/PrintingManager';\nimport RolesManager from './RolesManager/RolesManager';\n\nimport { getWcif } from '../../logic/wca-api';\nimport { sortWcifEvents } from '../../logic/events';\nimport { updateIn } from '../../logic/utils';\nimport { validateWcif } from '../../logic/wcif-validation';\nimport { __withCubecompsIds__ } from '../../logic/__cubecomps__';\n\nexport default class Competition extends Component {\n  state = {\n    wcif: null,\n    loading: true,\n    errors: []\n  };\n\n  componentDidMount() {\n    getWcif(this.props.match.params.competitionId)\n      .then(wcif => updateIn(wcif, ['events'], sortWcifEvents)) /* Sort events, so that we don't need to remember about this everywhere. */\n      .then(__withCubecompsIds__)\n      .then(wcif => this.setState({ wcif, loading: false, errors: validateWcif(wcif) }))\n      .catch(error => this.setState({ errors: [error.message], loading: false }))\n  }\n\n  handleWcifUpdate = wcif => {\n    this.setState({ wcif });\n  };\n\n  render() {\n    const { wcif, loading, errors } = this.state;\n    const { match } = this.props;\n\n    return loading ? <LinearProgress /> : (\n      <div>\n        {errors.length === 0 ? (\n          <Fragment>\n            <Typography variant=\"h5\" style={{ marginBottom: 16 }}>\n              {wcif.name}\n            </Typography>\n            <Switch>\n              <Route exact path={match.url} render={\n                props => <CompetitionMenu {...props} wcif={wcif} baseUrl={match.url} />\n              } />\n              <Route path={`${match.url}/roles`} render={\n                props => <RolesManager {...props} wcif={wcif} onWcifUpdate={this.handleWcifUpdate} />\n              } />\n              <Route path={`${match.url}/config`} render={\n                props => <ConfigManager {...props} wcif={wcif} onWcifUpdate={this.handleWcifUpdate} />\n              } />\n              <Route path={`${match.url}/groups`} render={\n                props => <GroupsManager {...props} wcif={wcif} onWcifUpdate={this.handleWcifUpdate} />\n              } />\n              <Route path={`${match.url}/printing`} render={\n                props => <PrintingManager {...props} wcif={wcif} />\n              } />\n            </Switch>\n          </Fragment>\n        ) : (\n          <Fragment>\n            <Typography variant=\"h5\">Failed to load competition data</Typography>\n            <List>\n              {errors.map(error => (\n                <ListItem key={error}>\n                  <ListItemText>{error}</ListItemText>\n                </ListItem>\n              ))}\n            </List>\n          </Fragment>\n        )}\n      </div>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport { Link } from 'react-router-dom';\nimport LinearProgress from '@material-ui/core/LinearProgress';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport ListSubheader from '@material-ui/core/ListSubheader';\nimport Paper from '@material-ui/core/Paper';\nimport Icon from '@material-ui/core/Icon';\n\nimport { getUpcomingManageableCompetitions } from '../../logic/wca-api';\nimport { sortBy } from '../../logic/utils';\n\nexport default class CompetitionList extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      competitions: [],\n      loading: true\n    }\n  }\n\n  componentDidMount() {\n    getUpcomingManageableCompetitions()\n      .then(competitions =>\n        this.setState({\n          competitions: sortBy(competitions, competition => competition['start_date']),\n          loading: false\n        })\n      );\n  }\n\n  render() {\n    const { competitions, loading } = this.state;\n\n    return (\n      <div>\n        <Paper>\n          <List subheader={<ListSubheader>Your competitions</ListSubheader>}>\n            {!loading && competitions.length === 0 &&\n              <ListItem>\n                <ListItemIcon>\n                  <Icon>sentiment_very_dissatisfied</Icon>\n                </ListItemIcon>\n                <ListItemText primary=\"You have no upcoming competitions to manage.\" />\n              </ListItem>\n            }\n            {competitions.map(competition =>\n              <ListItem key={competition.id} button component={Link} to={`/competitions/${competition.id}`}>\n                <ListItemText primary={competition.name} />\n              </ListItem>\n            )}\n          </List>\n          {loading && <LinearProgress />}\n        </Paper>\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport Icon from '@material-ui/core/Icon';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport red from '@material-ui/core/colors/red'\n\nimport './Footer.css';\n\nconst links = [\n  { text: 'Donate', url: 'https://ko-fi.com/jonatanklosko' },\n  { text: 'Guide', url: 'https://github.com/jonatanklosko/groupifier-next/wiki/Guide' },\n  { text: 'GitHub', url: 'https://github.com/jonatanklosko/groupifier-next' },\n  { text: 'Contact', url: 'mailto:jonatanklosko@gmail.com' },\n  { text: 'v1.1.5', url: 'https://github.com/jonatanklosko/groupifier-next' }\n];\n\nconst Footer = () => (\n  <Grid container className=\"footer\">\n    <Grid item style={{ flexGrow: 1 }}>\n      <Typography>\n        Made with <Icon className=\"footer-icon\" style={{ color: red[700] }}>favorite</Icon>\n        {' '}by <a href=\"https://github.com/jonatanklosko\" target=\"_blank\" rel=\"noopener noreferrer\">Jonatan Kłosko</a>\n      </Typography>\n    </Grid>\n    <Grid item>\n      <Grid container spacing={8}>\n        {links.map(({ text, url }) => (\n          <Grid item>\n            <Typography>\n              <a href={url} target=\"_blank\" rel=\"noopener noreferrer\">{text}</a>\n            </Typography>\n          </Grid>\n        ))}\n      </Grid>\n    </Grid>\n  </Grid>\n);\n\nexport default Footer;\n","import React from 'react';\nimport AppBar from '@material-ui/core/AppBar';\nimport Button from '@material-ui/core/Button';\nimport Icon from '@material-ui/core/Icon';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport Typography from '@material-ui/core/Typography';\nimport { Link } from 'react-router-dom';\n\nconst Header = ({ isSignedIn, onSignIn, onSignOut }) => (\n  <AppBar position=\"static\" color=\"primary\">\n    <Toolbar>\n      <Typography variant=\"h6\" color=\"inherit\" style={{ flexGrow: 1 }}>\n        <Link to={isSignedIn ? '/competitions' : '/'}>\n          <Icon style={{ fontSize: '1.5em', verticalAlign: 'middle', marginRight: 10 }}>people</Icon>\n          Groupifier\n        </Link>\n      </Typography>\n      {isSignedIn\n        ? <Button color=\"inherit\" onClick={onSignOut}>Sign out</Button>\n        : <Button color=\"inherit\" onClick={onSignIn}>Sign in</Button>}\n    </Toolbar>\n  </AppBar>\n);\n\nexport default Header;\n","import React from 'react';\nimport Grid from '@material-ui/core/Grid';\nimport Icon from '@material-ui/core/Icon';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Typography from '@material-ui/core/Typography';\n\nconst features = [\n  'Allows for marking competitors as different kinds of staff and handles them in a special manner.',\n  'Supports multiple rooms/stages running simultaneously.',\n  'Suggests number of groups and necessary roles, while leaving the final decision to the user.',\n  'Once configured, creates groups and does its best to optimally assign people to these groups.',\n  'Generates documents like scorecards and competitor cards with task assignments.'\n];\n\nconst Home = () => (\n  <Grid container spacing={24} direction=\"column\">\n    <Grid item>\n      <Typography variant=\"h4\">What is Groupifier?</Typography>\n    </Grid>\n    <Grid item>\n      <Typography variant=\"subtitle1\">\n        Task and group management tool for WCA competition organizers.\n        It's designed to be highly customizable and work well with complex schedules.\n      </Typography>\n    </Grid>\n    <Grid item>\n      <Typography variant=\"h4\">What does it do?</Typography>\n    </Grid>\n    <Grid item>\n      <List>\n        {features.map(feature =>\n          <ListItem key={feature}>\n            <ListItemIcon>\n              <Icon>check</Icon>\n            </ListItemIcon>\n            <ListItemText primary={feature} />\n          </ListItem>\n        )}\n      </List>\n    </Grid>\n  </Grid>\n);\n\nexport default Home;\n","import React, { Component } from 'react';\nimport { HashRouter as Router, Route, Switch, Redirect } from 'react-router-dom';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport Grid from '@material-ui/core/Grid';\nimport { MuiThemeProvider, createMuiTheme } from '@material-ui/core/styles';\nimport indigo from '@material-ui/core/colors/indigo';\nimport grey from '@material-ui/core/colors/grey';\n\nimport Competition from '../Competition/Competition';\nimport CompetitionList from '../CompetitionList/CompetitionList';\nimport Footer from '../Footer/Footer';\nimport Header from '../Header/Header';\nimport Home from '../Home/Home';\n\nimport { isSignedIn, signIn, signOut } from '../../logic/auth';\n\nconst theme = createMuiTheme({\n  palette: {\n    primary: indigo,\n    secondary: grey\n  },\n  typography: {\n    useNextVariants: true,\n  }\n});\n\nexport default class App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isSignedIn: isSignedIn()\n    };\n  }\n\n  handleSignIn = () => {\n    signIn();\n  };\n\n  handleSignOut = () => {\n    signOut();\n    this.setState({ isSignedIn: false })\n  };\n\n  render() {\n    const { isSignedIn } = this.state;\n    return (\n      <Router>\n        <MuiThemeProvider theme={theme}>\n          <div style={{ display: 'flex', minHeight: '100vh', flexDirection: 'column' }}>\n            <CssBaseline />\n            <Header\n              isSignedIn={isSignedIn}\n              onSignIn={this.handleSignIn}\n              onSignOut={this.handleSignOut}\n            />\n            <Grid container justify=\"center\" style={{ flexGrow: 1 }}>\n              <Grid item xs={12} md={8} style={{ padding: 16 }}>\n                {isSignedIn ? (\n                  <Switch>\n                    <Route path=\"/competitions/:competitionId\" component={Competition} />\n                    <Route path=\"/competitions\" component={CompetitionList} />\n                    <Redirect to=\"/competitions\" />\n                  </Switch>\n                ) : (\n                  <Switch>\n                    <Route exact path=\"/\" component={Home} />\n                    <Redirect to=\"/\" />\n                  </Switch>\n                )}\n              </Grid>\n            </Grid>\n            <Footer />\n          </div>\n        </MuiThemeProvider>\n      </Router>\n    );\n  }\n}\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import './polyfills';\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport './index.css';\nimport App from './components/App/App';\nimport registerServiceWorker from './registerServiceWorker';\nimport { initializeAuth } from './logic/auth';\n\ninitializeAuth();\nReactDOM.render(<App />, document.getElementById('root'));\nregisterServiceWorker();\n"],"sourceRoot":""}