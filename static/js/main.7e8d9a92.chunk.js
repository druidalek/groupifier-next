(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{154:function(e,t,n){e.exports=n(363)},159:function(e,t,n){},360:function(e,t,n){},363:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(29),c=n.n(i),o=(n(159),n(10)),u=n(11),l=n(13),s=n(12),d=n(14),f=n(366),m=n(367),h=n(368),p=n(365),g=n(153),v=n.n(g),b=n(5),y=n.n(b),E=n(81),j=n.n(E),C=n(21),O=n.n(C),w=n(364),k=n(35),x=n.n(k),S=n(32),I=n.n(S),R=n(31),W=n.n(R),A=n(41),N=n.n(A),T=n(33),M=n.n(T),D=n(28),U=n.n(D),P=n(20),G=n(25),z=n(44),B=n(24),_=n(45),L=function e(t,n,a){var r=Object(_.a)(n),i=r[0],c=r.slice(1);return 0===c.length?Object(B.a)({},t,Object(z.a)({},i,a(t[i]))):Object(B.a)({},t,Object(z.a)({},i,e(t[i],c,a)))},J=function(e,t,n){return L(e,t,function(){return n})},F=function(e,t,n){return L(e,t,function(e){return e&&e.map(n)})},H=function e(t){return(n=t)===Object(n)?Object.values(t).every(e):null!=t;var n},Y=function(e,t,n){return"".concat(e," ").concat(1===e?t:n||t+"s")},q=function(e){if(0===e.length)return[];var t=ne(e);return e.map(function(n){return 0!==t?n/t:1/e.length})},K=function(e,t){return e.reduce(function(e,n){return e.concat(t(n))},[])},Q=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t[0].map(function(e,n){return t.map(function(e){return e[n]})})},V=function(e,t){return e.filter(function(e){return t.includes(e)})},Z=function(e,t){return e.filter(function(e){return!t.includes(e)})},X=function(e,t){return[e.filter(t),e.filter(function(e){return!t(e)})]},$=function(e,t){return e<t?-1:e>t?1:0},ee=function(e,t){return e.slice().sort(function(e,n){return $(t(e),t(n))})},te=function(e,t){var n=new Map(e.map(function(e){return[e,t(e)]}));return e.slice().sort(function(e,t){return a=Q(n.get(e),n.get(t)),r=function(e){var t=Object(G.a)(e,2),n=t[0],a=t[1];return $(n,a)},a.reduce(function(e,t){return e||r(t)},null);var a,r})},ne=function(e){return e.reduce(function(e,t){return e+t},0)},ae=function(e,t,n){return t<=e&&e<=n},re=function(e,t){return new Date(new Date(e).getTime()+t).toISOString()},ie=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"UTC";return new Date(e).toLocaleTimeString("en-US",{timeZone:t,hour:"numeric",minute:"numeric"})},ce=function(e){return"groupifier.".concat(e)},oe=function(e){return e.extensions||[]},ue=function(e,t,n){var a=oe(t).filter(function(t){return t.id!==ce(e)});return Object(B.a)({},t,{extensions:Object(P.a)(a).concat([function(e,t){return{id:ce(e),specUrl:"".concat("","/wcif-extensions/").concat(e,".json"),data:t}}(e,n)])})},le=function(e,t){var n=oe(t).find(function(t){return t.id===ce(e)});return n?n.data:null},se=function(e,t){return Object(B.a)({},t,{extensions:oe(t).filter(function(t){return t.id!==ce(e)})})},de=[{id:"333",name:"3x3x3 Cube",shortName:"3x3"},{id:"222",name:"2x2x2 Cube",shortName:"2x2"},{id:"444",name:"4x4x4 Cube",shortName:"4x4"},{id:"555",name:"5x5x5 Cube",shortName:"5x5"},{id:"666",name:"6x6x6 Cube",shortName:"6x6"},{id:"777",name:"7x7x7 Cube",shortName:"7x7"},{id:"333bf",name:"3x3x3 Blindfolded",shortName:"3BLD"},{id:"333fm",name:"3x3x3 Fewest Moves",shortName:"FMC"},{id:"333oh",name:"3x3x3 One-Handed",shortName:"3OH"},{id:"333ft",name:"3x3x3 With Feet",shortName:"3WF"},{id:"minx",name:"Megaminx",shortName:"Minx"},{id:"pyram",name:"Pyraminx",shortName:"Pyra"},{id:"clock",name:"Clock",shortName:"Clock"},{id:"skewb",name:"Skewb",shortName:"Skewb"},{id:"sq1",name:"Square-1",shortName:"Sq1"},{id:"444bf",name:"4x4x4 Blindfolded",shortName:"4BLD"},{id:"555bf",name:"5x5x5 Blindfolded",shortName:"5BLD"},{id:"333mbf",name:"3x3x3 Multi-Blind",shortName:"MBLD"}],fe=function(e){return me("name",e)},me=function(e,t){return de.find(function(e){return e.id===t})[e]},he=function(e){var t=e.match(/(\w+)(?:-r(\d+))?(?:-g(\d+))?(?:-a(\d+))?/),n=Object(G.a)(t,5),a=n[1],r=n[2],i=n[3],c=n[4];return{eventId:a,roundNumber:r&&parseInt(r,10),groupNumber:i&&parseInt(i,10),attemptNumber:c&&parseInt(c,10)}},pe=function(e){var t=he(e),n=t.eventId,a=t.roundNumber,r=t.groupNumber,i=t.attemptNumber;return[n&&fe(n),a&&"Round ".concat(a),r&&"Group ".concat(r),i&&"Attempt ".concat(i)].filter(function(e){return e}).join(", ")},ge=function(e){var t=he(e.activityCode),n=t.eventId,a=t.roundNumber,r=t.groupNumber,i=t.attemptNumber;return!(!n||!a||r||i)},ve=function(e){return new Date(e.endTime)-new Date(e.startTime)},be=function(e,t){var n=Pe(e).find(function(e){return e.activities.includes(t)});return le("Room",n).stations},ye=function(e,t,n){var a=n.assignScramblers,r=n.assignRunners,i=n.assignJudges,c=K(Pe(e),function(e){return e.activities.filter(ge)});return K(e.events,function(n){return K(n.rounds,function(n){var o=t[n.id],u=c.filter(function(e){return e.activityCode.startsWith(n.id)}),l=q(u.map(function(t){return be(e,t)*ve(t)}));return Q(u,l).map(function(t){var n=Object(G.a)(t,2),c=n[0],u=n[1],l=be(e,c);return ue("Activity",c,{capacity:u,groups:function(e,t){if(0===t)return 1;var n=1.7*t,a=Math.round(e/n+.4);return Math.max(a,2)}(Math.round(u*o.length),l),scramblers:a?function(e){return Math.floor(Math.log2(e+1))}(l):0,runners:r?function(e){return Math.floor(Math.log(e+2)/Math.log(3))}(l):0,assignJudges:l>0&&i})})})}).reduce(Ee,e)},Ee=function(e,t){return F(e,["schedule","venues"],function(e){return F(e,["rooms"],function(e){return F(e,["activities"],function(e){return e.id===t.id?t:e})})})},je=function(e){return Pe(e).some(function(e){return e.activities.some(function(e){return le("Activity",e)})})},Ce=function(e){return Pe(e).every(function(e){return e.activities.filter(ge).map(function(e){return le("Activity",e)}).every(H)})},Oe=function(e){return Pe(e).map(function(e){return le("Room",e)}).every(H)},we=function(e,t){return e.startTime<t.endTime&&t.startTime<e.endTime},ke=function(e){var t=K(Pe(e),function(e){return e.activities});return Object(P.a)(t).concat(Object(P.a)(K(t,function e(t){var n=t.childActivities;return n.length>0?Object(P.a)(n).concat(Object(P.a)(K(n,e))):n})))},xe=new Map,Se=function(e,t){if(xe.has(e.schedule))return xe.get(e.schedule).get(t);var n=ke(e),a=new Map(n.map(function(e){return[e.id,e]}));return xe.set(e.schedule,a),a.get(t)},Ie=function(e){return["333fm","333mbf"].includes(he(e).eventId)},Re=function(e,t){return K(Pe(e),function(e){return e.activities.filter(function(e){return e.activityCode.startsWith(t)})})},We=function(e,t){return K(Re(e,t),function(e){return Ie(t)?[e]:e.childActivities})},Ae=function(e,t){return e.persons.some(function(e){return(e.assignments||[]).some(function(e){return e.activityId===t})})},Ne=function(e,t){return We(e,t).some(function(t){return Ae(e,t.id)})},Te=function(e){return e.events.map(function(e){return e.rounds.find(function(e){return 0===e.results.length})}).filter(function(e){return e})},Me=function(e){return Te(e).filter(function(t){return!Ne(e,t.id)})},De=function(e){return Te(e).filter(function(t){return Ne(e,t.id)}).filter(function(e){return"333fm"!==he(e.id).eventId})},Ue=function(e){return e.persons.some(function(e){return(e.assignments||[]).some(function(e){return"competitor"===e.assignmentCode})})},Pe=function(e){return K(e.schedule.venues,function(e){return e.rooms})},Ge=[{path:"/roles",text:"Edit roles",icon:"perm_contact_calendar",enabled:function(e){return!0}},{path:"/config",text:"Configure",icon:"settings",enabled:function(e){return!0}},{path:"/groups",text:"Manage groups",icon:"people",enabled:function(e){return Oe(e)&&Ce(e)}},{path:"/printing",text:"Print documents",icon:"print",enabled:function(e){return Ue(e)}}],ze=function(e){var t=e.wcif,n=e.baseUrl;return r.a.createElement(U.a,null,r.a.createElement(I.a,null,Ge.map(function(e){return r.a.createElement(W.a,{key:e.path,button:!0,component:w.a,to:"".concat(n).concat(e.path),disabled:!e.enabled(t)},r.a.createElement(N.a,null,r.a.createElement(x.a,null,e.icon)),r.a.createElement(M.a,{primary:e.text}))})))},Be=n(80),_e=n.n(Be),Le=n(23),Je=n.n(Le),Fe=n(84),He=n.n(Fe),Ye=n(142),qe=n.n(Ye),Ke=function(e){var t=e.room;return r.a.createElement(O.a,{variant:"subtitle2"},r.a.createElement("span",{style:{display:"inline-block",width:10,height:10,marginRight:5,borderRadius:"100%",backgroundColor:t.color}}),r.a.createElement("span",null,t.name))},Qe=n(53),Ve=n(36),Ze=n.n(Ve),Xe=n(77),$e=n.n(Xe),et=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).handleKeyPress=function(e){e.key.match(/\D/)&&e.preventDefault()},n.handleTextFieldChange=function(e){var t=e.target.value.length>0?parseInt(e.target.value,10):null;(null===t||!Number.isNaN(t)&&t>=1)&&n.props.onChange(e,t)},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.value,n=(e.onChange,Object(Qe.a)(e,["value","onChange"]));return r.a.createElement($e.a,Object.assign({},n,{type:"number",value:null===t?"":t,onKeyPress:this.handleKeyPress,onChange:this.handleTextFieldChange}))}}]),t}(a.PureComponent),tt=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(s.a)(t).call(this,e))).handleCheckboxChange=function(e){var t=e.target.checked;n.props.onChange(e,t?null:0)},n.inputRef=r.a.createRef(),n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(e){0===e.value&&0!==this.props.value&&this.inputRef.current.focus()}},{key:"render",value:function(){var e=this.props,t=e.value,n=e.disabled,i=Object(Qe.a)(e,["value","disabled"]);return r.a.createElement(a.Fragment,null,r.a.createElement(et,Object.assign({},i,{value:t,disabled:0===t||n,inputRef:this.inputRef})),r.a.createElement(Ze.a,{name:i.name,checked:0!==t,onChange:this.handleCheckboxChange,disabled:n}))}}]),t}(a.PureComponent),nt=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).handleInputChange=function(e,t){var a=n.props,r=a.room;(0,a.onChange)(ue("Room",r,J(n.roomData,[e.target.name],t)))},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.room,n=e.disabled;return r.a.createElement("div",null,r.a.createElement(Ke,{room:t}),r.a.createElement(tt,{label:"Timing stations",value:this.roomData.stations,name:"stations",onChange:this.handleInputChange,disabled:n}))}},{key:"roomData",get:function(){return le("Room",this.props.room)||{stations:null}}}]),t}(a.Component),at=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).handleRoomChange=function(e){var t=n.props,a=t.wcif;(0,t.onWcifChange)(F(a,["schedule","venues"],function(t){return F(t,["rooms"],function(t){return t.id===e.id?e:t})}))},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props.wcif,n=je(t);return r.a.createElement(U.a,{style:{padding:16}},r.a.createElement(y.a,{container:!0,spacing:16},Pe(t).map(function(t){return r.a.createElement(y.a,{item:!0,lg:!0,key:t.id},r.a.createElement(nt,{room:t,onChange:e.handleRoomChange,disabled:n}))})))}}]),t}(a.Component),rt=n(78),it=n.n(rt),ct=n(136),ot=n.n(ct),ut=n(62),lt=n.n(ut),st=function(e){var t=e.eventId,n=Object(Qe.a)(e,["eventId"]);return r.a.createElement("span",Object.assign({style:{fontSize:24},className:"cubing-icon event-".concat(t)},n))},dt=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.selected,a=t.events;return r.a.createElement("div",null,a.map(function(t){return r.a.createElement(ot.a,{key:t.id,title:fe(t.id),placement:"top"},r.a.createElement(lt.a,{onClick:function(){return e.props.onChange(t.id)}},r.a.createElement(st,{eventId:t.id,style:{opacity:t.id===n?1:.3}})))}))}}]),t}(a.Component),ft=n(137),mt=n.n(ft),ht=n(139),pt=n.n(ht),gt=n(138),vt=n.n(gt),bt=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).handlePanelChange=function(e,t){var a=n.props,r=a.onChange,i=a.roundId;r(t?i:null)},n.scrollToElement=function(e){window.scrollTo({top:e.parentNode.getBoundingClientRect().top-8,behavior:"smooth"})},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.expanded,n=e.roundId,a=e.render;return r.a.createElement(mt.a,{onChange:this.handlePanelChange,expanded:t,CollapseProps:{onEntered:this.scrollToElement}},r.a.createElement(vt.a,{expandIcon:r.a.createElement(x.a,null,"expand_more")},r.a.createElement(O.a,{variant:"subtitle1"},pe(n))),r.a.createElement(pt.a,null,t&&a(n)))}}]),t}(a.Component),yt=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(s.a)(t).call(this,e))).handleEventChange=function(e){n.setState({selectedEventId:e})},n.handleRoundChange=function(e){n.setState({expandedRoundId:e})},n.state={selectedEventId:e.events[0].id,expandedRoundId:null},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.selectedEventId,a=t.expandedRoundId,i=this.props,c=i.events,o=i.render,u=c.find(function(e){return e.id===n});return r.a.createElement(y.a,{container:!0,spacing:8,justify:"flex-end"},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(dt,{selected:n,events:c,onChange:this.handleEventChange})),r.a.createElement(y.a,{item:!0,xs:12},u.rounds.map(function(t){return r.a.createElement(bt,{key:t.id,expanded:t.id===a,roundId:t.id,render:o,onChange:e.handleRoundChange})})))}}]),t}(a.Component),Et=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).handlePropertyChange=function(e,t){var a=n.props,r=a.activity;(0,a.onChange)(ue("Activity",r,J(le("Activity",r),[e],t)))},n.handleInputChange=function(e,t){n.handlePropertyChange(e.target.name,t)},n.handleCheckboxChange=function(e){var t=e.target,a=t.name,r=t.checked;n.handlePropertyChange(a,r)},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.activity!==e.activity}},{key:"render",value:function(){var e=this.props,t=e.activity,n=e.room,a=e.expectedCompetitors,i=e.wcif,c=le("Activity",t),o=c.groups,u=c.scramblers,l=c.runners,s=c.assignJudges,d=c.capacity,f=le("Room",n).stations,m=Math.round(a.length*d),h=Math.round(m/o),p=o?Y(h,"person","people")+" in group":" ",g=u?Y(Math.round(h/u),"cube")+" per scrambler":" ",v=l?Y(Math.round(f/l),"station")+" per runner":" ",b=t.childActivities.length>0,E=t.childActivities.some(function(e){var t=e.id;return Ae(i,t)});return r.a.createElement(y.a,{container:!0,direction:"column"},r.a.createElement(y.a,{item:!0},r.a.createElement(et,{label:"Groups",value:o,name:"groups",helperText:p,onChange:this.handleInputChange,margin:"dense",disabled:b||E})),r.a.createElement(y.a,{item:!0},r.a.createElement(tt,{label:"Scramblers",value:u,name:"scramblers",helperText:g,onChange:this.handleInputChange,margin:"dense",disabled:E})),r.a.createElement(y.a,{item:!0},r.a.createElement(tt,{label:"Runners",value:l,name:"runners",helperText:v,onChange:this.handleInputChange,margin:"dense",disabled:E})),r.a.createElement(y.a,{item:!0},r.a.createElement(it.a,{control:r.a.createElement(Ze.a,{checked:s,name:"assignJudges",onChange:this.handleCheckboxChange,disabled:0===f||E}),label:"Assign judges"})))}}]),t}(a.Component),jt=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).handleActivityChange=function(e){var t=n.props,a=t.wcif;(0,t.onWcifChange)(Ee(a,e))},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.roundId,a=t.wcif,i=t.expectedCompetitorsByRound,c=K(Pe(a),function(e){return e.activities.filter(function(e){return e.activityCode===n}).map(function(t){return[t,e]})});return r.a.createElement(y.a,{container:!0,spacing:16},c.map(function(t){var c=Object(G.a)(t,2),o=c[0],u=c[1];return r.a.createElement(y.a,{item:!0,xs:!0,key:o.id},r.a.createElement(Ke,{room:u}),r.a.createElement(Et,{wcif:a,activity:o,room:u,onChange:e.handleActivityChange,expectedCompetitors:i[n]}))}))}}]),t}(a.PureComponent),Ct=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(s.a)(t).call(this,e))).handleCheckboxChange=function(e){var t=e.target,a=t.name,r=t.checked;n.setState(Object(z.a)({},a,r))},n.handleNextClick=function(){var e=n.props,t=e.wcif,a=e.expectedCompetitorsByRound;(0,e.onWcifChange)(ye(t,a,n.state))},n.renderRound=function(e){var t=n.props,a=t.wcif,i=t.expectedCompetitorsByRound,c=t.onWcifChange;return r.a.createElement(jt,{roundId:e,expectedCompetitorsByRound:i,wcif:a,onWcifChange:c})},n.state={assignScramblers:!0,assignRunners:!0,assignJudges:!0},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props.wcif,n=t.events.filter(function(e){return!Ie(e.id)});return je(t)?r.a.createElement(yt,{events:n,render:this.renderRound}):r.a.createElement(U.a,{style:{padding:16}},r.a.createElement(O.a,{variant:"h5"},"Generate configuration"),r.a.createElement(y.a,{container:!0,direction:"column"},r.a.createElement(y.a,{item:!0,style:{margin:"0.5em 0"}},r.a.createElement(O.a,{variant:"body1"},"Which of the following roles would you like to assign?")),["Scramblers","Runners","Judges"].map(function(t){return r.a.createElement(y.a,{item:!0,key:t},r.a.createElement(it.a,{control:r.a.createElement(Ze.a,{checked:e.state["assign".concat(t)],name:"assign".concat(t),onChange:e.handleCheckboxChange}),label:t}))})),r.a.createElement(Je.a,{onClick:this.handleNextClick},"Next"))}}]),t}(a.Component),Ot=n(141),wt=n.n(Ot),kt=n(140),xt=n.n(kt),St=function(){return localStorage.getItem("Groupifier.accessToken")},It=function(){var e=window.location.href.split("/#")[0],t=new URLSearchParams({client_id:"d965f9184bbcf9dfade91e2327c05e2aedef7cd7b6c01c1de7e3e23d62530e5a",response_type:"token",redirect_uri:e,scope:"manage_competitions"});window.location="".concat("https://www.worldcubeassociation.org","/oauth/authorize?").concat(t)},Rt=function(){return localStorage.removeItem("Groupifier.accessToken")},Wt=function(){return!!St()},At=function(e,t){return Promise.all([e.persons!==t.persons&&Nt(t,"persons"),e.events!==t.events&&Nt(t,"events"),e.schedule!==t.schedule&&Nt(t,"schedule")])},Nt=function(e,t){return Tt("/competitions/".concat(e.id,"/wcif/").concat(t),{method:"PATCH",body:JSON.stringify(e[t])})},Tt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat("https://www.worldcubeassociation.org","/api/v0");return fetch("".concat(n).concat(e),Object.assign({},t,{headers:new Headers({Authorization:"Bearer ".concat(St()),"Content-Type":"application/json"})})).then(function(e){return e.json()})},Mt=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).state={saving:!1,failed:!1},n.handleSaveClick=function(){var e=n.props,t=e.wcif,a=e.updatedWcif,r=e.onWcifUpdate,i=e.history;n.setState({saving:!0,failed:!1}),At(t,a).then(function(){r(a),i.push("/competitions/".concat(a.id))}).catch(function(){return n.setState({saving:!1,failed:!0})})},n.handleSnackbarClose=function(){n.setState({failed:!1})},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.saving,n=e.failed,i=this.props.disabled;return r.a.createElement(a.Fragment,null,r.a.createElement(xt.a,{open:n,message:"Failed to save data to the WCA website.",anchorOrigin:{vertical:"bottom",horizontal:"left"},autoHideDuration:5e3,onClose:this.handleSnackbarClose}),r.a.createElement(Je.a,{variant:"contained",color:"primary",onClick:this.handleSaveClick,disabled:i||t},r.a.createElement("span",{style:t?{visibility:"hidden"}:{}},"Save"),t&&r.a.createElement(wt.a,{size:20,style:{position:"absolute"}})))}}]),t}(a.Component),Dt=function(e,t,n){if(!["single","average"].includes(n))throw new Error("Personal best type must be either 'single' or 'average'. Received '".concat(n,"'."));var a=e.personalBests.find(function(e){return e.eventId===t&&e.type===n});return a?a.best:1/0},Ut=function(e,t){return[Dt(e,t,"average"),Dt(e,t,"single")]},Pt=function(e){return e.events.reduce(function(t,n){var a=Object(_.a)(n.rounds),r=a[0],i=a.slice(1),c=e.persons.filter(function(e){return e.registration&&e.registration.eventIds.includes(n.id)});return t[r.id]=te(c,function(e){return Ut(e,n.id)}),i.reduce(function(e,a){var r=Object(G.a)(e,2),i=r[0],c=r[1],o=i.advancementCondition;if(!o)throw new Error("Mising advancement condition for ".concat(pe(i.id),"."));var u=function(e,t,n){switch(t.type){case"ranking":return e.slice(0,t.level);case"percent":return e.slice(0,Math.floor(e.length*t.level*.01));case"attemptResult":return e.filter(function(e){return Dt(e,n,"single")<t.level});default:throw new Error("Unrecognised AdvancementCondition type: '".concat(t.type,"'"))}}(c,o,n.id);return t[a.id]=u,[a,u]},[r,t[r.id]]),t},{})},Gt=function(e,t){var n=ee(e.filter(function(e){return e.attempts.length>0}),function(e){return e.ranking}),a=Math.floor(.75*n.length),r=n[a].rank;return n.filter(function(e){return e.rank<r}).filter(function(e){return function(e,t,n){var a=t.type,r=t.level;if("ranking"===a)return e.ranking<=r;if("percent"===a)return e.ranking<=Math.floor(n*r*.01);if("attemptResult"===a)return e.attempts.some(function(e){return e.result<r});throw new Error("Unrecognised AdvancementCondition type: '".concat(a,"'"))}(e,t,n.length)})},zt=function(e,t){var n=he(t),a=n.eventId,r=n.roundNumber;if(1===r){var i=e.persons.filter(function(e){var t=e.registration;return t&&"accepted"===t.status&&t.eventIds.includes(a)});return te(i,function(e){return Ut(e,a).map(function(e){return-e})})}var c=e.events.find(function(e){return e.id===a}).rounds.find(function(e){return he(e.id).roundNumber===r-1}),o=c.results,u=c.advancementCondition;return ee(Gt(o,u),function(e){return-e.ranking}).map(function(t){return e.persons.find(function(e){return e.registrantId===t.personId})})},Bt=function(e){var t=Date.now()-new Date(e.birthdate).getTime();return Math.floor(t/31556952e3)},_t=function(e){return(e.assignments||[]).filter(function(e){return e.assignmentCode.startsWith("staff-")})},Lt=function(e,t,n){return _t(t).filter(function(t){var a=t.activityId;return he(Se(e,a).activityCode).eventId===n})},Jt=function(e){return e.persons.filter(function(e){return!e.registration||"accepted"===e.registration.status})},Ft=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(s.a)(t).call(this,e))).handleWcifChange=function(e){n.setState({localWcif:e})},n.handleTabChange=function(e,t){n.setState({tabValue:t})},n.clearConfig=function(){var e=n.state.localWcif;n.setState({tabValue:0,localWcif:F(e,["schedule","venues"],function(e){return F(e,["rooms"],function(e){return se("Room",F(e,["activities"],function(e){return se("Activity",e)}))})})})},n.state={localWcif:e.wcif,tabValue:0},n.expectedCompetitorsByRound=Pt(e.wcif),n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state,t=e.tabValue,n=e.localWcif,a=this.props,i=a.wcif,c=a.onWcifUpdate,o=a.history,u=Oe(n)&&Ce(n);return r.a.createElement(y.a,{container:!0,spacing:8,justify:"flex-end"},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(_e.a,{position:"static",color:"default"},r.a.createElement(qe.a,{value:t,onChange:this.handleTabChange,centered:!0},r.a.createElement(He.a,{label:"Rooms"}),r.a.createElement(He.a,{label:"Rounds",disabled:!Oe(n)}),r.a.createElement(He.a,{label:"General"})))),r.a.createElement(y.a,{item:!0,xs:12},0===t&&r.a.createElement(at,{wcif:n,onWcifChange:this.handleWcifChange}),1===t&&r.a.createElement(Ct,{wcif:n,onWcifChange:this.handleWcifChange,expectedCompetitorsByRound:this.expectedCompetitorsByRound}),2===t&&r.a.createElement(U.a,null,r.a.createElement(O.a,null,"General settings"))),r.a.createElement(y.a,{item:!0},r.a.createElement(Je.a,{variant:"contained",component:w.a,to:"/competitions/".concat(n.id)},"Cancel")),r.a.createElement(y.a,{item:!0},r.a.createElement(Je.a,{variant:"contained",onClick:this.clearConfig,disabled:function(e){return e.events.some(function(t){return t.rounds.some(function(n){return Ie(t.id)?Ue(e,n.id):We(e,n.id).length>0})})}(n)},"Clear")),r.a.createElement(y.a,{item:!0},r.a.createElement(Mt,{wcif:i,updatedWcif:n,onWcifUpdate:c,history:o,disabled:!u})))}}]),t}(a.Component),Ht=n(79),Yt=n.n(Ht),qt=n(143),Kt=n.n(qt),Qt=n(146),Vt=n.n(Qt),Zt=n(145),Xt=n.n(Zt),$t=n(144),en=n.n($t),tn=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.wcif,n=e.groupActivity,a=e.onClose,i=e.open,c=[{id:"competitor",label:"Competitors"},{id:"staff-scrambler",label:"Scramblers"},{id:"staff-runner",label:"Runners"},{id:"staff-judge",label:"Judges"}].map(function(e){return[e,t.persons.filter(function(t){return(t.assignments||[]).find(function(t){var a=t.activityId,r=t.assignmentCode;return a===n.id&&r===e.id})})]}).filter(function(e){var t=Object(G.a)(e,2);t[0];return t[1].length>0});return r.a.createElement(Kt.a,{open:i,onClose:a,maxWidth:!1},r.a.createElement(en.a,null,pe(n.activityCode)),r.a.createElement(Xt.a,null,r.a.createElement(y.a,{container:!0,spacing:16},c.map(function(e){var t=Object(G.a)(e,2),n=t[0],a=t[1];return r.a.createElement(y.a,{item:!0,xs:12,sm:6,md:!0,key:n.id},r.a.createElement(O.a,{variant:"subtitle2"},n.label),r.a.createElement(I.a,{dense:!0,style:{overflowY:"auto",maxHeight:300}},ee(a,function(e){return e.name}).map(function(e){return r.a.createElement(W.a,{key:e.wcaUserId},r.a.createElement(M.a,{primary:e.name}))})))}),0===c.length&&r.a.createElement(y.a,{item:!0},r.a.createElement(O.a,{variant:"body2"},"No assignments for this round.")))),r.a.createElement(Vt.a,null,r.a.createElement(Je.a,{onClick:a,color:"primary"},"Ok")))}}]),t}(a.Component),nn=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return(n=Object(l.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(i)))).state={openedGroupActivity:null},n.handleGroupClick=function(e){n.setState({openedGroupActivity:e})},n.handleDialogClose=function(){n.setState({openedGroupActivity:null})},n.renderRound=function(e){var t=n.props.wcif,a=K(t.schedule.venues,function(t){return t.rooms.map(function(n){return[n,t.timezone,K(n.activities.filter(function(t){return t.activityCode===e}),function(e){return e.childActivities})]})});return r.a.createElement(y.a,{container:!0},a.map(function(e){var t=Object(G.a)(e,3),a=t[0],i=t[1],c=t[2];return c.length>0&&r.a.createElement(y.a,{item:!0,xs:12,sm:!0,key:a.id},r.a.createElement(Ke,{room:a}),r.a.createElement(I.a,null,c.map(function(e){return r.a.createElement(W.a,{key:e.id,button:!0,onClick:function(){return n.handleGroupClick(e)}},r.a.createElement(M.a,{primary:"Group ".concat(he(e.activityCode).groupNumber),secondary:"".concat(ie(e.startTime,i)," - ").concat(ie(e.endTime,i))}))})))}))},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state.openedGroupActivity,t=this.props.wcif,n=t.events.filter(function(e){return!Ie(e.id)});return r.a.createElement(r.a.Fragment,null,r.a.createElement(yt,{events:n,render:this.renderRound}),e&&r.a.createElement(tn,{open:!0,groupActivity:e,wcif:t,onClose:this.handleDialogClose}))}}]),t}(a.Component),an=function(e){return K(e.events,function(e){return e.rounds}).reduce(function(e,t){if(Ie(t.id))return e;if(We(e,t.id).length>0)return e;var n=function(e){return Math.max.apply(Math,Object(P.a)(ke(e).map(function(e){return e.id})))}(e),a=Re(e,t.id).map(function(e){var t=le("Activity",e).groups,n=ve(e)/t,a=Array.from({length:t},function(t,a){return{id:null,name:null,activityCode:null,startTime:re(e.startTime,n*a),endTime:re(e.startTime,n*a+n),childActivities:[],scrambleSetId:null}});return Object(B.a)({},e,{childActivities:a})});return te(K(a,function(e){return e.childActivities}),function(e){return[e.startTime,e.endTime]}).forEach(function(e,a){var r="".concat(t.id,"-g").concat(a+1);return Object.assign(e,{id:n+a+1,name:pe(r),activityCode:r})}),a.reduce(Ee,e)},e)},rn=function(e){var t=Me(e);return[cn,pn,gn,vn].reduce(function(e,n){return n(e,t)},e)},cn=function(e,t){return ee(t,function(t){return Ie(t.id)?-1/0:We(e,t.id).length}).reduce(function(e,t){var n=zt(e,t.id);if(Ie(t.id)){var a=Re(e,t.id).reduce(function(e,t){return yn(t,"competitor",e)},n);return En(e,a)}var r=K(Re(e,t.id),function(e){var t=le("Activity",e).capacity;return e.childActivities.map(function(n){return[n,t/e.childActivities.length]})}),i=Q.apply(void 0,Object(P.a)(r)),c=Object(G.a)(i,2),o=c[0],u=c[1],l=on(u,n.length),s=Q(o,l).map(function(e){var t=Object(G.a)(e,2),n=t[0],a=t[1];return{id:n.id,activity:n,size:a,competitors:[]}}),d=ee(s,function(e){var t=e.activity;return he(t.activityCode).groupNumber}),f=n.reduce(function(t,n){var a=t.map(function(t){return Cn(e,t.activity,n)}),r=Math.max.apply(Math,Object(P.a)(a)),i=t.filter(function(e,t){return a[t]===r}),c=i.filter(function(a){return!On(e,t,a.activity,n)}),o=c.length>0?c:i,u=o.find(function(e){var t=e.size;return e.competitors.length<t});if(u)return dn(t,u.id,n);var l=o[o.length-1],s=dn(t,l.id,n);return un(e,s,l.id)||ln(e,s,l.id)||s},d),m=K(f,function(e){var t=e.activity,n=e.competitors;return yn(t,"competitor",n)});return En(e,m)},e)},on=function e(t,n){var a=Object(_.a)(t),r=a[0],i=a.slice(1);if(!r)return[];var c=Math.round(r*n);return[c].concat(Object(P.a)(e(q(i),n-c)))},un=function e(t,n,a){var r=n.find(function(e){return e.id===a});return n.slice(n.indexOf(r)+1).reduce(function(i,c){if(i)return i;var o,u,l=(o=r.competitors,u=function(e){return Cn(t,r.activity,e)===Cn(t,c.activity,e)&&!On(t,n,c.activity,e)},o.reduceRight(function(e,t){return void 0!==e?e:u(t)?t:void 0},void 0));if(!l)return null;if(c.competitors.length<c.size)return mn(n,a,c.id,l);if(c.competitors.length===c.size){var s=e(t,n,c.id);return s&&mn(s,a,c.id,l)}return null},null)},ln=function(e,t,n){var a=t.find(function(e){return e.id===n});return t.slice(0,t.indexOf(a)).reduceRight(function(r,i){if(r)return r;var c=a.competitors.find(function(n){return Cn(e,a.activity,n)===Cn(e,i.activity,n)&&!On(e,t,i.activity,n)});if(!c)return null;var o=un(e,t,i.id);return o&&hn(o,n,i.id,c)},null)},sn=function(e,t,n){return e.map(function(e){return e.id===t?L(e,["competitors"],n):e})},dn=function(e,t,n){return sn(e,t,function(e){return Object(P.a)(e).concat([n])})},fn=function(e,t,n){return sn(e,t,function(e){return e.filter(function(e){return e!==n})})},mn=function(e,t,n,a){return function(e,t,n){return sn(e,t,function(e){return[n].concat(Object(P.a)(e))})}(fn(e,t,a),n,a)},hn=function(e,t,n,a){return dn(fn(e,t,a),n,a)},pn=function(e,t){return ee(t,function(t){return zt(e,t.id).length}).reduce(function(e,t){if(Ie(t.id))return e;var n=he(t.id).eventId;return Re(e,t.id).reduce(function(e,a){var r=le("Activity",a).scramblers;return 0===r?e:a.childActivities.reduce(function(e,a){var i=Jt(e).filter(function(e){return e.roles.includes("staff-scrambler")}),c=Z(zt(e,t.id),i),o=function(t){return t.filter(function(t){return jn(e,a,t)})},u=te(o(i),function(e){return[Math.floor(_t(e).length/3)].concat(Object(P.a)(Ut(e,n)))}),l=u.length>=r?[]:te(o(c),function(t){return[Bt(t)>=10?-1:1,V(["dataentry","delegate","organizer"],t.roles).length,Lt(e,t,n).length>=2?1:-1,Math.floor(_t(t).length/6),bn(e,t,a.endTime)?1:-1].concat(Object(P.a)(Ut(t,n)))}),s=Object(P.a)(u).concat(Object(P.a)(l)),d=yn(a,"staff-scrambler",s.slice(0,r));return En(e,d)},e)},e)},e)},gn=function(e,t){return t.reduce(function(e,t){if(Ie(t.id))return e;var n=he(t.id).eventId;return Re(e,t.id).reduce(function(e,t){var a=le("Activity",t).runners;return 0===a?e:t.childActivities.reduce(function(e,t){var r=X(Jt(e),function(e){return e.roles.includes("staff-runner")}),i=Object(G.a)(r,2),c=i[0],o=i[1],u=function(n){return n.filter(function(n){return jn(e,t,n)})},l=te(u(c),function(n){return[Math.floor(_t(n).length/3),bn(e,n,t.endTime)?1:-1]}),s=l.length>=a?[]:te(u(o),function(a){return[Bt(a)>=10?-1:1,V(["dataentry","delegate","organizer"],a.roles).length,Lt(e,a,n).length>=2?1:-1,Math.floor(_t(a).length/6),bn(e,a,t.endTime)?1:-1]}),d=Object(P.a)(l).concat(Object(P.a)(s)),f=yn(t,"staff-runner",d.slice(0,a));return En(e,f)},e)},e)},e)},vn=function(e,t){return t.reduce(function(e,t){if(Ie(t.id))return e;var n=he(t.id).eventId;return Re(e,t.id).reduce(function(e,t){var a=le("Activity",t).assignJudges,r=be(e,t);return a?t.childActivities.reduce(function(e,t){var a=X(Jt(e),function(e){return e.roles.includes("staff-judge")}),i=Object(G.a)(a,2),c=i[0],o=i[1],u=function(n){return n.filter(function(n){return jn(e,t,n)})},l=te(u(c),function(n){return[_t(n).length,bn(e,n,t.endTime)?1:-1]}),s=l.length>=r?[]:te(u(o),function(a){return[Bt(a)>=10?-1:1,V(["dataentry","delegate","organizer"],a.roles).length,Lt(e,a,n).length>=2?1:-1,_t(a).length,bn(e,a,t.endTime)?1:-1,a.registration?a.registration.eventIds.length:0]}),d=Object(P.a)(l).concat(Object(P.a)(s)),f=yn(t,"staff-judge",d.slice(0,r));return En(e,f)},e):e},e)},e)},bn=function(e,t,n){var a=(t.assignments||[]).filter(function(e){return"competitor"===e.assignmentCode}).map(function(t){var n=t.activityId;return Se(e,n).startTime}).filter(function(e){return e>=n});if(0===a.length)return!1;var r=a.reduce(function(e,t){return e<t?e:t});return new Date(r)-new Date(n)<=9e5},yn=function(e,t,n){return n.map(function(n){return Object(B.a)({},n,{assignments:Object(P.a)(n.assignments||[]).concat([{activityId:e.id,assignmentCode:t}])})})},En=function(e,t){return F(e,["persons"],function(e){return t.find(function(t){return t.wcaUserId===e.wcaUserId})||e})},jn=function(e,t,n){return!(n.assignments||[]).some(function(n){var a=n.activityId;return we(Se(e,a),t)})},Cn=function(e,t,n){var a=(n.assignments||[]).map(function(n){var a=n.activityId;return function(e,t){if(!we(e,t))return 0;var n=[e.startTime,e.endTime,t.startTime,t.endTime].sort(),a=Object(G.a)(n,3),r=a[1],i=a[2];return new Date(i)-new Date(r)}(Se(e,a),t)});return-ne(a)/ve(t)},On=function(e,t,n,a){return V(["dataentry","delegate","organizer"],a.roles).some(function(a){var r=Jt(e).filter(function(e){return e.roles.includes(a)});return r.length>0&&r.every(function(a){return!jn(e,n,a)||t.some(function(e){var t=e.activity;return e.competitors.includes(a)&&we(t,n)})})})},wn=function(e){return F(e,["events"],function(t){return F(t,["rounds"],function(t){return J(t,["scrambleSetCount"],kn(e,t.id))})})},kn=function(e,t){return Ie(t)?1:(n=We(e,t).map(function(e){return e.startTime+e.endTime}),Object(P.a)(new Set(n))).length;var n},xn=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(s.a)(t).call(this,e))).createGroupActivities=function(){var e=n.state.localWcif;n.setState({localWcif:wn(an(e))})},n.assignTasks=function(){var e=n.state.localWcif,t=performance.now(),a=rn(e);console.log(a,"Took",performance.now()-t),n.setState({localWcif:a})},n.clearGroups=function(){var e=n.state.localWcif,t=e.persons.map(function(e){return L(e,["assignments"],function(e){return(e||[]).filter(function(e){var t=e.assignmentCode;return!t.startsWith("staff-")&&"competitor"!==t})})}),a=F(e.schedule,["venues"],function(e){return F(e,["rooms"],function(e){return F(e,["activities"],function(e){return J(e,["childActivities"],[])})})});n.setState({localWcif:Object(B.a)({},e,{persons:t,schedule:a})})},n.state={localWcif:e.wcif},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state.localWcif,t=this.props,n=t.wcif,a=t.onWcifUpdate,i=t.history,c=function(e){return e.events.every(function(t){return t.rounds.every(function(t){return We(e,t.id).length>0})})}(e);return r.a.createElement(y.a,{container:!0,spacing:8,justify:"flex-end"},r.a.createElement(y.a,{item:!0,xs:12},!c&&r.a.createElement(Yt.a,{style:{maxWidth:"none"},message:"To assign tasks you need to create groups first. This will also determine scramble set count for each round.",action:r.a.createElement(Je.a,{onClick:this.createGroupActivities,color:"secondary",size:"small"},"Create groups")}),c&&Me(e).length>0&&r.a.createElement(Yt.a,{style:{maxWidth:"none"},message:"There are rounds with no tasks assigned.",action:r.a.createElement(Je.a,{onClick:this.assignTasks,color:"secondary",size:"small"},"Assign tasks")})),r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(nn,{wcif:e})),r.a.createElement(y.a,{item:!0},r.a.createElement(Je.a,{variant:"contained",component:w.a,to:"/competitions/".concat(e.id)},"Cancel")),r.a.createElement(y.a,{item:!0},r.a.createElement(Je.a,{variant:"contained",onClick:this.clearGroups,disabled:function(e){return e.events.some(function(e){return e.rounds.some(function(e){return e.results.length>0})})}(e)},"Clear")),r.a.createElement(y.a,{item:!0},r.a.createElement(Mt,{wcif:n,updatedWcif:e,onWcifUpdate:a,history:i})))}}]),t}(a.Component),Sn=function(e){var t=e.centiseconds,n=e.cumulativeRoundIds,a=Rn(t);if(0===n.length)return a;if(1===n.length)return"".concat(a," in total");var r=n.map(function(e){var t=he(e),n=t.eventId,a=t.roundNumber;return"".concat(function(e){return me("shortName",e)}(n)," R").concat(a)});return"".concat(a," total for ").concat(r.join(", "))},In=function(e){return 99-Math.floor(e/1e7)%100},Rn=function(e){var t=new Date(null);return t.setUTCMilliseconds(10*e),t.toISOString().substr(11,11).replace(/^[0:]*(?!\.)/g,"")},Wn=n(85),An=n.n(Wn);fetch("vfs-fonts.bundle.json").then(function(e){return e.json()}).then(function(e){return An.a.vfs=e});var Nn=function(e){return{normal:e,bold:e,italic:e,bolditalics:e}};An.a.fonts={Roboto:{normal:"Roboto-Regular.ttf",bold:"Roboto-Medium.ttf",italics:"Roboto-Italic.ttf",bolditalics:"Roboto-MediumItalic.ttf"},WenQuanYiZenHei:Nn("WenQuanYiZenHei.ttf"),NotoSansThai:Nn("NotoSansThai-Regular.ttf"),NotoSansArabic:Nn("NotoSansArabic-Regular.ttf"),NotoSansGeorgian:Nn("NotoSansGeorgian-Regular.ttf"),NotoSansArmenian:Nn("NotoSansArmenian-Regular.ttf")};var Tn=An.a,Mn=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.match(/(.+)\s*[(\uff08](.+)[)\uff09]/)||[null,e,null],a=Object(G.a)(n,3),r=a[1],i=a[2];if(!i)return r;var c=[r,{text:i,font:function(e){var t=e.charCodeAt(0);return ae(t,0,1327)?"Roboto":ae(t,1536,1791)||ae(t,1872,1919)?"NotoSansArabic":ae(t,3584,3711)?"NotoSansThai":ae(t,1328,1423)?"NotoSansArmenian":ae(t,4256,4351)?"NotoSansGeorgian":"WenQuanYiZenHei"}(i)}],o=t?c.reverse():c,u=Object(G.a)(o,2);return[u[0]," (",u[1],")"]},Dn={1:1,2:2,3:3,m:3,a:5},Un=function(e,t){var n=performance.now(),a=Pn(e,t);console.log("Definition took",performance.now()-n);var r=performance.now();Tn.createPdf(a).download("".concat(e.id,"-scorecards.pdf")),console.log("PDF creation took",performance.now()-r)},Pn=function(e,t){return{background:[{canvas:[Gn({x1:20,y1:420.945,x2:575.28,y2:420.945}),Gn({x1:297.64,y1:20,x2:297.64,y2:821.89})]}],pageMargins:[20,20],content:{layout:{paddingLeft:function(e){return e%2===0?0:20},paddingRight:function(e){return e%2===0?20:0},paddingTop:function(e){return e%2===0?0:20},paddingBottom:function(e){return e%2===0?20:0},hLineWidth:function(){return 0},vLineWidth:function(){return 0}},table:{widths:["*","*"],heights:380.945,dontBreakRows:!0,body:function e(t,n){return t.length<=n?[t]:[t.slice(0,n)].concat(Object(P.a)(e(t.slice(n),n)))}(zn(e,t),2)}}}},Gn=function(e){return Object(B.a)({},e,{type:"line",lineWidth:.1,dash:{length:10},lineColor:"#888888"})},zn=function(e,t){return K(t,function(t){var n=ee(We(e,t.id),function(e){var t=e.activityCode;return he(t).groupNumber}),a=zt(e,t.id),r=a.length;return K(n,function(n){var i=a.filter(function(e){return(e.assignments||[]).find(function(e){return e.activityId===n.id&&"competitor"===e.assignmentCode})}).map(function(a){return Bn({scorecardNumber:r--,competitionName:e.shortName,activityCode:n.activityCode,round:t,competitor:a})}),c=i.length%4;return 0===c?i:i.concat(Array.from({length:4-c},function(){return{}}))})})},Bn=function(e){var t=e.scorecardNumber,n=e.competitionName,a=e.activityCode,r=e.round,i=e.competitor,c=he(a),o=c.eventId,u=c.roundNumber,l=c.groupNumber,s=r.cutoff,d=r.timeLimit,f=Dn[r.format];return[{text:t,fontSize:10},{text:n,bold:!0,fontSize:15,margin:[0,0,0,10],alignment:"center"},{margin:[25,0,0,0],table:{widths:["*","auto","auto"],body:[_n(["Event","Round","Group"]),[fe(o),{text:u,alignment:"center"},{text:l,alignment:"center"}]]}},{margin:[25,0,0,0],table:{widths:["auto","*"],body:[_n(["ID","Name"]),[{text:i.registrantId,alignment:"center"},{text:Mn(i.name),maxHeight:20}]]}},{margin:[0,10,0,0],table:{widths:[16,25,"*",25,25],body:[_n(["","Scr","Result","Judge","Comp"],{alignment:"center"})].concat(Object(P.a)(Ln(s,f)),[[Object(B.a)({text:"Extra attempt"},Hn,{colSpan:5,margin:[0,1],fontSize:10})],Fn("_"),[Object(B.a)({text:""},Hn,{colSpan:5,margin:[0,1]})]])}},{fontSize:10,columns:[s?{text:"Cutoff: ".concat(function(e,t){return"333mbf"===t?"".concat(In(e.attemptResult)," points"):"333fm"===t?"".concat(e.attemptResult," moves"):Rn(e.attemptResult)}(s,o)),alignment:"center"}:{},d?{text:"Time limit: ".concat(Sn(d)),alignment:"center"}:{}]}]},_n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.map(function(e){return Object(B.a)({},t,Hn,{fontSize:9,text:e})})},Ln=function(e,t){return Array.from({length:t},function(e,t){return Fn(t+1)}).reduce(function(n,a,r){return r+1===t?Object(P.a)(n).concat([a]):Object(P.a)(n).concat([a,Jn(e&&r+1===e.numberOfAttempts)])},[])},Jn=function(e){return[Object(B.a)({},Hn,{colSpan:5,margin:[0,1],columns:e?[{canvas:[{type:"line",x1:0,y1:0,x2:257.64,y2:0,dash:{length:5}}]}]:[]})]},Fn=function(e){return[Object(B.a)({text:e},Hn,{fontSize:20,bold:!0,alignment:"center"}),{},{},{},{}]},Hn={border:[!1,!1,!1,!1]},Yn=function(e){function t(e){var n;Object(o.a)(this,t),(n=Object(l.a)(this,Object(s.a)(t).call(this,e))).handleDownloadClick=function(){Un(n.props.wcif,n.state.selectedRounds)},n.handleRoundClick=function(e){return function(t){var a=n.state.selectedRounds;n.setState({selectedRounds:a.includes(e)?Z(a,[e]):Object(P.a)(a).concat([e])})}};var a=De(n.props.wcif),r=a.every(function(e){return 1===he(e.id).roundNumber})?a:[];return n.state={selectedRounds:r},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.state.selectedRounds,n=this.props.wcif,a=De(n);return r.a.createElement(y.a,{container:!0,spacing:8,justify:"flex-end"},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(U.a,{style:{padding:16}},r.a.createElement(O.a,{variant:"h5"},"Scorecards"),r.a.createElement(I.a,{style:{width:400}},a.map(function(n){return r.a.createElement(W.a,{key:n.id,button:!0,onClick:e.handleRoundClick(n)},r.a.createElement(N.a,null,r.a.createElement(st,{eventId:he(n.id).eventId})),r.a.createElement(M.a,{primary:pe(n.id)}),r.a.createElement(Ze.a,{checked:t.includes(n),tabIndex:-1,disableRipple:!0,style:{padding:0}}))})),r.a.createElement(Je.a,{onClick:this.handleDownloadClick,disabled:0===t.length},"Download scorecards"))),r.a.createElement(y.a,{item:!0},r.a.createElement(Je.a,{variant:"contained",color:"primary",component:w.a,to:"/competitions/".concat(n.id)},"Done")))}}]),t}(a.Component),qn=n(147),Kn=n.n(qn),Qn=n(149),Vn=n.n(Qn),Zn=n(54),Xn=n.n(Zn),$n=n(148),ea=n.n($n),ta=n(150),na=n.n(ta),aa=n(97),ra=n.n(aa),ia=n(63),ca=n.n(ia),oa=[{id:"staff-scrambler",name:"Scrambler"},{id:"staff-judge",name:"Judge"},{id:"staff-runner",name:"Runner"},{id:"staff-dataentry",name:"Data entry"}],ua=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(s.a)(t).call(this,e))).handleSearchChange=function(e){n.setState({searchString:e.target.value})},n.handleChangePage=function(e,t){n.setState({page:t})},n.clearRoles=function(){var e=n.state.localWcif,t=oa.map(function(e){return e.id});n.setState({localWcif:Object(B.a)({},e,{persons:e.persons.map(function(e){return Object(B.a)({},e,{roles:Z(e.roles,t)})})})})},n.state={localWcif:e.wcif,page:0,searchString:""},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"handleRoleChange",value:function(e,t,n){var a=this.state.localWcif,r=n.target.checked;this.setState({localWcif:Object(B.a)({},a,{persons:a.persons.map(function(n){return n.wcaUserId===t?Object(B.a)({},n,{roles:r?Object(P.a)(n.roles).concat([e]):Z(n.roles,[e])}):n})})})}},{key:"render",value:function(){var e=this,t=this.state,n=t.page,a=t.searchString,i=t.localWcif,c=this.props,o=c.wcif,u=c.onWcifUpdate,l=c.history,s=Jt(i).filter(function(e){return e.name.match(new RegExp(a,"i"))});return r.a.createElement(y.a,{container:!0,spacing:8,justify:"flex-end"},r.a.createElement(y.a,{item:!0,xs:12},r.a.createElement(U.a,null,r.a.createElement(ca.a,null,r.a.createElement($e.a,{label:"Search",value:a,onChange:this.handleSearchChange})),r.a.createElement("div",{style:{overflowX:"auto"}},r.a.createElement(Kn.a,null,r.a.createElement(ea.a,null,r.a.createElement(ra.a,null,r.a.createElement(Xn.a,null,"Person"),oa.map(function(e){return r.a.createElement(Xn.a,{key:e.id,padding:"none",style:{textAlign:"center"}},e.name)}))),r.a.createElement(Vn.a,null,s.slice(5*n,5*n+5).map(function(t){return r.a.createElement(ra.a,{key:t.wcaUserId,hover:!0},r.a.createElement(Xn.a,null,t.name),oa.map(function(n){return r.a.createElement(Xn.a,{key:n.id,padding:"checkbox",style:{textAlign:"center"}},r.a.createElement(Ze.a,{checked:t.roles.includes(n.id),onChange:e.handleRoleChange.bind(e,n.id,t.wcaUserId)}))}))})))),r.a.createElement(na.a,{component:"div",count:s.length,rowsPerPage:5,rowsPerPageOptions:[5],page:n,onChangePage:this.handleChangePage}))),r.a.createElement(y.a,{item:!0},r.a.createElement(Je.a,{variant:"contained",component:w.a,to:"/competitions/".concat(i.id)},"Cancel")),r.a.createElement(y.a,{item:!0},r.a.createElement(Je.a,{variant:"contained",onClick:this.clearRoles},"Clear")),r.a.createElement(y.a,{item:!0},r.a.createElement(Mt,{wcif:o,updatedWcif:i,onWcifUpdate:u,history:l})))}}]),t}(a.Component),la=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).state={wcif:null,loading:!0},n.handleWcifUpdate=function(e){n.setState({wcif:e})},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e,t=this;(e=this.props.match.params.competitionId,Tt("/competitions/".concat(e,"/wcif"))).then(function(e){return t.setState({wcif:e,loading:!1})})}},{key:"render",value:function(){var e=this,t=this.state,n=t.wcif,a=t.loading,i=this.props.match;return a?r.a.createElement(j.a,null):r.a.createElement("div",null,r.a.createElement(O.a,{variant:"h5",style:{marginBottom:16}},n.name),r.a.createElement(m.a,null,r.a.createElement(h.a,{exact:!0,path:i.url,render:function(e){return r.a.createElement(ze,Object.assign({},e,{wcif:n,baseUrl:i.url}))}}),r.a.createElement(h.a,{path:"".concat(i.url,"/roles"),render:function(t){return r.a.createElement(ua,Object.assign({},t,{wcif:n,onWcifUpdate:e.handleWcifUpdate}))}}),r.a.createElement(h.a,{path:"".concat(i.url,"/config"),render:function(t){return r.a.createElement(Ft,Object.assign({},t,{wcif:n,onWcifUpdate:e.handleWcifUpdate}))}}),r.a.createElement(h.a,{path:"".concat(i.url,"/groups"),render:function(t){return r.a.createElement(xn,Object.assign({},t,{wcif:n,onWcifUpdate:e.handleWcifUpdate}))}}),r.a.createElement(h.a,{path:"".concat(i.url,"/printing"),render:function(e){return r.a.createElement(Yn,Object.assign({},e,{wcif:n}))}})))}}]),t}(a.Component),sa=n(151),da=n.n(sa),fa=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(s.a)(t).call(this,e))).state={competitions:[],loading:!0},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;(function(){var e=new Date(Date.now()-6048e5),t=new URLSearchParams({managed_by_me:!0,start:e.toISOString()});return Tt("/competitions?".concat(t,"}"))})().then(function(e){return ee(e,function(e){return e.start_date})}).then(function(t){return e.setState({competitions:t,loading:!1})})}},{key:"render",value:function(){var e=this.state,t=e.competitions,n=e.loading;return r.a.createElement("div",null,r.a.createElement(U.a,null,r.a.createElement(I.a,{subheader:r.a.createElement(da.a,null,"Your competitions")},!n&&0===t.length&&r.a.createElement(W.a,null,r.a.createElement(N.a,null,r.a.createElement(x.a,null,"sentiment_very_dissatisfied")),r.a.createElement(M.a,{primary:"You have no upcoming competitions to manage."})),t.map(function(e){return r.a.createElement(W.a,{key:e.id,button:!0,component:w.a,to:"/competitions/".concat(e.id)},r.a.createElement(M.a,{primary:e.name}))})),n&&r.a.createElement(j.a,null)))}}]),t}(a.Component),ma=(n(360),function(){return r.a.createElement(y.a,{container:!0,className:"footer"},r.a.createElement(y.a,{item:!0,style:{flexGrow:1}},r.a.createElement(O.a,null,"Made with ",r.a.createElement(x.a,{className:"footer-icon"},"favorite")," ","by ",r.a.createElement("a",{href:"https://github.com/jonatanklosko",target:"_blank",rel:"noopener noreferrer"},"Jonatan K\u0142osko"))),r.a.createElement(y.a,{item:!0},r.a.createElement(O.a,null,r.a.createElement("a",{href:"https://github.com/jonatanklosko/groupifier",target:"_blank",rel:"noopener noreferrer"},"GitHub"))),r.a.createElement(y.a,{item:!0,style:{marginLeft:8}},r.a.createElement(O.a,null,r.a.createElement("a",{href:"mailto:jonatanklosko@gmail.com",target:"_blank",rel:"noopener noreferrer"},"Contact"))))}),ha=function(e){var t=e.isSignedIn,n=e.onSignIn,a=e.onSignOut;return r.a.createElement(_e.a,{position:"static",color:"primary"},r.a.createElement(ca.a,null,r.a.createElement(O.a,{variant:"h6",color:"inherit",style:{flexGrow:1}},r.a.createElement(w.a,{to:t?"/competitions":"/"},r.a.createElement(x.a,{style:{fontSize:"1.5em",verticalAlign:"middle",marginRight:10}},"people"),"Groupifier")),t?r.a.createElement(Je.a,{color:"inherit",onClick:a},"Sign out"):r.a.createElement(Je.a,{color:"inherit",onClick:n},"Sign in")))},pa=["Automatically calculates a suitable group size.","Assigns tasks to people (scrambling, judging). Allows to select scramblers manually from a list.","Sorts competitors by their official results, so that each subsequent group represents a better level. When told otherwise, minimizes the amount of people with the same name in each group.","Handles events being held simultaneous by creating separate groups for people taking part in both main and side event.","Generates PDFs containing scorecards, personal cards with task assignment and a summary for each round.","Fetches cutoffs and time limits from the WCA website and puts them on scorecards.","Optionally sets the number of scramble groups for each round based on advancement conditions and saves that to the WCA website, so there is no need for entering them manually."],ga=function(){return r.a.createElement(y.a,{container:!0,spacing:24,direction:"column"},r.a.createElement(y.a,{item:!0},r.a.createElement(O.a,{variant:"h4"},"What is Groupifier?")),r.a.createElement(y.a,{item:!0},r.a.createElement(O.a,{variant:"subtitle1"},"It is a tool meant for WCA competition organizers. Its main objective is to simplify the process of splitting competitors into groups and provide the best result with minimal configuration.")),r.a.createElement(y.a,{item:!0},r.a.createElement(O.a,{variant:"h4"},"What does it do?")),r.a.createElement(y.a,{item:!0},r.a.createElement(I.a,null,pa.map(function(e){return r.a.createElement(W.a,{key:e},r.a.createElement(N.a,null,r.a.createElement(x.a,null,"check")),r.a.createElement(M.a,{primary:e}))}))))},va=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(s.a)(t).call(this,e))).handleSignIn=function(){It()},n.handleSignOut=function(){Rt(),n.setState({isSignedIn:!1})},n.state={isSignedIn:Wt()},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement(f.a,null,r.a.createElement("div",null,r.a.createElement(v.a,null),r.a.createElement(ha,{isSignedIn:this.state.isSignedIn,onSignIn:this.handleSignIn,onSignOut:this.handleSignOut}),r.a.createElement(y.a,{container:!0,justify:"center"},r.a.createElement(y.a,{item:!0,xs:12,md:8,style:{padding:16}},this.state.isSignedIn?r.a.createElement(m.a,null,r.a.createElement(h.a,{path:"/competitions/:competitionId",component:la}),r.a.createElement(h.a,{path:"/competitions",component:fa}),r.a.createElement(p.a,{to:"/competitions"})):r.a.createElement(m.a,null,r.a.createElement(h.a,{exact:!0,path:"/",component:ga}),r.a.createElement(p.a,{to:"/"})))),r.a.createElement(h.a,{exact:!0,path:"/",component:ma})))}}]),t}(a.Component),ba=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ya(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}!function(){var e=window.location.hash.replace(/^\W*/,""),t=new URLSearchParams(e);if(t.has("access_token")&&localStorage.setItem("Groupifier.accessToken",t.get("access_token")),t.has("expires_in")){var n=t.get("expires_in")-900,a=new Date((new Date).getTime()+1e3*n);localStorage.setItem("Groupifier.expirationTime",a.toISOString())}var r=localStorage.getItem("Groupifier.expirationTime");r&&new Date>=new Date(r)&&Rt(),t.has("access_token")&&(window.location.hash="")}(),c.a.render(r.a.createElement(va,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("","/service-worker.js");ba?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):ya(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):ya(e)})}}()}},[[154,2,1]]]);
//# sourceMappingURL=main.7e8d9a92.chunk.js.map