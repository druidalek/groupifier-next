(window["webpackJsonpgroupifier-next"]=window["webpackJsonpgroupifier-next"]||[]).push([[0],{199:function(e){e.exports=JSON.parse('{"a":"1.4.6"}')},203:function(e,t,n){e.exports=n(422)},238:function(e,t,n){},419:function(e,t,n){},422:function(e,t,n){"use strict";n.r(t);n(204),n(216);var r=n(183);n.n(r).a.polyfill();var a=n(0),i=n.n(a),o=n(31),c=n.n(o),u=(n(238),n(11)),l=n(12),s=n(14),f=n(13),d=n(15),m=n(425),h=n(426),p=n(427),g=n(424),v=n(202),b=n.n(v),y=n(4),O=n.n(y),E=n(76),C=n(121),j=n.n(C),w=n(122),k=n.n(w),x=n(98),S=n.n(x),I=n(32),N=n.n(I),P=n(28),R=n.n(P),T=n(30),W=n.n(T),D=n(19),A=n.n(D),U=n(423),M=n(34),F=n.n(M),G=n(40),z=n.n(G),B=n(27),L=n.n(B),_=n(29),J=n(10),H=n(16),V=n(52);function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(n,!0).forEach(function(t){Object(_.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Z=function e(t,n,r){var a=Object(V.a)(n),i=a[0],o=a.slice(1);return 0===o.length?K({},t,Object(_.a)({},i,r(t[i]))):K({},t,Object(_.a)({},i,e(t[i],o,r)))},q=function(e,t,n){return Z(e,t,function(){return n})},Q=function(e,t,n){return Z(e,t,function(e){return e&&e.map(n)})},$=function e(t){return(n=t)===Object(n)?Object.values(t).every(e):null!=t;var n},X=function(e,t,n){return"".concat(e," ").concat(1===e?t:n||t+"s")},ee=function(e){if(0===e.length)return[];var t=he(e);return e.map(function(n){return 0!==t?n/t:1/e.length})},te=function(e,t){return e.reduce(function(e,n){return e.concat(t(n))},[])},ne=function(e,t){return e.reduce(function(e,n){return Z(e,[t(n)],function(e){return(e||[]).concat(n)})},{})},re=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?[]:t[0].map(function(e,n){return t.map(function(e){return e[n]})})},ae=function(e,t){return e.reduceRight(function(e,n){return void 0!==e?e:t(n)?n:void 0},void 0)},ie=function(e,t){return e.filter(function(e){return t.includes(e)})},oe=function(e,t){return e.filter(function(e){return!t.includes(e)})},ce=function(e,t){return[e.filter(t),e.filter(function(e){return!t(e)})]},ue=function(e,t){return e<t?-1:e>t?1:0},le=function(e,t){return e.slice().sort(function(e,n){return ue(t(e),t(n))})},se=function(e,t){var n=new Map(e.map(function(e){return[e,t(e)]}));return e.slice().sort(function(e,t){return function(e,t){return e.reduce(function(e,n){return e||t(n)},null)}(re(n.get(e),n.get(t)),function(e){var t=Object(H.a)(e,2),n=t[0],r=t[1];return ue(n,r)})})},fe=function e(t,n){return t.length<=n?[t]:[t.slice(0,n)].concat(Object(J.a)(e(t.slice(n),n)))},de=function(e,t){return Array.from({length:e},function(e,n){return t(n)})},me=function(e){return Object(J.a)(new Set(e))},he=function(e){return e.reduce(function(e,t){return e+t},0)},pe=function(e,t,n){return t<=e&&e<=n},ge=function(e,t){return new Date(new Date(e).getTime()+t).toISOString()},ve=function(e,t){return Math.abs(new Date(e)-new Date(t))},be=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"UTC";return new Date(e).toLocaleTimeString("en-US",{timeZone:t,hour:"numeric",minute:"numeric"})};function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(n,!0).forEach(function(t){Object(_.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Ee=function(e){return"groupifier.".concat(e)},Ce=function(e,t){return{id:Ee(e),specUrl:"https://jonatanklosko.github.io/groupifier-next/wcif-extensions/".concat(e,".json"),data:t}},je=function(e,t,n){var r=t.extensions.filter(function(t){return t.id!==Ee(e)});return Oe({},t,{extensions:[].concat(Object(J.a)(r),[Ce(e,n)])})},we={ActivityConfig:null,RoomConfig:{stations:null},CompetitionConfig:{localNamesFirst:!1,scorecardsBackgroundUrl:"",competitorsSortingRule:"ranks",noTasksForNewcomers:!1,tasksForOwnEventsOnly:!1}},ke=function(e,t){var n=t.extensions.find(function(t){return t.id===Ee(e)}),r=we[e];return null===r?n&&n.data:n?Oe({},r,{},n.data):r},xe=function(e,t){return Oe({},t,{extensions:t.extensions.filter(function(t){return t.id!==Ee(e)})})},Se=[{id:"333",name:"3x3x3 Cube",shortName:"3x3"},{id:"222",name:"2x2x2 Cube",shortName:"2x2"},{id:"444",name:"4x4x4 Cube",shortName:"4x4"},{id:"555",name:"5x5x5 Cube",shortName:"5x5"},{id:"666",name:"6x6x6 Cube",shortName:"6x6"},{id:"777",name:"7x7x7 Cube",shortName:"7x7"},{id:"333bf",name:"3x3x3 Blindfolded",shortName:"3BLD"},{id:"333fm",name:"3x3x3 Fewest Moves",shortName:"FMC"},{id:"333oh",name:"3x3x3 One-Handed",shortName:"3OH"},{id:"333ft",name:"3x3x3 With Feet",shortName:"3WF"},{id:"minx",name:"Megaminx",shortName:"Minx"},{id:"pyram",name:"Pyraminx",shortName:"Pyra"},{id:"clock",name:"Clock",shortName:"Clock"},{id:"skewb",name:"Skewb",shortName:"Skewb"},{id:"sq1",name:"Square-1",shortName:"Sq1"},{id:"444bf",name:"4x4x4 Blindfolded",shortName:"4BLD"},{id:"555bf",name:"5x5x5 Blindfolded",shortName:"5BLD"},{id:"333mbf",name:"3x3x3 Multi-Blind",shortName:"MBLD"}],Ie=function(e){return Ne("name",e)},Ne=function(e,t){return Se.find(function(e){return e.id===t})[e]},Pe=function(e){return le(e,function(e){return Se.findIndex(function(t){return t.id===e.id})})};function Re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var Te=function(e){var t=e.match(/(\w+)(?:-r(\d+))?(?:-g(\d+))?(?:-a(\d+))?/),n=Object(H.a)(t,5),r=n[1],a=n[2],i=n[3],o=n[4];return{eventId:r,roundNumber:a&&parseInt(a,10),groupNumber:i&&parseInt(i,10),attemptNumber:o&&parseInt(o,10)}},We=function(e){var t=Te(e),n=t.eventId,r=t.roundNumber,a=t.groupNumber,i=t.attemptNumber;return[n&&Ie(n),r&&"Round ".concat(r),a&&"Group ".concat(a),i&&"Attempt ".concat(i)].filter(function(e){return e}).join(", ")},De=function(e){return["333fm","333mbf"].includes(Te(e).eventId)},Ae=function(e){var t=e.startTime,n=e.endTime;return new Date(n)-new Date(t)},Ue=function(e){var t=e.startTime,n=e.endTime,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"UTC";return"".concat(be(t,r)," - ").concat(be(n,r))},Me=function(e,t){return new Date(e.startTime)<new Date(t.endTime)&&new Date(t.startTime)<new Date(e.endTime)},Fe=function(e){return te(e.schedule.venues,function(e){return e.rooms})},Ge=function(e,t){return ke("RoomConfig",function(e,t){return Fe(e).find(function(e){return e.activities.some(function(e){return e.id===t})})}(e,t)).stations},ze=function(e){var t=te(Fe(e),function(e){return e.activities});return[].concat(Object(J.a)(t),Object(J.a)(te(t,function e(t){var n=t.childActivities;return n.length>0?[].concat(Object(J.a)(n),Object(J.a)(te(n,e))):n})))},Be=new Map,Le=function(e,t){if(Be.has(e.schedule))return Be.get(e.schedule).get(t);var n=ze(e),r=new Map(n.map(function(e){return[e.id,e]}));return Be.set(e.schedule,r),r.get(t)},_e=function(e,t){return Q(e,["schedule","venues"],function(e){return Q(e,["rooms"],function(e){return Q(e,["activities"],function(e){return e.id===t.id?t:e})})})},Je=function(e,t,n){return te(e.events,function(r){return te(r.rounds,function(r){var a=Te(r.id).roundNumber,i=t[r.id].length,o=Ze(e,r.id).filter(He);if(o.every(function(e){return ke("ActivityConfig",e)}))return o;var c=ee(o.map(function(t){return Ge(e,t.id)*Ae(t)}));return re(o,c).map(function(t){var r=Object(H.a)(t,2),o=r[0],c=r[1],u=Ge(e,o.id),l=Math.round(c*i),s=function(e,t,n){if(0===t)return 1;var r=1.7*t,a=Math.round(e/r+.4);return Math.max(a,1===n?2:1)}(l,u,a),f=n.assignScramblers?function(e,t){return Math.floor(1+(Math.min(e,t)-1)/5)}(l/s,u):0,d=n.assignRunners?function(e,t){return Math.floor(1+(Math.min(e,t)-1)/8)}(l/s,u):0,m=u>0&&n.assignJudges;return je("ActivityConfig",o,{capacity:c,groups:s,scramblers:f,runners:d,assignJudges:m})})})}).reduce(_e,e)},He=function(e){var t=Te(e.activityCode),n=t.eventId,r=t.roundNumber,a=t.groupNumber,i=t.attemptNumber;return!(!n||!r||a||i)},Ve=function(e){return Fe(e).some(function(e){return e.activities.some(function(e){return ke("ActivityConfig",e)})})},Ye=function(e){return Fe(e).every(function(e){return e.activities.filter(He).map(function(e){return ke("ActivityConfig",e)}).every($)})},Ke=function(e){return Fe(e).map(function(e){return ke("RoomConfig",e)}).every($)},Ze=function(e,t){return te(Fe(e),function(e){return e.activities.filter(function(e){return e.activityCode.startsWith(t)})})},qe=function(e,t){return te(Ze(e,t),function(e){return De(t)?[e]:e.childActivities})},Qe=function(e,t){return te(e.schedule.venues,function(e){return e.rooms.map(function(n){return[n,e.timezone,te(n.activities.filter(function(e){return e.activityCode===t}),function(e){return e.childActivities})]})})},$e=function(e,t){return e.persons.some(function(e){return e.assignments.some(function(e){return e.activityId===t})})},Xe=function(e,t){return qe(e,t).some(function(t){return $e(e,t.id)})},et=function(e){return te(e.events,function(e){return e.rounds}).filter(function(e){return 0===e.results.length||e.results.every(function(e){return 0===e.attempts.length})})},tt=function(e){return e.events.map(function(e){return e.rounds.find(function(e){var t=Te(e.id).roundNumber;return 0===e.results.length&&1===t||e.results.length>0&&e.results.every(function(e){return 0===e.attempts.length})})}).filter(function(e){return e})},nt=function(e){return tt(e).filter(function(t){return!Xe(e,t.id)})},rt=function(e){return tt(e).filter(function(t){return Xe(e,t.id)}).filter(function(e){return"333fm"!==Te(e.id).eventId})},at=function(e){return e.events.some(function(t){return t.rounds.some(function(n){return De(t.id)?Xe(e,n.id):qe(e,n.id).length>0})})},it=function(e){var t=et(e),n=t.map(function(e){return e.id}),r=te(t,function(t){return qe(e,t.id)}).map(function(e){return e.id}),a=e.persons.map(function(e){return Z(e,["assignments"],function(e){return e.filter(function(e){var t=e.activityId;return!r.includes(t)}).filter(function(e){var t=e.assignmentCode;return!t.startsWith("staff-")&&"competitor"!==t})})}),i=Q(e.schedule,["venues"],function(e){return Q(e,["rooms"],function(e){return Q(e,["activities"],function(e){return n.includes(e.activityCode)?q(e,["childActivities"],[]):e})})});return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Re(n,!0).forEach(function(t){Object(_.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Re(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e,{persons:a,schedule:i})},ot=[{path:"/roles",text:"Edit roles",icon:"perm_contact_calendar",enabled:function(e){return!0}},{path:"/config",text:"Configure",icon:"settings",enabled:function(e){return!0}},{path:"/groups",text:"Manage groups",icon:"people",enabled:function(e){return Ke(e)&&Ye(e)}},{path:"/printing",text:"Print documents",icon:"print",enabled:function(e){return function(e){return e.persons.some(function(e){return e.assignments.some(function(e){return"competitor"===e.assignmentCode})})}(e)}}],ct=function(e){var t=e.wcif,n=e.baseUrl;return i.a.createElement(L.a,null,i.a.createElement(N.a,null,ot.map(function(e){return i.a.createElement(R.a,{key:e.path,button:!0,component:U.a,to:"".concat(n).concat(e.path),disabled:!e.enabled(t)},i.a.createElement(z.a,null,i.a.createElement(F.a,null,e.icon)),i.a.createElement(W.a,{primary:e.text}))})))},ut=n(65),lt=n.n(ut),st=n(23),ft=n.n(st),dt=n(53),mt=n.n(dt),ht=n(97),pt=n.n(ht),gt=function(e){var t=e.room;return i.a.createElement(A.a,{variant:"subtitle2"},i.a.createElement("span",{style:{display:"inline-block",width:10,height:10,marginRight:5,borderRadius:"100%",backgroundColor:t.color}}),i.a.createElement("span",null,t.name))},vt=n(66),bt=n(35),yt=n.n(bt),Ot=n(63),Et=n.n(Ot),Ct=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).handleKeyPress=function(e){e.key.match(/\D/)&&e.preventDefault()},n.handleTextFieldChange=function(e){var t=e.target.value.length>0?parseInt(e.target.value,10):null;(null===t||!Number.isNaN(t)&&t>=1)&&n.props.onChange(e,t)},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.value,n=(e.onChange,Object(vt.a)(e,["value","onChange"]));return i.a.createElement(Et.a,Object.assign({},n,{type:"number",value:null===t?"":t,onKeyPress:this.handleKeyPress,onChange:this.handleTextFieldChange}))}}]),t}(a.PureComponent),jt=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(s.a)(this,Object(f.a)(t).call(this,e))).handleCheckboxChange=function(e){var t=e.target.checked;n.props.onChange(e,t?null:0)},n.inputRef=i.a.createRef(),n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){0===e.value&&0!==this.props.value&&this.inputRef.current.focus()}},{key:"render",value:function(){var e=this.props,t=e.value,n=e.disabled,r=Object(vt.a)(e,["value","disabled"]);return i.a.createElement(a.Fragment,null,i.a.createElement(Ct,Object.assign({},r,{value:t,disabled:0===t||n,inputRef:this.inputRef})),i.a.createElement(yt.a,{name:r.name,checked:0!==t,onChange:this.handleCheckboxChange,disabled:n}))}}]),t}(a.PureComponent),wt=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).handleInputChange=function(e,t){var r=n.props,a=r.room;(0,r.onChange)(je("RoomConfig",a,q(ke("RoomConfig",a),[e.target.name],t)))},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.room,n=e.disabled,r=ke("RoomConfig",t).stations;return i.a.createElement("div",null,i.a.createElement(gt,{room:t}),i.a.createElement(jt,{label:"Timing stations",value:r,name:"stations",onChange:this.handleInputChange,disabled:n}))}}]),t}(a.Component),kt=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).handleRoomChange=function(e){var t=n.props,r=t.wcif;(0,t.onWcifChange)(Q(r,["schedule","venues"],function(t){return Q(t,["rooms"],function(t){return t.id===e.id?e:t})}))},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props.wcif,n=Ve(t);return i.a.createElement(L.a,{style:{padding:16}},i.a.createElement(O.a,{container:!0,spacing:16},Fe(t).map(function(t){return i.a.createElement(O.a,{item:!0,lg:!0,key:t.id},i.a.createElement(wt,{room:t,onChange:e.handleRoomChange,disabled:n}))})))}}]),t}(a.Component),xt=n(45),St=n.n(xt),It=n(64),Nt=n.n(It),Pt=n(75),Rt=n.n(Pt),Tt=function(e){var t=e.eventId,n=Object(vt.a)(e,["eventId"]);return i.a.createElement("span",Object.assign({style:{fontSize:24},className:"cubing-icon event-".concat(t)},n))},Wt=function(e){function t(){return Object(u.a)(this,t),Object(s.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.selected,r=t.events;return i.a.createElement("div",null,r.map(function(t){return i.a.createElement(Nt.a,{key:t.id,title:Ie(t.id),placement:"top"},i.a.createElement(Rt.a,{onClick:function(){return e.props.onChange(t.id)}},i.a.createElement(Tt,{eventId:t.id,style:{opacity:t.id===n?1:.3}})))}))}}]),t}(a.Component),Dt=n(185),At=n.n(Dt),Ut=n(187),Mt=n.n(Ut),Ft=n(186),Gt=n.n(Ft),zt=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).handlePanelChange=function(e,t){var r=n.props,a=r.onChange,i=r.roundId;a(t?i:null)},n.scrollToElement=function(e){window.scrollTo({top:e.parentNode.getBoundingClientRect().top-8,behavior:"smooth"})},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.expanded,n=e.roundId,r=e.render;return i.a.createElement(At.a,{onChange:this.handlePanelChange,expanded:t,CollapseProps:{onEntered:this.scrollToElement}},i.a.createElement(Gt.a,{expandIcon:i.a.createElement(F.a,null,"expand_more")},i.a.createElement(A.a,{variant:"subtitle1"},We(n))),i.a.createElement(Mt.a,null,t&&r(n)))}}]),t}(a.Component),Bt=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(s.a)(this,Object(f.a)(t).call(this,e))).handleEventChange=function(e){n.setState({selectedEventId:e})},n.handleRoundChange=function(e){n.setState({expandedRoundId:e})},n.state={selectedEventId:e.events[0].id,expandedRoundId:null},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.selectedEventId,r=t.expandedRoundId,a=this.props,o=a.events,c=a.render,u=o.find(function(e){return e.id===n});return i.a.createElement(O.a,{container:!0,spacing:8,justify:"flex-end"},i.a.createElement(O.a,{item:!0,xs:12},i.a.createElement(Wt,{selected:n,events:o,onChange:this.handleEventChange})),i.a.createElement(O.a,{item:!0,xs:12},u.rounds.map(function(t){return i.a.createElement(zt,{key:t.id,expanded:t.id===r,roundId:t.id,render:c,onChange:e.handleRoundChange})})))}}]),t}(a.Component),Lt=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).handlePropertyChange=function(e,t){var r=n.props,a=r.activity;(0,r.onChange)(je("ActivityConfig",a,q(ke("ActivityConfig",a),[e],t)))},n.handleInputChange=function(e,t){n.handlePropertyChange(e.target.name,t)},n.handleCheckboxChange=function(e){var t=e.target,r=t.name,a=t.checked;n.handlePropertyChange(r,a)},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.activity!==e.activity}},{key:"render",value:function(){var e=this.props,t=e.activity,n=e.room,r=e.expectedCompetitors,a=e.wcif,o=ke("ActivityConfig",t),c=o.groups,u=o.scramblers,l=o.runners,s=o.assignJudges,f=o.capacity,d=ke("RoomConfig",n).stations,m=Math.round(r.length*f),h=Math.round(m/c),p=c?X(h,"person","people")+" in group":" ",g=u?X(Math.round(h/u),"cube")+" per scrambler":" ",v=l?X(Math.round(d/l),"station")+" per runner":" ",b=t.childActivities.length>0,y=t.childActivities.some(function(e){var t=e.id;return $e(a,t)});return i.a.createElement(O.a,{container:!0,direction:"column"},i.a.createElement(O.a,{item:!0},i.a.createElement(Ct,{label:"Groups",value:c,name:"groups",helperText:p,onChange:this.handleInputChange,margin:"dense",disabled:b||y})),i.a.createElement(O.a,{item:!0},i.a.createElement(jt,{label:"Scramblers",value:u,name:"scramblers",helperText:g,onChange:this.handleInputChange,margin:"dense",disabled:y})),i.a.createElement(O.a,{item:!0},i.a.createElement(jt,{label:"Runners",value:l,name:"runners",helperText:v,onChange:this.handleInputChange,margin:"dense",disabled:y})),i.a.createElement(O.a,{item:!0},i.a.createElement(St.a,{control:i.a.createElement(yt.a,{checked:s,name:"assignJudges",onChange:this.handleCheckboxChange,disabled:0===d||y}),label:"Assign judges"})))}}]),t}(a.Component),_t=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).handleActivityChange=function(e){var t=n.props,r=t.wcif;(0,t.onWcifChange)(_e(r,e))},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.roundId,r=t.wcif,a=t.expectedCompetitorsByRound,o=te(Fe(r),function(e){return e.activities.filter(function(e){return e.activityCode===n}).map(function(t){return[t,e]})});return i.a.createElement(O.a,{container:!0,spacing:16},o.map(function(t){var o=Object(H.a)(t,2),c=o[0],u=o[1];return i.a.createElement(O.a,{item:!0,xs:!0,key:c.id},i.a.createElement(gt,{room:u}),i.a.createElement(Lt,{wcif:r,activity:c,room:u,onChange:e.handleActivityChange,expectedCompetitors:a[n]}))}))}}]),t}(a.PureComponent),Jt=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(s.a)(this,Object(f.a)(t).call(this,e))).handleCheckboxChange=function(e){var t=e.target,r=t.name,a=t.checked;n.setState(Object(_.a)({},r,a))},n.handleNextClick=function(){var e=n.props,t=e.wcif,r=e.expectedCompetitorsByRound;(0,e.onWcifChange)(Je(t,r,n.state))},n.renderRound=function(e){var t=n.props,r=t.wcif,a=t.expectedCompetitorsByRound,o=t.onWcifChange;return i.a.createElement(_t,{roundId:e,expectedCompetitorsByRound:a,wcif:r,onWcifChange:o})},n.state={assignScramblers:!0,assignRunners:!0,assignJudges:!0},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props.wcif,n=t.events.filter(function(e){return!De(e.id)}),r=me(function(e){return te(Fe(e),function(e){return e.activities.filter(He).filter(function(e){return!ke("ActivityConfig",e)})})}(t).map(function(e){return e.activityCode}));return 0===r.length?i.a.createElement(Bt,{events:n,render:this.renderRound}):i.a.createElement(L.a,{style:{padding:16}},i.a.createElement(A.a,{variant:"h5"},Ve(t)?"Generate missing configuration for\n            ".concat(r.map(We).join(", ")):"Generate initial configuration"),i.a.createElement(O.a,{container:!0,direction:"column"},i.a.createElement(O.a,{item:!0,style:{margin:"0.5em 0"}},i.a.createElement(A.a,{variant:"body1"},"Which of the following roles would you like to assign?")),["Scramblers","Runners","Judges"].map(function(t){return i.a.createElement(O.a,{item:!0,key:t},i.a.createElement(St.a,{control:i.a.createElement(yt.a,{checked:e.state["assign".concat(t)],name:"assign".concat(t),onChange:e.handleCheckboxChange}),label:t}))})),i.a.createElement(ft.a,{onClick:this.handleNextClick},"Next"))}}]),t}(a.Component),Ht=n(125),Vt=n.n(Ht),Yt=n(126),Kt=n.n(Yt),Zt=n(124),qt=n.n(Zt),Qt=n(127),$t=n.n(Qt),Xt=n(91),en=n.n(Xt),tn=[{id:"ranks",name:"Official rankings",description:"Sort competitors by their official rankings."},{id:"balanced",name:"Balanced",description:"Sort competitors in 3x3x3 (any variation), 2x2x2, Pyraminx and Skewb by their official rankings. For other events put best people in different groups, so that there are good scramblers for each group."},{id:"symmetric",name:"Symmetric",description:"Put best people in different groups, so that there are good scramblers for each group."},{id:"name-optimised",name:"Name-optimised",description:"Sort competitors by their official rankings, but also minimize the number of people with the same name in each group. Use it when many competitors have the same name."}],nn=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).handlePropertyChange=function(e,t){var r=n.props,a=r.wcif;(0,r.onWcifChange)(je("CompetitionConfig",a,q(ke("CompetitionConfig",a),[e],t)))},n.handleCheckboxChange=function(e){var t=e.target,r=t.name,a=t.checked;n.handlePropertyChange(r,a)},n.handleTextFieldChange=function(e){var t=e.target,r=t.name,a=t.value;n.handlePropertyChange(r,a)},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.wcif,t=ke("CompetitionConfig",e),n=t.competitorsSortingRule,r=t.noTasksForNewcomers,a=t.tasksForOwnEventsOnly,o=t.localNamesFirst,c=t.scorecardsBackgroundUrl;return i.a.createElement(L.a,{style:{padding:16}},i.a.createElement(O.a,{container:!0,direction:"column",spacing:16},i.a.createElement(O.a,{item:!0},i.a.createElement(A.a,{variant:"h5"},"Assignments"),i.a.createElement(Vt.a,{fullWidth:!0},i.a.createElement(qt.a,{htmlFor:"competitors-sorting-rule"},"Competitors sorting rule"),i.a.createElement(en.a,{value:n,onChange:this.handleTextFieldChange,inputProps:{name:"competitorsSortingRule",id:"competitors-sorting-rule"}},tn.map(function(e){var t=e.id,n=e.name;return i.a.createElement($t.a,{value:t,key:t},n)})),i.a.createElement(Kt.a,null,tn.find(function(e){return e.id===n}).description+" Note: this applies to first rounds only.")),i.a.createElement(O.a,{container:!0,direction:"column"},i.a.createElement(O.a,{item:!0},i.a.createElement(St.a,{control:i.a.createElement(yt.a,{name:"noTasksForNewcomers",checked:r,onChange:this.handleCheckboxChange}),label:"Don't assign tasks to newcomers"})),i.a.createElement(O.a,{item:!0},i.a.createElement(St.a,{control:i.a.createElement(yt.a,{name:"tasksForOwnEventsOnly",checked:a,onChange:this.handleCheckboxChange}),label:"Assign tasks to competitors only in events they registered for"})))),i.a.createElement(O.a,{item:!0},i.a.createElement(A.a,{variant:"h5"},"Printing"),i.a.createElement(St.a,{control:i.a.createElement(yt.a,{name:"localNamesFirst",checked:o,onChange:this.handleCheckboxChange}),label:"Swap latin names with local ones"}),i.a.createElement(Et.a,{label:"Scorecards background image URL",name:"scorecardsBackgroundUrl",value:c,onChange:this.handleTextFieldChange,fullWidth:!0}))))}}]),t}(a.Component),rn=n(189),an=n.n(rn),on=n(188),cn=n.n(on),un=!new URLSearchParams(window.location.search).get("staging"),ln=un?"https://www.worldcubeassociation.org":"https://staging.worldcubeassociation.org",sn=un?"7af43bdb765a9b555e09cc575351d15acee640c0db098626e40e8d1ee352ec3a":"example-application-id",fn=function(e){return"GroupifierNext.".concat(sn,".").concat(e)},dn=function(){return localStorage.getItem(fn("accessToken"))},mn=function(){var e=new URLSearchParams({client_id:sn,response_type:"token",redirect_uri:hn(),scope:"manage_competitions"});window.location="".concat(ln,"/oauth/authorize?").concat(e.toString())},hn=function(){var e=window.location,t=e.origin,n=e.pathname,r=e.search,a=new URLSearchParams(r).get("staging"),i="".concat(t).concat(n).replace(/\/$/,"");return a?"".concat(i,"?staging=true"):i},pn=function(){return localStorage.removeItem(fn("accessToken"))},gn=function(){return!!dn()},vn=function(e,t){var n,r,a,i=Object.keys(t).filter(function(n){return e[n]!==t[n]});return 0===i.length?Promise.resolve():(n=t.id,a=t,r=i.reduce(function(e,t){return K({},e,Object(_.a)({},t,a[t]))},{}),bn("/competitions/".concat(n,"/wcif"),{method:"PATCH",body:JSON.stringify(r)}))},bn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(ln,"/api/v0");return fetch("".concat(n).concat(e),Object.assign({},t,{headers:new Headers({Authorization:"Bearer ".concat(dn()),"Content-Type":"application/json"})})).then(function(e){if(!e.ok)throw new Error(e.statusText);return e}).then(function(e){return e.json()})},yn=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).state={saving:!1,failed:!1},n.handleSaveClick=function(){var e=n.props,t=e.wcif,r=e.updatedWcif,a=e.onWcifUpdate,i=e.history;n.setState({saving:!0,failed:!1}),vn(t,r).then(function(){a(r),i.push("/competitions/".concat(r.id))}).catch(function(){return n.setState({saving:!1,failed:!0})})},n.handleSnackbarClose=function(){n.setState({failed:!1})},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state,t=e.saving,n=e.failed,r=this.props.disabled;return i.a.createElement(a.Fragment,null,i.a.createElement(cn.a,{open:n,message:"Failed to save data to the WCA website.",anchorOrigin:{vertical:"bottom",horizontal:"left"},autoHideDuration:5e3,onClose:this.handleSnackbarClose}),i.a.createElement(ft.a,{variant:"contained",color:"primary",onClick:this.handleSaveClick,disabled:r||t},i.a.createElement("span",{style:t?{visibility:"hidden"}:{}},"Save"),t&&i.a.createElement(an.a,{size:20,style:{position:"absolute"}})))}}]),t}(a.Component),On=function(e,t){return e.events.find(function(e){return e.id===t})},En=function(e,t,n){if(!["single","average"].includes(n))throw new Error("Personal best type must be either 'single' or 'average'. Received '".concat(n,"'."));var r=e.personalBests.find(function(e){return e.eventId===t&&e.type===n});return r?r.best:1/0},Cn=function(e,t){return[En(e,t,"average"),En(e,t,"single")]},jn=function(e){return e.events.reduce(function(t,n){var r=Object(V.a)(n.rounds),a=r[0],i=r.slice(1);return t[a.id]=se(Nn(e,n.id),function(e){return Cn(e,n.id)}),i.reduce(function(e,r){var a=Object(H.a)(e,2),i=a[0],o=a[1],c=i.advancementCondition;if(!c)throw new Error("Mising advancement condition for ".concat(We(i.id),"."));var u=function(e,t,n){switch(t.type){case"ranking":return e.slice(0,t.level);case"percent":return e.slice(0,Math.floor(e.length*t.level*.01));case"attemptResult":return e.filter(function(e){return En(e,n,"single")<t.level});default:throw new Error("Unrecognised AdvancementCondition type: '".concat(t.type,"'"))}}(o,c,n.id);return t[r.id]=u,[r,u]},[a,t[a.id]]),t},{})},wn=function(e,t){var n=Te(t),r=n.eventId,a=n.roundNumber,i=function(e,t){var n=Te(t).eventId;return On(e,n).rounds.find(function(e){return e.id===t})}(e,t).results.map(function(t){var n=t.personId;return function(e,t){return e.persons.find(function(e){return e.registrantId===t})}(e,n)});if(1===a){var o=i.length>0?i:Nn(e,r);return se(o,function(e){return Cn(e,r).map(function(e){return-e})})}if(i.length>0){var c=function(e,t){var n=Te(t),r=n.eventId,a=n.roundNumber;return On(e,r).rounds.find(function(e){var t=e.id;return Te(t).roundNumber===a-1})}(e,t);return le(i,function(e){return-c.results.find(function(t){return t.personId===e.registrantId}).ranking})}return null},kn=function(e){var t=Date.now()-new Date(e.birthdate).getTime();return Math.floor(t/31556952e3)},xn=function(e){return e.assignments.filter(function(e){return e.assignmentCode.startsWith("staff-")})},Sn=function(e,t,n){return xn(t).filter(function(t){var r=t.activityId;return Te(Le(e,r).activityCode).eventId===n})},In=function(e){return e.persons.filter(function(e){return e.registration&&"accepted"===e.registration.status})},Nn=function(e,t){return In(e).filter(function(e){return e.registration.eventIds.includes(t)})},Pn=function(e,t,n){return e.assignments.some(function(e){return e.activityId===t&&e.assignmentCode===n})},Rn=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(s.a)(this,Object(f.a)(t).call(this,e))).handleWcifChange=function(e){n.setState({localWcif:e})},n.handleTabChange=function(e,t){n.setState({tabValue:t})},n.clearConfig=function(){var e=n.state.localWcif,t=xe("CompetitionConfig",e);n.setState({tabValue:0,localWcif:Q(t,["schedule","venues"],function(e){return Q(e,["rooms"],function(e){return xe("RoomConfig",Q(e,["activities"],function(e){return xe("ActivityConfig",e)}))})})})},n.state={localWcif:e.wcif,tabValue:0},n.expectedCompetitorsByRound=jn(e.wcif),n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state,t=e.tabValue,n=e.localWcif,r=this.props,a=r.wcif,o=r.onWcifUpdate,c=r.history,u=Ke(n)&&Ye(n);return i.a.createElement(O.a,{container:!0,spacing:8,justify:"flex-end"},i.a.createElement(O.a,{item:!0,xs:12},i.a.createElement(lt.a,{position:"static",color:"default"},i.a.createElement(pt.a,{value:t,onChange:this.handleTabChange,centered:!0},i.a.createElement(mt.a,{label:"Rooms"}),i.a.createElement(mt.a,{label:"Rounds",disabled:!Ke(n)}),i.a.createElement(mt.a,{label:"General"})))),i.a.createElement(O.a,{item:!0,xs:12},0===t&&i.a.createElement(kt,{wcif:n,onWcifChange:this.handleWcifChange}),1===t&&i.a.createElement(Jt,{wcif:n,onWcifChange:this.handleWcifChange,expectedCompetitorsByRound:this.expectedCompetitorsByRound}),2===t&&i.a.createElement(nn,{wcif:n,onWcifChange:this.handleWcifChange})),i.a.createElement(O.a,{item:!0},i.a.createElement(ft.a,{variant:"contained",component:U.a,to:"/competitions/".concat(n.id)},"Cancel")),i.a.createElement(O.a,{item:!0},i.a.createElement(ft.a,{variant:"contained",onClick:this.clearConfig,disabled:at(n)},"Clear")),i.a.createElement(O.a,{item:!0},i.a.createElement(yn,{wcif:a,updatedWcif:n,onWcifUpdate:o,history:c,disabled:!u})))}}]),t}(a.Component),Tn=n(96),Wn=n.n(Tn),Dn=n(95),An=n.n(Dn),Un=n(190),Mn=n.n(Un),Fn=n(193),Gn=n.n(Fn),zn=n(192),Bn=n.n(zn),Ln=n(191),_n=n.n(Ln),Jn=function(e){function t(){return Object(u.a)(this,t),Object(s.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.wcif,n=e.groupActivity,r=e.onClose,a=e.open,o=[{id:"competitor",label:"Competitors"},{id:"staff-scrambler",label:"Scramblers"},{id:"staff-runner",label:"Runners"},{id:"staff-judge",label:"Judges"}].map(function(e){return[e,t.persons.filter(function(t){return Pn(t,n.id,e.id)})]}).filter(function(e){var t=Object(H.a)(e,2);t[0];return t[1].length>0});return i.a.createElement(Mn.a,{open:a,onClose:r,maxWidth:!1},i.a.createElement(_n.a,null,We(n.activityCode)),i.a.createElement(Bn.a,null,i.a.createElement(O.a,{container:!0,spacing:16},o.map(function(e){var t=Object(H.a)(e,2),n=t[0],r=t[1];return i.a.createElement(O.a,{item:!0,xs:12,sm:6,md:!0,key:n.id},i.a.createElement(A.a,{variant:"subtitle2"},n.label),i.a.createElement(N.a,{dense:!0,style:{overflowY:"auto",maxHeight:300}},le(r,function(e){return e.name}).map(function(e){return i.a.createElement(R.a,{key:e.wcaUserId},i.a.createElement(W.a,{primary:e.name}))})))}),0===o.length&&i.a.createElement(O.a,{item:!0},i.a.createElement(A.a,{variant:"body2"},"No assignments for this round.")))),i.a.createElement(Gn.a,null,i.a.createElement(ft.a,{onClick:r,color:"secondary"},"Ok")))}}]),t}(a.Component),Hn=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(s.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).state={openedGroupActivity:null},n.handleGroupClick=function(e){n.setState({openedGroupActivity:e})},n.handleDialogClose=function(){n.setState({openedGroupActivity:null})},n.renderRound=function(e){var t=n.props.wcif;return i.a.createElement(O.a,{container:!0},Qe(t,e).map(function(e){var t=Object(H.a)(e,3),r=t[0],a=t[1],o=t[2];return o.length>0&&i.a.createElement(O.a,{item:!0,xs:12,sm:!0,key:r.id},i.a.createElement(gt,{room:r}),i.a.createElement(N.a,null,o.map(function(e){return i.a.createElement(R.a,{key:e.id,button:!0,onClick:function(){return n.handleGroupClick(e)}},i.a.createElement(W.a,{primary:"Group ".concat(Te(e.activityCode).groupNumber),secondary:Ue(e,a)}))})))}))},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.openedGroupActivity,t=this.props.wcif,n=t.events.filter(function(e){return!De(e.id)});return i.a.createElement(i.a.Fragment,null,i.a.createElement(Bt,{events:n,render:this.renderRound}),e&&i.a.createElement(Jn,{open:!0,groupActivity:e,wcif:t,onClose:this.handleDialogClose}))}}]),t}(a.Component);function Vn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Yn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vn(n,!0).forEach(function(t){Object(_.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vn(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Kn=function(e){return te(e.events,function(e){return e.rounds}).reduce(function(e,t){if(De(t.id))return e;if(qe(e,t.id).length>0)return e;var n=function(e){return Math.max.apply(Math,Object(J.a)(ze(e).map(function(e){return e.id})))}(e),r=Ze(e,t.id).map(function(e){var t=ke("ActivityConfig",e).groups,n=Ae(e)/t,r=de(t,function(t){return{id:null,name:null,activityCode:null,startTime:ge(e.startTime,n*t),endTime:ge(e.startTime,n*t+n),childActivities:[],scrambleSetId:null}});return Yn({},e,{childActivities:r})});return se(te(r,function(e){return e.childActivities}),function(e){return[e.startTime,e.endTime]}).forEach(function(e,r){var a="".concat(t.id,"-g").concat(r+1);return Object.assign(e,{id:n+r+1,name:We(a),activityCode:a})}),r.reduce(_e,e)},e)},Zn=function(e){var t=nt(e);return[qn,cr,ur,lr].reduce(function(e,n){return n(e,t)},e)},qn=function(e,t){return le(t,function(t){return De(t.id)?-1/0:qe(e,t.id).length}).reduce(function(e,t){var n=Xn(e,t.id);if(De(t.id)){var r=ne(Ze(e,t.id),function(e){var t=e.activityCode;return Te(t).attemptNumber}),a=Object.values(r).reduce(function(e,t){var n=Math.ceil(e.length/t.length),r=re(t,fe(e,n));return te(r,function(e){var t=Object(H.a)(e,2),n=t[0],r=t[1];return dr(n.id,"competitor",r)})},n);return mr(e,a)}var i=Qn(e,t.id,n.length).map(function(e){var t=Object(H.a)(e,2),n=t[0],r=t[1];return{id:n.id,activity:n,size:r,competitors:[]}}),o=n.reduce(function(t,n){var r=t.map(function(t){return pr(e,t.activity,n)}),a=Math.max.apply(Math,Object(J.a)(r)),i=t.filter(function(e,t){return r[t]===a}),o=i.filter(function(r){return!gr(e,t,r.activity,n)}),c=o.length>0?o:i,u=c.find(function(e){var t=e.size;return e.competitors.length<t});if(u)return rr(t,u.id,n);var l=c[c.length-1],s=rr(t,l.id,n);return er(e,s,l.id)||tr(e,s,l.id)||s},i),c=te(o,function(e){var t=e.activity,n=e.competitors;return dr(t.id,"competitor",n)});return mr(e,c)},e)},Qn=function(e,t,n){var r=te(Ze(e,t),function(e){var t=ke("ActivityConfig",e).capacity;return e.childActivities.map(function(n){return[n,t/e.childActivities.length]})}),a=re.apply(void 0,Object(J.a)(r)),i=Object(H.a)(a,2),o=i[0],c=i[1],u=$n(c,n);return le(re(o,u),function(e){var t=Object(H.a)(e,1)[0].activityCode;return Te(t).groupNumber})},$n=function e(t,n){var r=Object(V.a)(t),a=r[0],i=r.slice(1);if(!a)return[];var o=Math.round(a*n);return[o].concat(Object(J.a)(e(ee(i),n-o)))},Xn=function(e,t){var n=ke("CompetitionConfig",e).competitorsSortingRule,r=wn(e,t),a=Te(t),i=a.eventId;if(a.roundNumber>1)return r;if("ranks"===n)return r;if("balanced"===n&&["333","222","333bf","333oh","333ft","pyram","skewb"].includes(i))return r;if(["balanced","symmetric"].includes(n)){var o=qe(e,t).length;return le(r,function(e){return o-(r.length-r.indexOf(e)-1)%o})}if("name-optimised"===n){var c=ne(r,function(e){return e.name.split(" ")[0]});return le(Object.values(c),function(e){return e.length}).reduce(function(e,t){var n=Math.ceil(e.length/t.length);return te(re(fe(e,n),t),function(e){var t=Object(H.a)(e,2),n=t[0],r=t[1];return[].concat(Object(J.a)(n),[r])})})}throw new Error("Unrecognised competitors sorting rule: '".concat(n,"'"))},er=function e(t,n,r){var a=n.find(function(e){return e.id===r});return n.slice(n.indexOf(a)+1).reduce(function(i,o){if(i)return i;var c=ae(a.competitors,function(e){return pr(t,a.activity,e)===pr(t,o.activity,e)&&!gr(t,n,o.activity,e)});if(!c)return null;if(o.competitors.length<o.size)return ir(n,r,o.id,c);if(o.competitors.length===o.size){var u=e(t,n,o.id);return u&&ir(u,r,o.id,c)}return null},null)},tr=function(e,t,n){var r=t.find(function(e){return e.id===n});return t.slice(0,t.indexOf(r)).reduceRight(function(a,i){if(a)return a;var o=r.competitors.find(function(n){return pr(e,r.activity,n)===pr(e,i.activity,n)&&!gr(e,t,i.activity,n)});if(!o)return null;var c=er(e,t,i.id);return c&&or(c,n,i.id,o)},null)},nr=function(e,t,n){return e.map(function(e){return e.id===t?Z(e,["competitors"],n):e})},rr=function(e,t,n){return nr(e,t,function(e){return[].concat(Object(J.a)(e),[n])})},ar=function(e,t,n){return nr(e,t,function(e){return e.filter(function(e){return e!==n})})},ir=function(e,t,n,r){return function(e,t,n){return nr(e,t,function(e){return[n].concat(Object(J.a)(e))})}(ar(e,t,r),n,r)},or=function(e,t,n,r){return rr(ar(e,t,r),n,r)},cr=function(e,t){var n=ke("CompetitionConfig",e).noTasksForNewcomers;return le(t,function(t){return wn(e,t.id).length}).reduce(function(e,t){if(De(t.id))return e;var r=Te(t.id).eventId;return Ze(e,t.id).reduce(function(e,a){var i=ke("ActivityConfig",a).scramblers;return 0===i?e:a.childActivities.reduce(function(e,a){var o=In(e).filter(function(e){return e.roles.includes("staff-scrambler")}),c=oe(wn(e,t.id),o),u=function(t){return t.filter(function(t){return hr(e,a,t)})},l=se(u(o),function(e){return[Math.floor(xn(e).length/3)].concat(Object(J.a)(Cn(e,r)))}),s=l.length>=i?[]:se(u(c),function(t){return[n&&!t.wcaId?1:-1,kn(t)>=10?-1:1,ie(["staff-dataentry","delegate","organizer"],t.roles).length,Sn(e,t,r).length>=2?1:-1,-fr(e,t,a.startTime),Math.floor(xn(t).length/6),sr(e,t,a.endTime)?1:-1].concat(Object(J.a)(Cn(t,r)))}),f=[].concat(Object(J.a)(l),Object(J.a)(s)),d=dr(a.id,"staff-scrambler",f.slice(0,i));return mr(e,d)},e)},e)},e)},ur=function(e,t){var n=ke("CompetitionConfig",e),r=n.noTasksForNewcomers,a=n.tasksForOwnEventsOnly;return t.reduce(function(e,t){if(De(t.id))return e;var n=Te(t.id).eventId;return Ze(e,t.id).reduce(function(e,t){var i=ke("ActivityConfig",t).runners;return 0===i?e:t.childActivities.reduce(function(e,t){var o=ce(In(e),function(e){return e.roles.includes("staff-runner")}),c=Object(H.a)(o,2),u=c[0],l=c[1],s=function(n){return n.filter(function(n){return hr(e,t,n)})},f=se(s(u),function(n){return[Math.floor(xn(n).length/3),sr(e,n,t.endTime)?1:-1]}),d=f.length>=i?[]:se(s(l),function(i){return[r&&!i.wcaId?1:-1,a&&!i.registration.eventIds.includes(n)?1:-1,kn(i)>=10?-1:1,ie(["staff-dataentry","delegate","organizer"],i.roles).length,Sn(e,i,n).length>=2?1:-1,-fr(e,i,t.startTime),Math.floor(xn(i).length/6),sr(e,i,t.endTime)?1:-1]}),m=[].concat(Object(J.a)(f),Object(J.a)(d)),h=dr(t.id,"staff-runner",m.slice(0,i));return mr(e,h)},e)},e)},e)},lr=function(e,t){var n=ke("CompetitionConfig",e),r=n.noTasksForNewcomers,a=n.tasksForOwnEventsOnly;return t.reduce(function(e,t){if(De(t.id))return e;var n=Te(t.id).eventId;return Ze(e,t.id).reduce(function(e,t){var i=ke("ActivityConfig",t).assignJudges,o=Ge(e,t.id);return i?t.childActivities.reduce(function(e,t){var i=e.persons.filter(function(e){return Pn(e,t.id,"competitor")}).length,c=Math.min(o,i),u=ce(In(e),function(e){return e.roles.includes("staff-judge")}),l=Object(H.a)(u,2),s=l[0],f=l[1],d=function(n){return n.filter(function(n){return hr(e,t,n)})},m=se(d(s),function(n){return[xn(n).length,sr(e,n,t.endTime)?1:-1]}),h=m.length>=c?[]:se(d(f),function(i){return[r&&!i.wcaId?1:-1,a&&!i.registration.eventIds.includes(n)?1:-1,kn(i)>=10?-1:1,ie(["staff-dataentry","delegate","organizer"],i.roles).length,Sn(e,i,n).length>=2?1:-1,-fr(e,i,t.startTime),xn(i).length,sr(e,i,t.endTime)?1:-1,i.registration?i.registration.eventIds.length:0]}),p=[].concat(Object(J.a)(m),Object(J.a)(h)),g=dr(t.id,"staff-judge",p.slice(0,c));return mr(e,g)},e):e},e)},e)},sr=function(e,t,n){var r=t.assignments.filter(function(e){return"competitor"===e.assignmentCode}).map(function(t){var n=t.activityId;return Le(e,n).startTime}).filter(function(e){return e>=n});if(0===r.length)return!1;var a=r.reduce(function(e,t){return e<t?e:t});return ve(a,n)<=9e5},fr=function(e,t,n){var r=t.assignments.map(function(t){var n=t.activityId;return Le(e,n)}).filter(function(e){var t=e.startTime;return new Date(t).getDay()===new Date(n).getDay()});if(0===r.length)return 0;var a=re.apply(void 0,Object(J.a)(r.map(function(e){return[e.startTime,e.endTime]}))).map(function(e){return e.sort()}),i=Object(H.a)(a,2),o=i[0],c=i[1];if(o[0]>n)return 1+1/ve(n,o[0]);var u=ae(c,function(e){return e<=n}),l=o.find(function(e){return e>=n});if(u)if(l){if(ve(n,u)>36e5&&ve(n,l)>36e5)return 3}else if(ve(n,u)>18e5)return 2;return 4},dr=function(e,t,n){return n.map(function(n){return Yn({},n,{assignments:[].concat(Object(J.a)(n.assignments),[{activityId:e,assignmentCode:t}])})})},mr=function(e,t){return Q(e,["persons"],function(e){return t.find(function(t){return t.wcaUserId===e.wcaUserId})||e})},hr=function(e,t,n){return!n.assignments.some(function(n){var r=n.activityId;return Me(Le(e,r),t)})},pr=function(e,t,n){var r=n.assignments.map(function(n){var r=n.activityId;return function(e,t){if(!Me(e,t))return 0;var n=[e.startTime,e.endTime,t.startTime,t.endTime].sort(),r=Object(H.a)(n,3),a=r[1],i=r[2];return new Date(i)-new Date(a)}(Le(e,r),t)});return-he(r)/Ae(t)},gr=function(e,t,n,r){return ie(["staff-dataentry","delegate","organizer"],r.roles).some(function(a){var i=In(e).filter(function(e){return e.wcaUserId!==r.wcaUserId}).filter(function(e){return e.roles.includes(a)});return i.length>0&&i.every(function(r){return!hr(e,n,r)||t.some(function(e){var t=e.activity;return e.competitors.includes(r)&&Me(t,n)})})})},vr=function(e){return Q(e,["events"],function(t){return Q(t,["rounds"],function(t){return q(t,["scrambleSetCount"],br(e,t.id))})})},br=function(e,t){return De(t)?1:me(qe(e,t).map(function(e){return e.startTime+e.endTime})).length},yr=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(s.a)(this,Object(f.a)(t).call(this,e))).createGroupActivities=function(){var e=n.state.localWcif;n.setState({localWcif:vr(Kn(e))})},n.assignTasks=function(){var e=n.state.localWcif;n.setState({localWcif:Zn(e)})},n.clearGroups=function(){var e=n.state.localWcif;n.setState({localWcif:it(e)})},n.state={localWcif:e.wcif},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.localWcif,t=this.props,n=t.wcif,r=t.onWcifUpdate,a=t.history,o=function(e){return e.events.every(function(t){return t.rounds.every(function(t){return qe(e,t.id).length>0})})}(e);return i.a.createElement(O.a,{container:!0,spacing:8,justify:"flex-end"},i.a.createElement(O.a,{item:!0,xs:12},!o&&i.a.createElement(Wn.a,{style:{maxWidth:"none"},message:"To assign tasks you need to create groups first. This will also determine scramble set count for each round.",action:i.a.createElement(ft.a,{onClick:this.createGroupActivities,style:{color:An.a[500]},size:"small"},"Create groups")}),o&&nt(e).length>0&&i.a.createElement(Wn.a,{style:{maxWidth:"none"},message:"There are rounds with no tasks assigned.",action:i.a.createElement(ft.a,{onClick:this.assignTasks,style:{color:An.a[500]},size:"small"},"Assign tasks")})),i.a.createElement(O.a,{item:!0,xs:12},i.a.createElement(Hn,{wcif:e})),i.a.createElement(O.a,{item:!0},i.a.createElement(ft.a,{variant:"contained",component:U.a,to:"/competitions/".concat(e.id)},"Cancel")),i.a.createElement(O.a,{item:!0},i.a.createElement(Nt.a,{title:"This clears groups and assignments only for rounds without results.",placement:"bottom"},i.a.createElement(ft.a,{variant:"contained",onClick:this.clearGroups},"Clear"))),i.a.createElement(O.a,{item:!0},i.a.createElement(yn,{wcif:n,updatedWcif:e,onWcifUpdate:r,history:a})))}}]),t}(a.Component),Or=n(101),Er=n.n(Or);fetch("vfs-fonts.bundle.v2.json").then(function(e){return e.json()}).then(function(e){return Er.a.vfs=e});var Cr=function(e){return{normal:e,bold:e,italic:e,bolditalics:e}};Er.a.fonts={Roboto:{normal:"Roboto-Regular.ttf",bold:"Roboto-Medium.ttf",italics:"Roboto-Italic.ttf",bolditalics:"Roboto-MediumItalic.ttf"},WenQuanYiZenHei:Cr("WenQuanYiZenHei.ttf"),NotoSansThai:Cr("NotoSansThaiUI-Regular.ttf"),NotoSansArabic:Cr("NotoSansArabicUI-Regular.ttf"),NotoSansGeorgian:Cr("NotoSansGeorgian-Regular.ttf"),NotoSansArmenian:Cr("NotoSansArmenian-Regular.ttf")};var jr=Er.a,wr=function(e,t){return"333mbf"===t?"".concat(xr(e.attemptResult)," points"):"333fm"===t?"".concat(e.attemptResult," moves"):Sr(e.attemptResult)},kr=function(e){var t=e.centiseconds,n=e.cumulativeRoundIds,r=Sr(t);if(0===n.length)return r;if(1===n.length)return"".concat(r," in total");var a=n.map(function(e){var t=Te(e),n=t.eventId,r=t.roundNumber;return"".concat(function(e){return Ne("shortName",e)}(n)," R").concat(r)});return"".concat(r," total for ").concat(a.join(", "))},xr=function(e){return 99-Math.floor(e/1e7)%100},Sr=function(e){var t=new Date(null);return t.setUTCMilliseconds(10*e),t.toISOString().substr(11,11).replace(/^[0:]*(?!\.)/g,"")},Ir=function(e){var t=e.charCodeAt(0);return pe(t,0,1327)?"Roboto":pe(t,1536,1791)||pe(t,1872,1919)?"NotoSansArabic":pe(t,3584,3711)?"NotoSansThai":pe(t,1328,1423)?"NotoSansArmenian":pe(t,4256,4351)?"NotoSansGeorgian":"WenQuanYiZenHei"},Nr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.swapLatinWithLocalNames,r=void 0!==n&&n,a=t.short,i=void 0!==a&&a,o=e.match(/(.+)\s*[(\uff08](.+)[)\uff09]/)||[null,e,null],c=Object(H.a)(o,3),u=c[1],l=c[2];if(!l)return u;var s=[u,{text:l,font:Ir(l)}],f=r?s.reverse():s,d=Object(H.a)(f,2),m=d[0],h=d[1];return i?m:[m," (",h,")"]},Pr=function(e){if(!e)return Promise.resolve(null);var t=new URLSearchParams({url:e,bri:50,bg:"white",w:200,h:200,t:"letterbox",output:"jpg",encoding:"base64"});return fetch("https://images.weserv.nl/?".concat(t.toString())).then(function(e){return e.text()}).catch(function(){return null})};function Rr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Tr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rr(n,!0).forEach(function(t){Object(_.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rr(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Wr={1:1,2:2,3:3,m:3,a:5},Dr=function(e,t){var n=ke("CompetitionConfig",e).scorecardsBackgroundUrl;Pr(n).then(function(n){var r=Ur(Fr(e,t),n);jr.createPdf(r).download("".concat(e.id,"-scorecards.pdf"))})},Ar=function(e){var t=ke("CompetitionConfig",e).scorecardsBackgroundUrl;Pr(t).then(function(t){var n=Ur(zr(e),t);jr.createPdf(n).download("".concat(e.id,"-blank-scorecards.pdf"))})},Ur=function(e,t){return{background:[].concat(Object(J.a)(null===t?[]:[{x:60,y:170},{x:360,y:170},{x:60,y:590},{x:360,y:590}].map(function(e){return{absolutePosition:e,image:t}})),[{canvas:[Mr({x1:20,y1:420.945,x2:575.28,y2:420.945}),Mr({x1:297.64,y1:20,x2:297.64,y2:821.89})]}]),pageMargins:[20,20],content:{layout:{paddingLeft:function(e){return e%2===0?0:20},paddingRight:function(e){return e%2===0?20:0},paddingTop:function(e){return e%2===0?0:20},paddingBottom:function(e){return e%2===0?20:0},hLineWidth:function(){return 0},vLineWidth:function(){return 0}},table:{widths:["*","*"],heights:380.945,dontBreakRows:!0,body:fe(e,2)}}}},Mr=function(e){return Tr({},e,{type:"line",lineWidth:.1,dash:{length:10},lineColor:"#888888"})},Fr=function(e,t){var n=ke("CompetitionConfig",e).localNamesFirst;return te(t,function(t){var r=Gr(e,t.id),a=he(r.map(function(e){var t=Object(H.a)(e,2);t[0];return t[1].length}));return te(r,function(r){var i=Object(H.a)(r,2),o=i[0],c=i[1].map(function(r){return Br({scorecardNumber:a--,competitionName:e.shortName,activityCode:o.activityCode,round:t,attemptCount:Wr[t.format],competitor:r,localNamesFirst:n})}),u=c.length%4;return 0===u?c:c.concat(de(4-u,function(){return{}}))})})},Gr=function(e,t){var n=wn(e,t);if(n)return(De(t)?qe(e,t).slice(0,1):le(qe(e,t),function(e){var t=e.activityCode;return Te(t).groupNumber})).map(function(e){return[e,n.filter(function(t){return Pn(t,e.id,"competitor")})]});var r=jn(e)[t].length;return(De(t)?[[qe(e,t)[0],r]]:Qn(e,t,r)).map(function(e){var t=Object(H.a)(e,2),n=t[0],r=t[1];return[n,de(r,function(){return{name:" ",registrantId:" "}})]})},zr=function(e){var t=te(e.events,function(e){return e.rounds}).map(function(e){return Wr[e.format]});return te(me(t),function(t){return de(4,function(){return Br({competitionName:e.name,attemptCount:t})})})},Br=function(e){var t=e.scorecardNumber,n=e.competitionName,r=e.activityCode,a=e.round,i=e.attemptCount,o=void 0===i?5:i,c=e.competitor,u=void 0===c?{name:" ",registrantId:" "}:c,l=e.localNamesFirst,s=void 0!==l&&l,f=r?Te(r):{},d=f.eventId,m=f.roundNumber,h=f.groupNumber,p=a||{},g=p.cutoff,v=p.timeLimit;return[{text:t,fontSize:10},{text:n,bold:!0,fontSize:15,margin:[0,0,0,10],alignment:"center"},{margin:[25,0,0,0],table:{widths:["*","auto","auto"],body:[Lr(["Event","Round","Group"]),[d?Ie(d):" ",{text:m,alignment:"center"},{text:h,alignment:"center"}]]}},{margin:[25,0,0,0],table:{widths:[25,"*"],body:[Lr(["ID","Name"]),[{text:u.registrantId,alignment:"center"},{text:Nr(u.name,{swapLatinWithLocalNames:s}),maxHeight:20}]]}},{margin:[0,10,0,0],table:{widths:[16,25,"*",25,25],body:[Lr(["","Scr","Result","Judge","Comp"],{alignment:"center"})].concat(Object(J.a)(_r(g,o)),[[Tr({text:"Extra attempt"},Vr,{colSpan:5,margin:[0,1],fontSize:10})],Hr("_"),[Tr({text:""},Vr,{colSpan:5,margin:[0,1]})]])}},{fontSize:10,columns:[g?{text:"Cutoff: ".concat(wr(g,d)),alignment:"center"}:{},v?{text:"Time limit: ".concat(kr(v)),alignment:"center"}:{}]}]},Lr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.map(function(e){return Tr({},t,{},Vr,{fontSize:9,text:e})})},_r=function(e,t){return de(t,function(e){return Hr(e+1)}).reduce(function(n,r,a){return[].concat(Object(J.a)(n),a+1===t?[r]:[r,Jr(e&&a+1===e.numberOfAttempts)])},[])},Jr=function(e){return[Tr({},Vr,{colSpan:5,margin:[0,1],columns:e?[{canvas:[{type:"line",x1:0,y1:0,x2:257.64,y2:0,dash:{length:5}}]}]:[]})]},Hr=function(e){return[Tr({text:e},Vr,{fontSize:20,bold:!0,alignment:"center"}),{},{},{},{}]},Vr={border:[!1,!1,!1,!1]},Yr=function(e,t){var n=Kr(e,t);jr.createPdf(n).download("".concat(e.id,"-group-overview.pdf"))},Kr=function(e,t){return{footer:function(e,t){return{text:"".concat(e," of ").concat(t),alignment:"center",fontSize:10}},content:se(te(te(t,function(t){return Qe(e,t.id)}),function(e){var t=Object(H.a)(e,3),n=t[0],r=t[1];return t[2].map(function(e){return[n,r,e]})}),function(e){var t=Object(H.a)(e,3),n=(t[0],t[1],t[2]),r=n.startTime,a=n.activityCode;return[r,Te(a).groupNumber]}).map(function(t){var n=Object(H.a)(t,3),r=n[0],a=n[1],i=n[2];return Zr(e,r,a,i)})}},Zr=function(e,t,n,r){var a=[["Competitors","competitor"],["Scramblers","staff-scrambler"],["Runners","staff-runner"],["Judges","staff-judge"]].map(function(t){var n=Object(H.a)(t,2),a=n[0],i=n[1];return[a,e.persons.filter(function(e){return Pn(e,r.id,i)})]}).filter(function(e){var t=Object(H.a)(e,2);t[0];return t[1].length>0});return{unbreakable:!0,margin:[0,0,0,10],stack:[{text:We(r.activityCode),bold:!0,fontSize:14},{columns:["Time: ".concat(Ue(r,n)),"Room: ".concat(t.name)],margin:[0,5,0,5]},{fontSize:8,columns:a.map(function(e){var t=Object(H.a)(e,2),n=t[0],r=t[1];return[{text:"".concat(n," (").concat(r.length,")"),bold:!0,fontSize:10,margin:[0,0,0,2]},{ul:r.map(function(e){return Nr(e.name,{short:!0})}).sort()}]})}]}},qr=function(e){function t(e){var n;Object(u.a)(this,t),(n=Object(s.a)(this,Object(f.a)(t).call(this,e))).handleScorecardsDownloadClick=function(){Dr(n.props.wcif,n.state.selectedRounds)},n.handleGroupOverviewDownloadClick=function(){Yr(n.props.wcif,n.state.selectedRounds)},n.handleBlankScorecardsDownloadClick=function(){Ar(n.props.wcif)},n.handleRoundClick=function(e){return function(t){var r=n.state.selectedRounds;n.setState({selectedRounds:r.includes(e)?oe(r,[e]):[].concat(Object(J.a)(r),[e])})}};var r=rt(n.props.wcif),a=r.every(function(e){return 1===Te(e.id).roundNumber})?r:[];return n.state={selectedRounds:a},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.state.selectedRounds,n=this.props.wcif,r=le(et(n).filter(function(e){return"333fm"!==Te(e.id).eventId}),function(e){return Te(e.id).roundNumber}),a=rt(n);return i.a.createElement(L.a,{style:{padding:16}},i.a.createElement(A.a,{variant:"body1"},"Select rounds"),i.a.createElement(N.a,{style:{width:400}},r.map(function(n){return i.a.createElement(R.a,{key:n.id,button:!0,onClick:e.handleRoundClick(n),style:a.includes(n)?{}:{opacity:.5}},i.a.createElement(z.a,null,i.a.createElement(Tt,{eventId:Te(n.id).eventId})),i.a.createElement(W.a,{primary:We(n.id)}),i.a.createElement(yt.a,{checked:t.includes(n),tabIndex:-1,disableRipple:!0,style:{padding:0}}))})),i.a.createElement(O.a,{container:!0,spacing:8},i.a.createElement(O.a,{item:!0},i.a.createElement(ft.a,{onClick:this.handleScorecardsDownloadClick,disabled:0===t.length},"Scorecards")),i.a.createElement(O.a,{item:!0},i.a.createElement(ft.a,{onClick:this.handleGroupOverviewDownloadClick,disabled:0===t.length},"Group overview")),i.a.createElement(O.a,{item:!0,style:{flexGrow:1}}),i.a.createElement(O.a,{item:!0},i.a.createElement(ft.a,{onClick:this.handleBlankScorecardsDownloadClick},"Blank scorecards"))))}}]),t}(a.Component),Qr=function(e){var t=$r(e);jr.createPdf(t).download("".concat(e.id,"-competitor-cards.pdf"))},$r=function(e){return{pageMargins:[5,5],content:fe(Xr(e),3).map(function(e){return{columns:e,fontSize:8,unbreakable:!0}})}},Xr=function(e){var t=le(In(e),function(e){return e.name}).map(function(t){return ea(e,t)}),n=t.length%3;return 0===n?t:t.concat(de(3-n,function(){return{}}))},ea=function(e,t){var n=e.events.filter(function(e){return!De(e.id)}),r=(ke("CompetitionConfig",e)||{localNamesFirst:!1}).localNamesFirst,a=t.assignments.map(function(t){var n=t.activityId,r=t.assignmentCode,a=Le(e,n),i=Te(a.activityCode),o=i.eventId,c=i.roundNumber;return{assignmentCode:r,eventId:o,groupNumber:i.groupNumber,roundNumber:c}}).filter(function(e){return 1===e.roundNumber}),i=re.apply(void 0,Object(J.a)([["competitor","Comp"],["staff-scrambler","Scr"],["staff-runner","Run"],["staff-judge","Judge"]].filter(function(e){var t=Object(H.a)(e,1)[0];return a.some(function(e){return e.assignmentCode===t})}))),o=Object(H.a)(i,2),c=o[0],u=o[1];return{margin:[5,5],stack:[{text:Nr(t.name,{swapLatinWithLocalNames:r}),fontSize:10,maxHeight:20},{columns:["ID: ".concat(t.registrantId),{text:t.wcaId?"WCA ID: ".concat(t.wcaId):{},alignment:"right"}]},{table:{widths:["auto"].concat(Object(J.a)(u.map(function(){return"*"}))),body:[["Event"].concat(Object(J.a)(u.map(function(e){return{text:e,alignment:"center"}})))].concat(Object(J.a)(n.map(function(e){return[Ie(e.id)].concat(Object(J.a)(c.map(function(t){return function(e,t){return{text:a.filter(function(n){return n.eventId===e&&n.assignmentCode===t}).map(function(e){return e.groupNumber}).join(", "),alignment:"center"}}(e.id,t)})))})))},layout:{paddingLeft:function(){return 2},paddingRight:function(){return 2},paddingTop:function(){return 1},paddingBottom:function(){return 1}}}].concat(Object(J.a)(de(Math.max(0,12-n.length),function(){return{text:" "}})))}},ta=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).handleDownloadClick=function(){Qr(n.props.wcif)},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return i.a.createElement(L.a,{style:{padding:16}},i.a.createElement(A.a,{variant:"body1"},"First round task assignments for every competitor. Useful to be distributed along with name tags."),i.a.createElement(ft.a,{onClick:this.handleDownloadClick},"Download"))}}]),t}(a.Component),na=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).state={tabValue:0},n.handleTabChange=function(e,t){n.setState({tabValue:t})},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.tabValue,t=this.props.wcif;return i.a.createElement(O.a,{container:!0,spacing:8,justify:"flex-end"},i.a.createElement(O.a,{item:!0,xs:12},i.a.createElement(lt.a,{position:"static",color:"default"},i.a.createElement(pt.a,{value:e,onChange:this.handleTabChange,centered:!0},i.a.createElement(mt.a,{label:"Scorecards"}),i.a.createElement(mt.a,{label:"Competitor cards"})))),i.a.createElement(O.a,{item:!0,xs:12},0===e&&i.a.createElement(qr,{wcif:t}),1===e&&i.a.createElement(ta,{wcif:t})),i.a.createElement(O.a,{item:!0},i.a.createElement(ft.a,{variant:"contained",color:"primary",component:U.a,to:"/competitions/".concat(t.id)},"Done")))}}]),t}(a.Component),ra=n(194),aa=n.n(ra),ia=n(196),oa=n.n(ia),ca=n(67),ua=n.n(ca),la=n(195),sa=n.n(la),fa=n(197),da=n.n(fa),ma=n(128),ha=n.n(ma),pa=n(77),ga=n.n(pa);function va(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ba(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?va(n,!0).forEach(function(t){Object(_.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):va(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ya=[{id:"staff-scrambler",name:"Scrambler"},{id:"staff-judge",name:"Judge"},{id:"staff-runner",name:"Runner"},{id:"staff-dataentry",name:"Data entry"}],Oa=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(s.a)(this,Object(f.a)(t).call(this,e))).handleSearchChange=function(e){n.setState({searchString:e.target.value})},n.handleChangePage=function(e,t){n.setState({page:t})},n.clearRoles=function(){var e=n.state.localWcif,t=ya.map(function(e){return e.id});n.setState({localWcif:ba({},e,{persons:e.persons.map(function(e){return ba({},e,{roles:oe(e.roles,t)})})})})},n.state={localWcif:e.wcif,page:0,searchString:""},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"handleRoleChange",value:function(e,t,n){var r=this.state.localWcif,a=n.target.checked;this.setState({localWcif:ba({},r,{persons:r.persons.map(function(n){return n.wcaUserId===t?ba({},n,{roles:a?[].concat(Object(J.a)(n.roles),[e]):oe(n.roles,[e])}):n})})})}},{key:"render",value:function(){var e=this,t=this.state,n=t.page,r=t.searchString,a=t.localWcif,o=this.props,c=o.wcif,u=o.onWcifUpdate,l=o.history,s=le(In(a),function(e){return e.name}),f=r?s.filter(function(e){return r.split(/\s*,\s*/).some(function(t){return t&&e.name.match(new RegExp(t,"i"))})}):s;return i.a.createElement(O.a,{container:!0,spacing:8,justify:"flex-end"},i.a.createElement(O.a,{item:!0,xs:12},i.a.createElement(L.a,null,i.a.createElement(ga.a,null,i.a.createElement(O.a,{container:!0,spacing:8,alignItems:"flex-end"},i.a.createElement(O.a,{item:!0},i.a.createElement(Et.a,{label:"Search",value:r,onChange:this.handleSearchChange})),i.a.createElement(O.a,{item:!0},i.a.createElement(Nt.a,{title:"If you separate search phrases with a comma, anyone matching either of them will show up.",placement:"right"},i.a.createElement(F.a,null,"info"))))),i.a.createElement("div",{style:{overflowX:"auto"}},i.a.createElement(aa.a,null,i.a.createElement(sa.a,null,i.a.createElement(ha.a,null,i.a.createElement(ua.a,null,"Person"),ya.map(function(e){return i.a.createElement(ua.a,{key:e.id,padding:"none",style:{textAlign:"center"}},e.name)}))),i.a.createElement(oa.a,null,f.slice(5*n,5*n+5).map(function(t){return i.a.createElement(ha.a,{key:t.wcaUserId,hover:!0},i.a.createElement(ua.a,null,t.name),ya.map(function(n){return i.a.createElement(ua.a,{key:n.id,padding:"checkbox",style:{textAlign:"center"}},i.a.createElement(yt.a,{checked:t.roles.includes(n.id),onChange:e.handleRoleChange.bind(e,n.id,t.wcaUserId)}))}))})))),i.a.createElement(da.a,{component:"div",count:f.length,rowsPerPage:5,rowsPerPageOptions:[5],page:n,onChangePage:this.handleChangePage}))),i.a.createElement(O.a,{item:!0,xs:12},i.a.createElement(A.a,{variant:"caption"},"Use this section only if you have a group of staff among competitors. People with the given role will be prioritized during task assignment."),i.a.createElement(A.a,{variant:"caption"},"Note: if you don't set any roles, people will still be assigned tasks.")),i.a.createElement(O.a,{item:!0},i.a.createElement(ft.a,{variant:"contained",component:U.a,to:"/competitions/".concat(a.id)},"Cancel")),i.a.createElement(O.a,{item:!0},i.a.createElement(ft.a,{variant:"contained",onClick:this.clearRoles},"Clear")),i.a.createElement(O.a,{item:!0},i.a.createElement(yn,{wcif:c,updatedWcif:a,onWcifUpdate:u,history:l})))}}]),t}(a.Component),Ea=function(e){var t=e.events;return te(t,function(t){if(0===t.rounds.length)return["No rounds specified for ".concat(We(t.id),".")];var n=te(t.rounds.slice(0,-1),function(e){return e.advancementCondition?[]:["No advancement condition specified for ".concat(We(e.id),".")]}),r=te(t.rounds,function(t){return Ze(e,t.id).length>0?[]:["No schedule activities for ".concat(We(t.id),".")]});return[].concat(Object(J.a)(n),Object(J.a)(r))})},Ca=function(e){var t=In(e);return t.forEach(function(e,t){return e.registrantId=t+1}),wa().then(function(n){var r=n.find(function(t){return e.name.startsWith(t.name)});return r?ka(r.id).then(function(e){if(0===e.competitors.length)return null;t.forEach(function(t){var n=e.competitors.find(function(e){return ja(t.name)===ja(e.name)});if(!n)throw new Error("Couldn't find Cubecomps competitor id for ".concat(t.name,"."));t.registrantId=parseInt(n.id,10)})}):null}).then(function(){return e})},ja=function(e){return e.toLowerCase().replace(/[(\uff08].*/,"").trim().split(/\s+/).join(" ")},wa=function(){return xa("/competitions").then(function(e){return Object.values(e).reduce(function(e,t){return e.concat(t)},[])})},ka=function(e){return xa("/competitions/".concat(e))},xa=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="https://m.cubecomps.com/api/v1";return fetch("".concat(n).concat(e),Object.assign({},t,{headers:new Headers({"Content-Type":"application/json"})})).then(function(e){if(!e.ok)throw new Error(e.statusText);return e}).then(function(e){return e.json()})},Sa=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).state={wcif:null,loading:!0,errors:[]},n.handleWcifUpdate=function(e){n.setState({wcif:e})},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e,t=this;(e=this.props.match.params.competitionId,bn("/competitions/".concat(e,"/wcif"))).then(function(e){return Z(e,["events"],Pe)}).then(Ca).then(function(e){return t.setState({wcif:e,loading:!1,errors:Ea(e)})}).catch(function(e){return t.setState({errors:[e.message],loading:!1})})}},{key:"render",value:function(){var e=this,t=this.state,n=t.wcif,r=t.loading,o=t.errors,c=this.props.match;return r?i.a.createElement(S.a,null):i.a.createElement("div",null,0===o.length?i.a.createElement(a.Fragment,null,i.a.createElement(A.a,{variant:"h5",style:{marginBottom:16}},n.name),i.a.createElement(h.a,null,i.a.createElement(p.a,{exact:!0,path:c.url,render:function(e){return i.a.createElement(ct,Object.assign({},e,{wcif:n,baseUrl:c.url}))}}),i.a.createElement(p.a,{path:"".concat(c.url,"/roles"),render:function(t){return i.a.createElement(Oa,Object.assign({},t,{wcif:n,onWcifUpdate:e.handleWcifUpdate}))}}),i.a.createElement(p.a,{path:"".concat(c.url,"/config"),render:function(t){return i.a.createElement(Rn,Object.assign({},t,{wcif:n,onWcifUpdate:e.handleWcifUpdate}))}}),i.a.createElement(p.a,{path:"".concat(c.url,"/groups"),render:function(t){return i.a.createElement(yr,Object.assign({},t,{wcif:n,onWcifUpdate:e.handleWcifUpdate}))}}),i.a.createElement(p.a,{path:"".concat(c.url,"/printing"),render:function(e){return i.a.createElement(na,Object.assign({},e,{wcif:n}))}}))):i.a.createElement(a.Fragment,null,i.a.createElement(A.a,{variant:"h5"},"Failed to load competition data"),i.a.createElement(N.a,null,o.map(function(e){return i.a.createElement(R.a,{key:e},i.a.createElement(W.a,null,e))}))))}}]),t}(a.Component),Ia=n(198),Na=n.n(Ia),Pa=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(s.a)(this,Object(f.a)(t).call(this,e))).state={competitions:[],loading:!0,error:null},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;(function(){var e=new Date(Date.now()-6048e5),t=new URLSearchParams({managed_by_me:!0,start:e.toISOString()});return bn("/competitions?".concat(t.toString()))})().then(function(t){return e.setState({competitions:le(t,function(e){return e.start_date}),loading:!1})}).catch(function(t){return e.setState({error:t.message,loading:!1})})}},{key:"render",value:function(){var e=this.state,t=e.competitions,n=e.loading,r=e.error;return i.a.createElement("div",null,i.a.createElement(L.a,null,i.a.createElement(N.a,{subheader:i.a.createElement(Na.a,null,"Your competitions")},r&&i.a.createElement(R.a,null,i.a.createElement(z.a,null,i.a.createElement(F.a,null,"error")),i.a.createElement(W.a,{primary:"Couldn't fetch competitions: ".concat(r)})),!n&&!r&&0===t.length&&i.a.createElement(R.a,null,i.a.createElement(z.a,null,i.a.createElement(F.a,null,"sentiment_very_dissatisfied")),i.a.createElement(W.a,{primary:"You have no upcoming competitions to manage."})),t.map(function(e){return i.a.createElement(R.a,{key:e.id,button:!0,component:U.a,to:"/competitions/".concat(e.id)},i.a.createElement(W.a,{primary:e.name}))})),n&&i.a.createElement(S.a,null)))}}]),t}(a.Component),Ra=n(123),Ta=n.n(Ra),Wa=n(199),Da=(n(419),[{text:"Donate",url:"https://ko-fi.com/jonatanklosko"},{text:"Guide",url:"https://github.com/jonatanklosko/groupifier-next/wiki/Guide"},{text:"GitHub",url:"https://github.com/jonatanklosko/groupifier-next"},{text:"Contact",url:"mailto:jonatanklosko@gmail.com"},{text:"v".concat(Wa.a),url:"https://github.com/jonatanklosko/groupifier-next"}]),Aa=function(){return i.a.createElement(O.a,{container:!0,className:"footer"},i.a.createElement(O.a,{item:!0,style:{flexGrow:1}},i.a.createElement(A.a,null,"Made with ",i.a.createElement(F.a,{className:"footer-icon",style:{color:Ta.a[700]}},"favorite")," ","by ",i.a.createElement("a",{href:"https://github.com/jonatanklosko",target:"_blank",rel:"noopener noreferrer"},"Jonatan K\u0142osko"))),i.a.createElement(O.a,{item:!0},i.a.createElement(O.a,{container:!0,spacing:8},Da.map(function(e){var t=e.text,n=e.url;return i.a.createElement(O.a,{item:!0,key:t},i.a.createElement(A.a,null,i.a.createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer"},t)))}))))},Ua=n(200),Ma=n.n(Ua),Fa=function(e){var t=e.isSignedIn,n=e.onSignIn,r=e.onSignOut;return i.a.createElement(lt.a,{position:"static",color:"primary"},i.a.createElement(ga.a,null,i.a.createElement(A.a,{variant:"h6",color:"inherit"},i.a.createElement(U.a,{to:t?"/competitions":"/"},i.a.createElement(F.a,{style:{fontSize:"1.5em",verticalAlign:"middle",marginRight:10}},"people"),"Groupifier")),i.a.createElement(A.a,{style:{flexGrow:1,marginLeft:16},variant:"body2",color:"inherit"},"This version is meant to be used with Cubecomps. Navigate ",i.a.createElement(Ma.a,{href:"https://groupifier.jonatanklosko.com",color:"inherit",style:{fontWeight:500}},"here ",i.a.createElement("span",{role:"img","aria-label":"rocket"},"\ud83d\ude80"))," if you're using WCA Live."),t?i.a.createElement(ft.a,{color:"inherit",onClick:r},"Sign out"):i.a.createElement(ft.a,{color:"inherit",onClick:n},"Sign in")))},Ga=["Allows for marking competitors as different kinds of staff and handles them in a special manner.","Supports multiple rooms/stages running simultaneously.","Suggests number of groups and necessary roles, while leaving the final decision to the user.","Once configured, creates groups and does its best to optimally assign people to these groups.","Generates documents like scorecards and competitor cards with task assignments."],za=function(){return i.a.createElement(O.a,{container:!0,spacing:24,direction:"column"},i.a.createElement(O.a,{item:!0},i.a.createElement(A.a,{variant:"h4"},"What is Groupifier?")),i.a.createElement(O.a,{item:!0},i.a.createElement(A.a,{variant:"subtitle1"},"Task and group management tool for WCA competition organizers. It's designed to be highly customizable and work well with complex schedules.")),i.a.createElement(O.a,{item:!0},i.a.createElement(A.a,{variant:"h4"},"What does it do?")),i.a.createElement(O.a,{item:!0},i.a.createElement(N.a,null,Ga.map(function(e){return i.a.createElement(R.a,{key:e},i.a.createElement(z.a,null,i.a.createElement(F.a,null,"check")),i.a.createElement(W.a,{primary:e}))}))))},Ba=Object(E.createMuiTheme)({palette:{primary:j.a,secondary:k.a},typography:{useNextVariants:!0}}),La=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(s.a)(this,Object(f.a)(t).call(this,e))).handleSignIn=function(){mn()},n.handleSignOut=function(){pn(),n.setState({isSignedIn:!1})},n.state={isSignedIn:gn()},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.isSignedIn;return i.a.createElement(m.a,null,i.a.createElement(E.MuiThemeProvider,{theme:Ba},i.a.createElement("div",{style:{display:"flex",minHeight:"100vh",flexDirection:"column"}},i.a.createElement(b.a,null),i.a.createElement(Fa,{isSignedIn:e,onSignIn:this.handleSignIn,onSignOut:this.handleSignOut}),i.a.createElement(O.a,{container:!0,justify:"center",style:{flexGrow:1}},i.a.createElement(O.a,{item:!0,xs:12,md:8,style:{padding:16}},e?i.a.createElement(h.a,null,i.a.createElement(p.a,{path:"/competitions/:competitionId",component:Sa}),i.a.createElement(p.a,{path:"/competitions",component:Pa}),i.a.createElement(g.a,{to:"/competitions"})):i.a.createElement(h.a,null,i.a.createElement(p.a,{exact:!0,path:"/",component:za}),i.a.createElement(g.a,{to:"/"})))),i.a.createElement(Aa,null))))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));!function(){var e=window.location.hash.replace(/^\W*/,""),t=new URLSearchParams(e);if(t.has("access_token")&&localStorage.setItem(fn("accessToken"),t.get("access_token")),t.has("expires_in")){var n=t.get("expires_in")-900,r=new Date((new Date).getTime()+1e3*n);localStorage.setItem(fn("expirationTime"),r.toISOString())}var a=localStorage.getItem(fn("expirationTime"));a&&new Date>=new Date(a)&&pn(),t.has("access_token")&&(window.location.hash="");var i=localStorage.getItem(fn("redirectPath"));i&&(window.location.hash=i,localStorage.removeItem(fn("redirectPath")));var o=window.location.hash.replace(/^#/,"");o.startsWith("/competitions")&&!gn()&&(localStorage.setItem(fn("redirectPath"),o),mn())}(),c.a.render(i.a.createElement(La,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[203,1,2]]]);
//# sourceMappingURL=main.52ac8c2c.chunk.js.map